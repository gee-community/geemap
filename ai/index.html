
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A Python package for interactive mapping with Google Earth Engine">
      
      
        <meta name="author" content="Qiusheng Wu">
      
      
        <link rel="canonical" href="https://geemap.org/ai/">
      
      
        <link rel="prev" href="../changelog/">
      
      
        <link rel="next" href="../basemaps/">
      
      
      <link rel="icon" href="../assets/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.19">
    
    
      
        <title>ai module - geemap</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Google+Sans:300,300i,400,400i,700,700i%7CRegular:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Google Sans";--md-code-font:"Regular"}</style>
      
    
    
      <link rel="stylesheet" href="../css/timeago.css">
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-H322CB6ZEC"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-H322CB6ZEC",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-H322CB6ZEC",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#ai-module" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="geemap" class="md-header__button md-logo" aria-label="geemap" data-md-component="logo">
      
  <img src="../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            geemap
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              ai module
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/gee-community/geemap" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="geemap" class="md-nav__button md-logo" aria-label="geemap" data-md-component="logo">
      
  <img src="../assets/logo.png" alt="logo">

    </a>
    geemap
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/gee-community/geemap" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://book.geemap.org" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Book
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../get-started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Get Started
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Usage
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../cheatsheet/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cheat Sheet
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorials/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tutorials
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://courses.geemap.org" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Courses
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../citations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Citations
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../faq/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FAQ
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../changelog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Changelog
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://youtube.com/@giswqs" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    YouTube Channel
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/gee-community/geemap/issues" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Report Issues
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_15" checked>
        
          
          <label class="md-nav__link" for="__nav_15" id="__nav_15_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_15_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_15">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    ai module
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    ai module
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#geemap.ai" class="md-nav__link">
    <span class="md-ellipsis">
      ai
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geemap.ai.BBox" class="md-nav__link">
    <span class="md-ellipsis">
      BBox
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BBox">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#geemap.ai.BBox.from_list" class="md-nav__link">
    <span class="md-ellipsis">
      from_list
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.BBox.intersects" class="md-nav__link">
    <span class="md-ellipsis">
      intersects
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.BBox.is_global" class="md-nav__link">
    <span class="md-ellipsis">
      is_global
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.BBox.to_list" class="md-nav__link">
    <span class="md-ellipsis">
      to_list
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geemap.ai.Catalog" class="md-nav__link">
    <span class="md-ellipsis">
      Catalog
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Catalog">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#geemap.ai.Catalog.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.Catalog.get_collection" class="md-nav__link">
    <span class="md-ellipsis">
      get_collection
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geemap.ai.Collection" class="md-nav__link">
    <span class="md-ellipsis">
      Collection
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Collection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#geemap.ai.Collection.__getitem__" class="md-nav__link">
    <span class="md-ellipsis">
      __getitem__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.Collection.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.Collection.bands" class="md-nav__link">
    <span class="md-ellipsis">
      bands
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.Collection.bbox_list" class="md-nav__link">
    <span class="md-ellipsis">
      bbox_list
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.Collection.catalog_url" class="md-nav__link">
    <span class="md-ellipsis">
      catalog_url
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.Collection.datetime_interval" class="md-nav__link">
    <span class="md-ellipsis">
      datetime_interval
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.Collection.end" class="md-nav__link">
    <span class="md-ellipsis">
      end
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.Collection.end_str" class="md-nav__link">
    <span class="md-ellipsis">
      end_str
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.Collection.get" class="md-nav__link">
    <span class="md-ellipsis">
      get
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.Collection.get_dataset_type" class="md-nav__link">
    <span class="md-ellipsis">
      get_dataset_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.Collection.hyphen_id" class="md-nav__link">
    <span class="md-ellipsis">
      hyphen_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.Collection.image_preview_url" class="md-nav__link">
    <span class="md-ellipsis">
      image_preview_url
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.Collection.is_deprecated" class="md-nav__link">
    <span class="md-ellipsis">
      is_deprecated
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.Collection.public_id" class="md-nav__link">
    <span class="md-ellipsis">
      public_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.Collection.python_code" class="md-nav__link">
    <span class="md-ellipsis">
      python_code
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.Collection.set_js_code" class="md-nav__link">
    <span class="md-ellipsis">
      set_js_code
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.Collection.set_python_code" class="md-nav__link">
    <span class="md-ellipsis">
      set_python_code
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.Collection.spatial_resolution_m" class="md-nav__link">
    <span class="md-ellipsis">
      spatial_resolution_m
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.Collection.start" class="md-nav__link">
    <span class="md-ellipsis">
      start
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.Collection.start_str" class="md-nav__link">
    <span class="md-ellipsis">
      start_str
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.Collection.temporal_resolution_str" class="md-nav__link">
    <span class="md-ellipsis">
      temporal_resolution_str
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geemap.ai.CollectionList" class="md-nav__link">
    <span class="md-ellipsis">
      CollectionList
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CollectionList">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#geemap.ai.CollectionList.filter_by_bounding_box" class="md-nav__link">
    <span class="md-ellipsis">
      filter_by_bounding_box
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.CollectionList.filter_by_bounding_box_list" class="md-nav__link">
    <span class="md-ellipsis">
      filter_by_bounding_box_list
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.CollectionList.filter_by_datetime" class="md-nav__link">
    <span class="md-ellipsis">
      filter_by_datetime
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.CollectionList.filter_by_ids" class="md-nav__link">
    <span class="md-ellipsis">
      filter_by_ids
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.CollectionList.filter_by_interval" class="md-nav__link">
    <span class="md-ellipsis">
      filter_by_interval
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.CollectionList.limit" class="md-nav__link">
    <span class="md-ellipsis">
      limit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.CollectionList.sort_by_spatial_resolution" class="md-nav__link">
    <span class="md-ellipsis">
      sort_by_spatial_resolution
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.CollectionList.to_df" class="md-nav__link">
    <span class="md-ellipsis">
      to_df
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geemap.ai.DatasetExplorer" class="md-nav__link">
    <span class="md-ellipsis">
      DatasetExplorer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DatasetExplorer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#geemap.ai.DatasetExplorer.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.DatasetExplorer.show" class="md-nav__link">
    <span class="md-ellipsis">
      show
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geemap.ai.DatasetSearchInterface" class="md-nav__link">
    <span class="md-ellipsis">
      DatasetSearchInterface
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DatasetSearchInterface">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#geemap.ai.DatasetSearchInterface.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.DatasetSearchInterface.display" class="md-nav__link">
    <span class="md-ellipsis">
      display
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.DatasetSearchInterface.update_outputs" class="md-nav__link">
    <span class="md-ellipsis">
      update_outputs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geemap.ai.EarthEngineDatasetIndex" class="md-nav__link">
    <span class="md-ellipsis">
      EarthEngineDatasetIndex
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EarthEngineDatasetIndex">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#geemap.ai.EarthEngineDatasetIndex.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.EarthEngineDatasetIndex.find_top_matches" class="md-nav__link">
    <span class="md-ellipsis">
      find_top_matches
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.EarthEngineDatasetIndex.find_top_matches_with_score_df" class="md-nav__link">
    <span class="md-ellipsis">
      find_top_matches_with_score_df
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.EarthEngineDatasetIndex.ids_to_match_scores_df" class="md-nav__link">
    <span class="md-ellipsis">
      ids_to_match_scores_df
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geemap.ai.Genie" class="md-nav__link">
    <span class="md-ellipsis">
      Genie
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Genie">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#geemap.ai.Genie.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geemap.ai.PrecomputedEmbeddings" class="md-nav__link">
    <span class="md-ellipsis">
      PrecomputedEmbeddings
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PrecomputedEmbeddings">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#geemap.ai.PrecomputedEmbeddings.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.PrecomputedEmbeddings.embed_documents" class="md-nav__link">
    <span class="md-ellipsis">
      embed_documents
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.PrecomputedEmbeddings.embed_query" class="md-nav__link">
    <span class="md-ellipsis">
      embed_query
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geemap.ai.explain_relevance" class="md-nav__link">
    <span class="md-ellipsis">
      explain_relevance
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geemap.ai.explain_relevance_from_stac_json" class="md-nav__link">
    <span class="md-ellipsis">
      explain_relevance_from_stac_json
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geemap.ai.fix_ee_python_code" class="md-nav__link">
    <span class="md-ellipsis">
      fix_ee_python_code
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geemap.ai.is_valid_question" class="md-nav__link">
    <span class="md-ellipsis">
      is_valid_question
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geemap.ai.make_langchain_index" class="md-nav__link">
    <span class="md-ellipsis">
      make_langchain_index
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geemap.ai.matches_datetime" class="md-nav__link">
    <span class="md-ellipsis">
      matches_datetime
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geemap.ai.matches_interval" class="md-nav__link">
    <span class="md-ellipsis">
      matches_interval
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geemap.ai.run_ee_code" class="md-nav__link">
    <span class="md-ellipsis">
      run_ee_code
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../basemaps/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    basemaps module
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cartoee/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    cartoee module
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    chart module
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../colormaps/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    colormaps module
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../common/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    common module
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../conversion/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    conversion module
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../core/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    core module
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../coreutils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    coreutils module
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../datasets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    datasets module
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../deck/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    deck module
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ee_tile_layers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ee_tile_layers module
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    examples module
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../foliumap/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    foliumap module
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../geemap/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    geemap module
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kepler/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    kepler module
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../legends/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    legends module
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../map_widgets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    map_widgets module
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../maplibregl/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    maplibregl module
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ml/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ml module
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../osm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    osm module
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../plot/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    plot module
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../plotlymap/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    plotlymap module
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../report/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    report module
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../timelapse/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    timelapse module
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../toolbar/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    toolbar module
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_16" >
        
          
          <label class="md-nav__link" for="__nav_16" id="__nav_16_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Workshops
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_16_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_16">
            <span class="md-nav__icon md-icon"></span>
            Workshops
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../workshops/GeoPython_2021/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    GeoPython 2021
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../workshops/GEE_Workshop_2021/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    GEE Workshop 2021
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../workshops/SRM_Workshop_2022/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SRM Workshop 2022
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../workshops/Crop_Mapping_2022/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Crop Mapping 2022
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../workshops/Japan_2022/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Japan 2022
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../workshops/GEE_Workshop_2022_Part1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    GEE Workshop 2022 Part1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../workshops/GEE_Workshop_2022_Part2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    GEE Workshop 2022 Part2
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../workshops/AmericaView_2023/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AmericaView 2023
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../workshops/SciPy_2023/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SciPy 2023
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../workshops/City_Plus_2023/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    City Plus 2023
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../workshops/G4G_2023/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    G4G 2023
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../workshops/NCSU_2023/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    NCSU 2023
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../workshops/AGU_2023/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AGU 2023
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../workshops/Alaska_2024_Part1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Alaska 2024 Part1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../workshops/Alaska_2024_Part2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Alaska 2024 Part2
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../workshops/Alaska_2024_Part3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Alaska 2024 Part3
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../workshops/GEE_Workshop_2024/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    GEE Workshop 2024
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../workshops/TNGIC_2024/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    TNGIC 2024
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../workshops/IGIC_2024/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    IGIC 2024
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../workshops/SciPy_2024/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SciPy 2024
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../workshops/SatMOC_2024/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SatMOC 2024
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../workshops/GeoAI_2024/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    GeoAI 2024
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../workshops/Taiwan_2024/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Taiwan 2024
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../workshops/FOSS4GNA_2024/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FOSS4GNA 2024
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../workshops/IPPN_2024/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    IPPN 2024
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../workshops/HGAC_2024/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    HGAC 2024
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../workshops/AGU_2024/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AGU 2024
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../workshops/GEE_Workshop_2025/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    GEE Workshop 2025
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../workshops/CVPR_2025/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CVPR 2025
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_17" >
        
          
          <label class="md-nav__link" for="__nav_17" id="__nav_17_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Notebooks
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_17_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_17">
            <span class="md-nav__icon md-icon"></span>
            Notebooks
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/00_ee_auth_colab/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    00 ee auth colab
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/00_geemap_colab/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    00 geemap colab
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/00_geemap_key_features/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    00 geemap key features
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/01_geemap_intro/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    01 geemap intro
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/02_using_basemaps/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    02 using basemaps
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/03_inspector_tool/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    03 inspector tool
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/04_split_panel_map/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    04 split panel map
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/05_drawing_tools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    05 drawing tools
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/06_marker_cluster/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    06 marker cluster
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/07_geojson/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    07 geojson
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/08_ee_js_to_ipynb/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    08 ee js to ipynb
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/09_plotting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    09 plotting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/10_shapefiles/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    10 shapefiles
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/11_export_image/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    11 export image
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/12_zonal_statistics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    12 zonal statistics
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/13_zonal_statistics_by_group/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    13 zonal statistics by group
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/14_legends/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    14 legends
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/15_convert_js_to_py/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    15 convert js to py
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/16_add_animated_text/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    16 add animated text
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/17_add_colorbar_to_gif/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    17 add colorbar to gif
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/18_create_landsat_timelapse/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    18 create landsat timelapse
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/19_search_places_and_datasets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    19 search places and datasets
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/20_timeseries_inspector/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    20 timeseries inspector
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/21_export_map_to_html_png/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    21 export map to html png
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/22_import_scripts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    22 import scripts
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/23_import_assets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    23 import assets
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/24_publish_maps/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    24 publish maps
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/25_load_rasters/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    25 load rasters
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/26_heroku/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    26 heroku
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/27_timelapse_app/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    27 timelapse app
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/28_voila/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    28 voila
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/29_pydeck/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    29 pydeck
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/30_image_props_stats/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    30 image props stats
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/31_unsupervised_classification/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    31 unsupervised classification
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/32_supervised_classification/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    32 supervised classification
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/33_accuracy_assessment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    33 accuracy assessment
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/34_extract_values/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    34 extract values
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/35_geemap_colab/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    35 geemap colab
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/36_quality_mosaic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    36 quality mosaic
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/37_pydeck_3d/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    37 pydeck 3d
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/38_cloud_geotiff/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    38 cloud geotiff
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/39_timelapse/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    39 timelapse
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/40_ipywidgets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    40 ipywidgets
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/41_water_app/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    41 water app
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/42_upload_data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    42 upload data
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/43_extract_values_to_points/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    43 extract values to points
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/44_cog_stac/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    44 cog stac
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/45_cog_mosaic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    45 cog mosaic
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/46_local_rf_training/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    46 local rf training
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/47_image_thumbnails/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    47 image thumbnails
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/48_folium_legend/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    48 folium legend
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/49_colorbar/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    49 colorbar
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/50_cartoee_quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    50 cartoee quickstart
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/51_cartoee_projections/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    51 cartoee projections
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/52_cartoee_gif/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    52 cartoee gif
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/53_layer_vis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    53 layer vis
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/54_vector_vis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    54 vector vis
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/55_raster_vis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    55 raster vis
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/56_local_data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    56 local data
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/57_cartoee_blend/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    57 cartoee blend
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/58_add_vector/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    58 add vector
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/59_whitebox/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    59 whitebox
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/60_colormaps/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    60 colormaps
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/61_cartoee_scalebar/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    61 cartoee scalebar
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/62_time_slider/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    62 time slider
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/63_charts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    63 charts
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/64_data_catalog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    64 data catalog
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/65_vector_styling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    65 vector styling
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/66_cartoee_legend/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    66 cartoee legend
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/67_training_samples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    67 training samples
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/68_netcdf_to_ee/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    68 netcdf to ee
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/69_cartoee_vector/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    69 cartoee vector
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/70_linked_maps/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    70 linked maps
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/71_timelapse/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    71 timelapse
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/72_time_slider_gui/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    72 time slider gui
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/73_transect/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    73 transect
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/74_csv_to_points/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    74 csv to points
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/75_sankee/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    75 sankee
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/76_osm_to_ee/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    76 osm to ee
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/77_planet_imagery/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    77 planet imagery
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/78_ts_inspector/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    78 ts inspector
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/79_chart_histogram/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    79 chart histogram
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/80_point_layer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    80 point layer
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/81_goes_timelapse/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    81 goes timelapse
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/82_contours/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    82 contours
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/83_local_tile/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    83 local tile
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/84_openstreetmap/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    84 openstreetmap
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/85_postgis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    85 postgis
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/86_image_overlay/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    86 image overlay
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/87_add_points_from_xy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    87 add points from xy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/88_circle_markers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    88 circle markers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/89_add_labels/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    89 add labels
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/90_naip_timelapse/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    90 naip timelapse
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/91_planetary_computer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    91 planetary computer
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/92_plotly/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    92 plotly
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/93_cog_inspector/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    93 cog inspector
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/94_heremap/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    94 heremap
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/95_create_cog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    95 create cog
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/96_image_chips/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    96 image chips
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/97_join_table/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    97 join table
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/98_timelapse_fading/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    98 timelapse fading
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/99_landsat_9/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    99 landsat 9
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/100_numpy_to_cog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    100 numpy to cog
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/101_lidar/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    101 lidar
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/102_blend_hillshade/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    102 blend hillshade
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/103_split_control/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    103 split control
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/104_clip_image/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    104 clip image
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/105_netcdf/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    105 netcdf
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/106_kepler_gl/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    106 kepler gl
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/107_pydeck/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    107 pydeck
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/108_image_zonal_stats/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    108 image zonal stats
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/109_coordinate_grids/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    109 coordinate grids
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/110_choropleth/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    110 choropleth
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/111_image_count/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    111 image count
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/112_cartoee_basemap/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    112 cartoee basemap
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/113_image_area/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    113 image area
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/114_dynamic_world/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    114 dynamic world
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/115_land_cover/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    115 land cover
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/116_land_cover_timeseries/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    116 land cover timeseries
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/117_fishnet/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    117 fishnet
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/118_download_image/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    118 download image
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/119_plot_raster/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    119 plot raster
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/120_javascript/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    120 javascript
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/121_vector_style/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    121 vector style
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/122_lidar/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    122 lidar
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/123_sentinel1_timelapse/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    123 sentinel1 timelapse
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/124_more_datasets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    124 more datasets
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/125_example_code/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    125 example code
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/126_inspector/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    126 inspector
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/127_create_legend/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    127 create legend
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/128_add_widget/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    128 add widget
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/129_vector_to_gif/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    129 vector to gif
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/130_print_objects/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    130 print objects
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/131_arcgis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    131 arcgis
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/132_folium_colorbar/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    132 folium colorbar
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/133_gradio/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    133 gradio
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/134_ee_to_geotiff/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    134 ee to geotiff
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/135_segmentation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    135 segmentation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/136_download_parallel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    136 download parallel
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/137_create_grid/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    137 create grid
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/138_draw_control/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    138 draw control
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/139_layer_to_image/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    139 layer to image
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/140_ee_to_xarray/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    140 ee to xarray
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/141_image_array_viz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    141 image array viz
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/142_google_maps/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    142 google maps
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/143_precipitation_timelapse/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    143 precipitation timelapse
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/144_chart_features/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    144 chart features
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/145_chart_image/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    145 chart image
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/146_chart_image_collection/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    146 chart image collection
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/147_chart_array_list/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    147 chart array list
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/148_chart_data_table/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    148 chart data table
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/149_gemini/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    149 gemini
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/150_maplibre/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    150 maplibre
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/151_dataset_explorer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    151 dataset explorer
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/152_extract_timeseries_to_point/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    152 extract timeseries to point
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#geemap.ai" class="md-nav__link">
    <span class="md-ellipsis">
      ai
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geemap.ai.BBox" class="md-nav__link">
    <span class="md-ellipsis">
      BBox
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BBox">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#geemap.ai.BBox.from_list" class="md-nav__link">
    <span class="md-ellipsis">
      from_list
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.BBox.intersects" class="md-nav__link">
    <span class="md-ellipsis">
      intersects
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.BBox.is_global" class="md-nav__link">
    <span class="md-ellipsis">
      is_global
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.BBox.to_list" class="md-nav__link">
    <span class="md-ellipsis">
      to_list
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geemap.ai.Catalog" class="md-nav__link">
    <span class="md-ellipsis">
      Catalog
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Catalog">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#geemap.ai.Catalog.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.Catalog.get_collection" class="md-nav__link">
    <span class="md-ellipsis">
      get_collection
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geemap.ai.Collection" class="md-nav__link">
    <span class="md-ellipsis">
      Collection
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Collection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#geemap.ai.Collection.__getitem__" class="md-nav__link">
    <span class="md-ellipsis">
      __getitem__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.Collection.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.Collection.bands" class="md-nav__link">
    <span class="md-ellipsis">
      bands
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.Collection.bbox_list" class="md-nav__link">
    <span class="md-ellipsis">
      bbox_list
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.Collection.catalog_url" class="md-nav__link">
    <span class="md-ellipsis">
      catalog_url
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.Collection.datetime_interval" class="md-nav__link">
    <span class="md-ellipsis">
      datetime_interval
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.Collection.end" class="md-nav__link">
    <span class="md-ellipsis">
      end
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.Collection.end_str" class="md-nav__link">
    <span class="md-ellipsis">
      end_str
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.Collection.get" class="md-nav__link">
    <span class="md-ellipsis">
      get
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.Collection.get_dataset_type" class="md-nav__link">
    <span class="md-ellipsis">
      get_dataset_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.Collection.hyphen_id" class="md-nav__link">
    <span class="md-ellipsis">
      hyphen_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.Collection.image_preview_url" class="md-nav__link">
    <span class="md-ellipsis">
      image_preview_url
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.Collection.is_deprecated" class="md-nav__link">
    <span class="md-ellipsis">
      is_deprecated
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.Collection.public_id" class="md-nav__link">
    <span class="md-ellipsis">
      public_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.Collection.python_code" class="md-nav__link">
    <span class="md-ellipsis">
      python_code
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.Collection.set_js_code" class="md-nav__link">
    <span class="md-ellipsis">
      set_js_code
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.Collection.set_python_code" class="md-nav__link">
    <span class="md-ellipsis">
      set_python_code
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.Collection.spatial_resolution_m" class="md-nav__link">
    <span class="md-ellipsis">
      spatial_resolution_m
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.Collection.start" class="md-nav__link">
    <span class="md-ellipsis">
      start
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.Collection.start_str" class="md-nav__link">
    <span class="md-ellipsis">
      start_str
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.Collection.temporal_resolution_str" class="md-nav__link">
    <span class="md-ellipsis">
      temporal_resolution_str
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geemap.ai.CollectionList" class="md-nav__link">
    <span class="md-ellipsis">
      CollectionList
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CollectionList">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#geemap.ai.CollectionList.filter_by_bounding_box" class="md-nav__link">
    <span class="md-ellipsis">
      filter_by_bounding_box
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.CollectionList.filter_by_bounding_box_list" class="md-nav__link">
    <span class="md-ellipsis">
      filter_by_bounding_box_list
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.CollectionList.filter_by_datetime" class="md-nav__link">
    <span class="md-ellipsis">
      filter_by_datetime
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.CollectionList.filter_by_ids" class="md-nav__link">
    <span class="md-ellipsis">
      filter_by_ids
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.CollectionList.filter_by_interval" class="md-nav__link">
    <span class="md-ellipsis">
      filter_by_interval
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.CollectionList.limit" class="md-nav__link">
    <span class="md-ellipsis">
      limit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.CollectionList.sort_by_spatial_resolution" class="md-nav__link">
    <span class="md-ellipsis">
      sort_by_spatial_resolution
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.CollectionList.to_df" class="md-nav__link">
    <span class="md-ellipsis">
      to_df
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geemap.ai.DatasetExplorer" class="md-nav__link">
    <span class="md-ellipsis">
      DatasetExplorer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DatasetExplorer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#geemap.ai.DatasetExplorer.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.DatasetExplorer.show" class="md-nav__link">
    <span class="md-ellipsis">
      show
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geemap.ai.DatasetSearchInterface" class="md-nav__link">
    <span class="md-ellipsis">
      DatasetSearchInterface
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DatasetSearchInterface">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#geemap.ai.DatasetSearchInterface.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.DatasetSearchInterface.display" class="md-nav__link">
    <span class="md-ellipsis">
      display
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.DatasetSearchInterface.update_outputs" class="md-nav__link">
    <span class="md-ellipsis">
      update_outputs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geemap.ai.EarthEngineDatasetIndex" class="md-nav__link">
    <span class="md-ellipsis">
      EarthEngineDatasetIndex
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EarthEngineDatasetIndex">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#geemap.ai.EarthEngineDatasetIndex.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.EarthEngineDatasetIndex.find_top_matches" class="md-nav__link">
    <span class="md-ellipsis">
      find_top_matches
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.EarthEngineDatasetIndex.find_top_matches_with_score_df" class="md-nav__link">
    <span class="md-ellipsis">
      find_top_matches_with_score_df
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.EarthEngineDatasetIndex.ids_to_match_scores_df" class="md-nav__link">
    <span class="md-ellipsis">
      ids_to_match_scores_df
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geemap.ai.Genie" class="md-nav__link">
    <span class="md-ellipsis">
      Genie
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Genie">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#geemap.ai.Genie.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geemap.ai.PrecomputedEmbeddings" class="md-nav__link">
    <span class="md-ellipsis">
      PrecomputedEmbeddings
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PrecomputedEmbeddings">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#geemap.ai.PrecomputedEmbeddings.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.PrecomputedEmbeddings.embed_documents" class="md-nav__link">
    <span class="md-ellipsis">
      embed_documents
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geemap.ai.PrecomputedEmbeddings.embed_query" class="md-nav__link">
    <span class="md-ellipsis">
      embed_query
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geemap.ai.explain_relevance" class="md-nav__link">
    <span class="md-ellipsis">
      explain_relevance
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geemap.ai.explain_relevance_from_stac_json" class="md-nav__link">
    <span class="md-ellipsis">
      explain_relevance_from_stac_json
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geemap.ai.fix_ee_python_code" class="md-nav__link">
    <span class="md-ellipsis">
      fix_ee_python_code
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geemap.ai.is_valid_question" class="md-nav__link">
    <span class="md-ellipsis">
      is_valid_question
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geemap.ai.make_langchain_index" class="md-nav__link">
    <span class="md-ellipsis">
      make_langchain_index
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geemap.ai.matches_datetime" class="md-nav__link">
    <span class="md-ellipsis">
      matches_datetime
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geemap.ai.matches_interval" class="md-nav__link">
    <span class="md-ellipsis">
      matches_interval
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geemap.ai.run_ee_code" class="md-nav__link">
    <span class="md-ellipsis">
      run_ee_code
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                



                  


  
  


<h1 id="ai-module">ai module<a class="headerlink" href="#ai-module" title="Permanent link">&para;</a></h1>


<div class="doc doc-object doc-module">



<a id="geemap.ai"></a>
    <div class="doc doc-contents first">

        <p>This module contains functions for interacting with AI models.
The Genie class source code is adapted from the ee_genie.ipynb at <a href="https://bit.ly/3YEm7B6">https://bit.ly/3YEm7B6</a>.
Credit to the original author Simon Ilyushchenko (<a href="https://github.com/simonff">https://github.com/simonff</a>).
The DataExplorer class source code is adapted from <a href="https://bit.ly/48cE24D">https://bit.ly/48cE24D</a>.
Credit to the original author Renee Johnston (<a href="https://github.com/raj02006">https://github.com/raj02006</a>)</p>










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="geemap.ai.BBox" class="doc doc-heading">
            <code>BBox</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#geemap.ai.BBox" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">


        <p>Class representing a lat/lon bounding box.</p>








              <details class="quote">
                <summary>Source code in <code>geemap/ai.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclasses</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">BBox</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class representing a lat/lon bounding box.&quot;&quot;&quot;</span>

    <span class="n">west</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">south</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">east</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">north</span><span class="p">:</span> <span class="nb">float</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">is_global</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Checks if the bounding box is global.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if the bounding box is global, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">west</span> <span class="o">==</span> <span class="o">-</span><span class="mi">180</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">south</span> <span class="o">==</span> <span class="o">-</span><span class="mi">90</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">east</span> <span class="o">==</span> <span class="mi">180</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">north</span> <span class="o">==</span> <span class="mi">90</span>
        <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_list</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">bbox_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;BBox&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructs a BBox from a list of four numbers [west, south, east, north].</span>

<span class="sd">        Args:</span>
<span class="sd">            bbox_list (List[float]): List of four numbers representing the bounding box.</span>

<span class="sd">        Returns:</span>
<span class="sd">            BBox: The constructed BBox object.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If the coordinates are not in the correct order.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">bbox_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">bbox_list</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;The smaller (west) coordinate must be listed first in a bounding box&quot;</span>
                <span class="sa">f</span><span class="s2">&quot; corner list. Found </span><span class="si">{</span><span class="n">bbox_list</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">bbox_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">bbox_list</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;The smaller (south) coordinate must be listed first in a bounding&quot;</span>
                <span class="sa">f</span><span class="s2">&quot; box corner list. Found </span><span class="si">{</span><span class="n">bbox_list</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">bbox_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bbox_list</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">bbox_list</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">bbox_list</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Converts the BBox to a list of four numbers [west, south, east, north].</span>

<span class="sd">        Returns:</span>
<span class="sd">            List[float]: List of four numbers representing the bounding box.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">west</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">south</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">east</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">north</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">intersects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query_bbox</span><span class="p">:</span> <span class="s2">&quot;BBox&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Checks if this bbox intersects with the query bbox.</span>

<span class="sd">        Doesn&#39;t handle bboxes extending past the antimeridian.</span>

<span class="sd">        Args:</span>
<span class="sd">            query_bbox (BBox): Bounding box from the query.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if the two bounding boxes intersect, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">query_bbox</span><span class="o">.</span><span class="n">west</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">east</span>
            <span class="ow">and</span> <span class="n">query_bbox</span><span class="o">.</span><span class="n">east</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">west</span>
            <span class="ow">and</span> <span class="n">query_bbox</span><span class="o">.</span><span class="n">south</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">north</span>
            <span class="ow">and</span> <span class="n">query_bbox</span><span class="o">.</span><span class="n">north</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">south</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="geemap.ai.BBox.from_list" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_list</span><span class="p">(</span><span class="n">bbox_list</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#geemap.ai.BBox.from_list" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Constructs a BBox from a list of four numbers [west, south, east, north].</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>bbox_list</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of four numbers representing the bounding box.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>BBox</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="BBox


  
      dataclass
   (geemap.ai.BBox)" href="#geemap.ai.BBox">BBox</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The constructed BBox object.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the coordinates are not in the correct order.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geemap/ai.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_list</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">bbox_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;BBox&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Constructs a BBox from a list of four numbers [west, south, east, north].</span>

<span class="sd">    Args:</span>
<span class="sd">        bbox_list (List[float]): List of four numbers representing the bounding box.</span>

<span class="sd">    Returns:</span>
<span class="sd">        BBox: The constructed BBox object.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If the coordinates are not in the correct order.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">bbox_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">bbox_list</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;The smaller (west) coordinate must be listed first in a bounding box&quot;</span>
            <span class="sa">f</span><span class="s2">&quot; corner list. Found </span><span class="si">{</span><span class="n">bbox_list</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">bbox_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">bbox_list</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;The smaller (south) coordinate must be listed first in a bounding&quot;</span>
            <span class="sa">f</span><span class="s2">&quot; box corner list. Found </span><span class="si">{</span><span class="n">bbox_list</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">bbox_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bbox_list</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">bbox_list</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">bbox_list</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="geemap.ai.BBox.intersects" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">intersects</span><span class="p">(</span><span class="n">query_bbox</span><span class="p">)</span></code>

<a href="#geemap.ai.BBox.intersects" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Checks if this bbox intersects with the query bbox.</p>
<p>Doesn't handle bboxes extending past the antimeridian.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>query_bbox</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="BBox


  
      dataclass
   (geemap.ai.BBox)" href="#geemap.ai.BBox">BBox</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Bounding box from the query.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if the two bounding boxes intersect, False otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geemap/ai.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">intersects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query_bbox</span><span class="p">:</span> <span class="s2">&quot;BBox&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Checks if this bbox intersects with the query bbox.</span>

<span class="sd">    Doesn&#39;t handle bboxes extending past the antimeridian.</span>

<span class="sd">    Args:</span>
<span class="sd">        query_bbox (BBox): Bounding box from the query.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if the two bounding boxes intersect, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">query_bbox</span><span class="o">.</span><span class="n">west</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">east</span>
        <span class="ow">and</span> <span class="n">query_bbox</span><span class="o">.</span><span class="n">east</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">west</span>
        <span class="ow">and</span> <span class="n">query_bbox</span><span class="o">.</span><span class="n">south</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">north</span>
        <span class="ow">and</span> <span class="n">query_bbox</span><span class="o">.</span><span class="n">north</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">south</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="geemap.ai.BBox.is_global" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_global</span><span class="p">()</span></code>

<a href="#geemap.ai.BBox.is_global" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Checks if the bounding box is global.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if the bounding box is global, False otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geemap/ai.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">is_global</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Checks if the bounding box is global.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if the bounding box is global, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">west</span> <span class="o">==</span> <span class="o">-</span><span class="mi">180</span>
        <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">south</span> <span class="o">==</span> <span class="o">-</span><span class="mi">90</span>
        <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">east</span> <span class="o">==</span> <span class="mi">180</span>
        <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">north</span> <span class="o">==</span> <span class="mi">90</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="geemap.ai.BBox.to_list" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_list</span><span class="p">()</span></code>

<a href="#geemap.ai.BBox.to_list" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Converts the BBox to a list of four numbers [west, south, east, north].</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[float]: List of four numbers representing the bounding box.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geemap/ai.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">to_list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts the BBox to a list of four numbers [west, south, east, north].</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[float]: List of four numbers representing the bounding box.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">west</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">south</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">east</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">north</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="geemap.ai.Catalog" class="doc doc-heading">
            <code>Catalog</code>


<a href="#geemap.ai.Catalog" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">


        <p>Class containing all collections in the EE STAC catalog.</p>








              <details class="quote">
                <summary>Source code in <code>geemap/ai.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Catalog</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class containing all collections in the EE STAC catalog.&quot;&quot;&quot;</span>

    <span class="n">collections</span><span class="p">:</span> <span class="n">CollectionList</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">storage_client</span><span class="p">:</span> <span class="n">storage</span><span class="o">.</span><span class="n">Client</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initializes the Catalog with collections loaded from Google Cloud Storage.</span>

<span class="sd">        Args:</span>
<span class="sd">            storage_client (storage.Client): The Google Cloud Storage client.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collections</span> <span class="o">=</span> <span class="n">CollectionList</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_load_collections</span><span class="p">(</span><span class="n">storage_client</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_collection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Collection</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the collection with the given id.</span>

<span class="sd">        Args:</span>
<span class="sd">            id (str): The ID of the collection.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Collection: The collection with the given ID.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If no collection with the given ID is found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">filter_by_ids</span><span class="p">([</span><span class="nb">id</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">col</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No collection with id </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="nd">@tenacity</span><span class="o">.</span><span class="n">retry</span><span class="p">(</span>
        <span class="n">stop</span><span class="o">=</span><span class="n">tenacity</span><span class="o">.</span><span class="n">stop_after_attempt</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span>
        <span class="n">wait</span><span class="o">=</span><span class="n">tenacity</span><span class="o">.</span><span class="n">wait_exponential</span><span class="p">(</span><span class="n">multiplier</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span>
        <span class="n">retry</span><span class="o">=</span><span class="n">tenacity</span><span class="o">.</span><span class="n">retry_if_exception_type</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="n">google_exceptions</span><span class="o">.</span><span class="n">GoogleAPICallError</span><span class="p">,</span>
                <span class="n">google_exceptions</span><span class="o">.</span><span class="n">RetryError</span><span class="p">,</span>
                <span class="ne">ConnectionError</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">),</span>
        <span class="n">before_sleep</span><span class="o">=</span><span class="k">lambda</span> <span class="n">retry_state</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Error occurred: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">retry_state</span><span class="o">.</span><span class="n">outcome</span><span class="o">.</span><span class="n">exception</span><span class="p">())</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Retrying in </span><span class="si">{</span><span class="n">retry_state</span><span class="o">.</span><span class="n">next_action</span><span class="o">.</span><span class="n">sleep</span><span class="si">}</span><span class="s2"> seconds... &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;(Attempt </span><span class="si">{</span><span class="n">retry_state</span><span class="o">.</span><span class="n">attempt_number</span><span class="si">}</span><span class="s2">/3)&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_read_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_blob</span><span class="p">:</span> <span class="n">storage</span><span class="o">.</span><span class="n">Blob</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Collection</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reads the contents of a file from the specified bucket.</span>

<span class="sd">        Args:</span>
<span class="sd">            file_blob (storage.Blob): The blob representing the file.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Collection: The collection created from the file contents.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">file_contents</span> <span class="o">=</span> <span class="n">file_blob</span><span class="o">.</span><span class="n">download_as_string</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">Collection</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">file_contents</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_read_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_blobs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">storage</span><span class="o">.</span><span class="n">Blob</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Collection</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Processes files in parallel.</span>

<span class="sd">        Args:</span>
<span class="sd">            file_blobs (List[storage.Blob]): The list of file blobs.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List[Collection]: The list of collections created from the file contents.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">collections</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">with</span> <span class="n">futures</span><span class="o">.</span><span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
            <span class="n">file_futures</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_read_file</span><span class="p">,</span> <span class="n">file_blob</span><span class="p">)</span> <span class="k">for</span> <span class="n">file_blob</span> <span class="ow">in</span> <span class="n">file_blobs</span>
            <span class="p">]</span>
            <span class="k">for</span> <span class="n">future</span> <span class="ow">in</span> <span class="n">file_futures</span><span class="p">:</span>
                <span class="n">collections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">collections</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_load_collections</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">storage_client</span><span class="p">:</span> <span class="n">storage</span><span class="o">.</span><span class="n">Client</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Collection</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Loads all EE STAC JSON files from GCS, with datetimes as objects.</span>

<span class="sd">        Args:</span>
<span class="sd">            storage_client (storage.Client): The Google Cloud Storage client.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Sequence[Collection]: A tuple of collections loaded from the files.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">bucket</span> <span class="o">=</span> <span class="n">storage_client</span><span class="o">.</span><span class="n">get_bucket</span><span class="p">(</span><span class="s2">&quot;earthengine-stac&quot;</span><span class="p">)</span>
        <span class="n">files</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">x</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">bucket</span><span class="o">.</span><span class="n">list_blobs</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;catalog/&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.json&quot;</span><span class="p">)</span>
            <span class="ow">and</span> <span class="ow">not</span> <span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;/catalog.json&quot;</span><span class="p">)</span>
            <span class="ow">and</span> <span class="ow">not</span> <span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;/units.json&quot;</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Found </span><span class="si">%d</span><span class="s2"> files, loading...&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">))</span>
        <span class="n">collections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_files</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>

        <span class="n">code_samples_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_all_code_samples</span><span class="p">(</span><span class="n">storage_client</span><span class="p">)</span>

        <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">collections</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">is_deprecated</span><span class="p">():</span>
                <span class="k">continue</span>
            <span class="n">c</span><span class="o">.</span><span class="n">stac_json</span><span class="p">[</span><span class="s2">&quot;code&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">code_samples_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">hyphen_id</span><span class="p">())</span>
            <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Loaded </span><span class="si">%d</span><span class="s2"> collections (skipping deprecated ones)&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="p">))</span>
        <span class="c1"># Returning a tuple for immutability.</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_load_all_code_samples</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">storage_client</span><span class="p">:</span> <span class="n">storage</span><span class="o">.</span><span class="n">Client</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Loads js + py example scripts from GCS into dict keyed by dataset ID.</span>

<span class="sd">        Args:</span>
<span class="sd">            storage_client (storage.Client): The Google Cloud Storage client.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict[str, Dict[str, str]]: A dictionary mapping dataset IDs to their code samples.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Get json file from GCS bucket</span>
        <span class="c1"># &#39;gs://earthengine-catalog/catalog/example_scripts.json&#39;</span>
        <span class="n">bucket</span> <span class="o">=</span> <span class="n">storage_client</span><span class="o">.</span><span class="n">get_bucket</span><span class="p">(</span><span class="s2">&quot;earthengine-catalog&quot;</span><span class="p">)</span>
        <span class="n">blob</span> <span class="o">=</span> <span class="n">bucket</span><span class="o">.</span><span class="n">blob</span><span class="p">(</span><span class="s2">&quot;catalog/example_scripts.json&quot;</span><span class="p">)</span>
        <span class="n">file_contents</span> <span class="o">=</span> <span class="n">blob</span><span class="o">.</span><span class="n">download_as_string</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">file_contents</span><span class="p">)</span>

        <span class="c1"># Flatten json to get a map from ID (using &#39;_&#39; rather than &#39;/&#39;) to code</span>
        <span class="c1"># sample.</span>
        <span class="n">all_datasets_by_provider</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;contents&quot;</span><span class="p">]</span>
        <span class="n">code_samples_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">provider</span> <span class="ow">in</span> <span class="n">all_datasets_by_provider</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="n">provider</span><span class="p">[</span><span class="s2">&quot;contents&quot;</span><span class="p">]:</span>
                <span class="n">js_code</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="s2">&quot;code&quot;</span><span class="p">]</span>
                <span class="n">py_code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_python_code_sample</span><span class="p">(</span><span class="n">js_code</span><span class="p">)</span>

                <span class="n">code_samples_dict</span><span class="p">[</span><span class="n">dataset</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;js_code&quot;</span><span class="p">:</span> <span class="n">js_code</span><span class="p">,</span>
                    <span class="s2">&quot;py_code&quot;</span><span class="p">:</span> <span class="n">py_code</span><span class="p">,</span>
                <span class="p">}</span>

        <span class="k">return</span> <span class="n">code_samples_dict</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_make_python_code_sample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">js_code</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Converts EE JS code into python.</span>

<span class="sd">        Args:</span>
<span class="sd">            js_code (str): The JavaScript code to convert.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The converted Python code.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># geemap appears to have some stray print statements.</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
        <span class="k">with</span> <span class="n">redirect_stdout</span><span class="p">(</span><span class="n">_</span><span class="p">):</span>
            <span class="n">code_list</span> <span class="o">=</span> <span class="n">js_snippet_to_py</span><span class="p">(</span>
                <span class="n">js_code</span><span class="p">,</span>
                <span class="n">add_new_cell</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">import_ee</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">import_geemap</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">show_map</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">code_list</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="geemap.ai.Catalog.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">storage_client</span><span class="p">)</span></code>

<a href="#geemap.ai.Catalog.__init__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Initializes the Catalog with collections loaded from Google Cloud Storage.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>storage_client</code>
            </td>
            <td>
                  <code><span title="google.cloud.storage.Client">Client</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Google Cloud Storage client.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geemap/ai.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">storage_client</span><span class="p">:</span> <span class="n">storage</span><span class="o">.</span><span class="n">Client</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initializes the Catalog with collections loaded from Google Cloud Storage.</span>

<span class="sd">    Args:</span>
<span class="sd">        storage_client (storage.Client): The Google Cloud Storage client.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">collections</span> <span class="o">=</span> <span class="n">CollectionList</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_load_collections</span><span class="p">(</span><span class="n">storage_client</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="geemap.ai.Catalog.get_collection" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_collection</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span></code>

<a href="#geemap.ai.Catalog.get_collection" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Returns the collection with the given id.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The ID of the collection.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Collection</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="Collection (geemap.ai.Collection)" href="#geemap.ai.Collection">Collection</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The collection with the given ID.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If no collection with the given ID is found.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geemap/ai.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_collection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Collection</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the collection with the given id.</span>

<span class="sd">    Args:</span>
<span class="sd">        id (str): The ID of the collection.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Collection: The collection with the given ID.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If no collection with the given ID is found.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">filter_by_ids</span><span class="p">([</span><span class="nb">id</span><span class="p">])</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">col</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No collection with id </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="geemap.ai.Collection" class="doc doc-heading">
            <code>Collection</code>


<a href="#geemap.ai.Collection" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">


        <p>A simple wrapper for a STAC Collection..</p>








              <details class="quote">
                <summary>Source code in <code>geemap/ai.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Collection</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A simple wrapper for a STAC Collection..&quot;&quot;&quot;</span>

    <span class="n">stac_json</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stac_json</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initializes the Collection.</span>

<span class="sd">        Args:</span>
<span class="sd">            stac_json (Dict[str, Any]): The STAC JSON of the collection.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stac_json</span> <span class="o">=</span> <span class="n">stac_json</span>
        <span class="k">if</span> <span class="n">stac_json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;gee:status&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;deprecated&quot;</span><span class="p">:</span>
            <span class="c1"># Set the STAC &#39;deprecated&#39; field that we don&#39;t set in the jsonnet files</span>
            <span class="n">stac_json</span><span class="p">[</span><span class="s2">&quot;deprecated&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Gets an item from the STAC JSON.</span>

<span class="sd">        Args:</span>
<span class="sd">            item (str): The key of the item to get.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Any: The value of the item.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stac_json</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Matches dict&#39;s get by returning None if there is no item.</span>

<span class="sd">        Args:</span>
<span class="sd">            item (str): The key of the item to get.</span>
<span class="sd">            default (Optional[Any]): The default value to return if the item is not found. Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Optional[Any]: The value of the item or the default value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stac_json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">public_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Gets the public ID of the collection.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The public ID of the collection.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">hyphen_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Gets the hyphenated ID of the collection.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The hyphenated ID of the collection.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_dataset_type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Gets the dataset type of the collection.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The dataset type of the collection.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gee:type&quot;</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">is_deprecated</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Checks if the collection is deprecated or has a successor.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if the collection is deprecated or has a successor, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;deprecated&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Skipping deprecated collection: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">public_id</span><span class="p">())</span>
            <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">datetime_interval</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">]]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns datetime objects representing temporal extents.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Iterable[Tuple[datetime.datetime, Optional[datetime.datetime]]]:</span>
<span class="sd">                An iterable of tuples representing temporal extents.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If the temporal interval start is not found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">stac_interval</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stac_json</span><span class="p">[</span><span class="s2">&quot;extent&quot;</span><span class="p">][</span><span class="s2">&quot;temporal&quot;</span><span class="p">][</span><span class="s2">&quot;interval&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">stac_interval</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Expected a non-empty temporal interval start for &quot;</span>
                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">public_id</span><span class="p">()</span>
                <span class="p">)</span>
            <span class="n">start_date</span> <span class="o">=</span> <span class="n">iso8601</span><span class="o">.</span><span class="n">parse_date</span><span class="p">(</span><span class="n">stac_interval</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">stac_interval</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">end_date</span> <span class="o">=</span> <span class="n">iso8601</span><span class="o">.</span><span class="n">parse_date</span><span class="p">(</span><span class="n">stac_interval</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">end_date</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">yield</span> <span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Gets the start datetime of the collection.</span>

<span class="sd">        Returns:</span>
<span class="sd">            datetime.datetime: The start datetime of the collection.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">datetime_interval</span><span class="p">())[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">start_str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Gets the start datetime of the collection as a string.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The start datetime of the collection as a string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">():</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">end</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Gets the end datetime of the collection.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Optional[datetime.datetime]: The end datetime of the collection.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">datetime_interval</span><span class="p">())[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">end_str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Gets the end datetime of the collection as a string.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The end datetime of the collection as a string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">end</span><span class="p">():</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">end</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">bbox_list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">BBox</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Gets the bounding boxes of the collection.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Sequence[BBox]: A sequence of bounding boxes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;extent&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stac_json</span><span class="p">:</span>
            <span class="c1"># Assume global if nothing listed.</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">BBox</span><span class="p">(</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">90</span><span class="p">),)</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span>
            <span class="p">[</span><span class="n">BBox</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stac_json</span><span class="p">[</span><span class="s2">&quot;extent&quot;</span><span class="p">][</span><span class="s2">&quot;spatial&quot;</span><span class="p">][</span><span class="s2">&quot;bbox&quot;</span><span class="p">]]</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">bands</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Gets the bands of the collection.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List[Dict[str, Any]]: A list of dictionaries representing the bands.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">summaries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stac_json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;summaries&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">summaries</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="n">summaries</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;eo:bands&quot;</span><span class="p">,</span> <span class="p">[])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">spatial_resolution_m</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Gets the spatial resolution of the collection in meters.</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: The spatial resolution of the collection in meters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">summaries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stac_json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;summaries&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">summaries</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">if</span> <span class="n">summaries</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;gsd&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">summaries</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;gsd&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Fallback for cases where the stac does not follow convention.</span>
        <span class="n">gsd_lst</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;&quot;gsd&quot;: (\d+)&#39;</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stac_json</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">gsd_lst</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">gsd_lst</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">temporal_resolution_str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Gets the temporal resolution of the collection as a string.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The temporal resolution of the collection as a string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">interval_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stac_json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;gee:interval&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">interval_dict</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">interval_dict</span><span class="p">[</span><span class="s1">&#39;interval&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">interval_dict</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">python_code</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Gets the Python code sample for the collection.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The Python code sample for the collection.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stac_json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;code&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">code</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span>

        <span class="k">return</span> <span class="n">code</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;py_code&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_python_code</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the Python code sample for the collection.</span>

<span class="sd">        Args:</span>
<span class="sd">            code (str): The Python code sample to set.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">code</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stac_json</span><span class="p">[</span><span class="s2">&quot;code&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;js_code&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;py_code&quot;</span><span class="p">:</span> <span class="n">code</span><span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">stac_json</span><span class="p">[</span><span class="s2">&quot;code&quot;</span><span class="p">][</span><span class="s2">&quot;py_code&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">code</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_js_code</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the JavaScript code sample for the collection.</span>

<span class="sd">        Args:</span>
<span class="sd">            code (str): The JavaScript code sample to set.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">code</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span>
        <span class="n">js_code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stac_json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;code&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;js_code&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stac_json</span><span class="p">[</span><span class="s2">&quot;code&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;js_code&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;py_code&quot;</span><span class="p">:</span> <span class="n">code</span><span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">image_preview_url</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Gets the URL of the preview image for the collection.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The URL of the preview image for the collection.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If no preview image is found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stac_json</span><span class="p">[</span><span class="s2">&quot;links&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="s2">&quot;rel&quot;</span> <span class="ow">in</span> <span class="n">link</span>
                <span class="ow">and</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;rel&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;preview&quot;</span>
                <span class="ow">and</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;image/png&quot;</span>
            <span class="p">):</span>
                <span class="k">return</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;href&quot;</span><span class="p">]</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No preview image found for </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">catalog_url</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Gets the URL of the catalog for the collection.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The URL of the catalog for the collection.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">links</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stac_json</span><span class="p">[</span><span class="s2">&quot;links&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">links</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;rel&quot;</span> <span class="ow">in</span> <span class="n">link</span> <span class="ow">and</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;rel&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;catalog&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;href&quot;</span><span class="p">]</span>

            <span class="c1"># Ideally there would be a &#39;catalog&#39; link but sometimes there isn&#39;t.</span>
            <span class="n">base_url</span> <span class="o">=</span> <span class="s2">&quot;https://developers.google.com/earth-engine/datasets/catalog/&quot;</span>
            <span class="k">if</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;href&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">base_url</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;href&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No catalog link found for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">public_id</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="geemap.ai.Collection.__getitem__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__getitem__</span><span class="p">(</span><span class="n">item</span><span class="p">)</span></code>

<a href="#geemap.ai.Collection.__getitem__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Gets an item from the STAC JSON.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>item</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The key of the item to get.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Any</code></td>            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The value of the item.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geemap/ai.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets an item from the STAC JSON.</span>

<span class="sd">    Args:</span>
<span class="sd">        item (str): The key of the item to get.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Any: The value of the item.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stac_json</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="geemap.ai.Collection.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">stac_json</span><span class="p">)</span></code>

<a href="#geemap.ai.Collection.__init__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Initializes the Collection.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>stac_json</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The STAC JSON of the collection.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geemap/ai.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stac_json</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initializes the Collection.</span>

<span class="sd">    Args:</span>
<span class="sd">        stac_json (Dict[str, Any]): The STAC JSON of the collection.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">stac_json</span> <span class="o">=</span> <span class="n">stac_json</span>
    <span class="k">if</span> <span class="n">stac_json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;gee:status&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;deprecated&quot;</span><span class="p">:</span>
        <span class="c1"># Set the STAC &#39;deprecated&#39; field that we don&#39;t set in the jsonnet files</span>
        <span class="n">stac_json</span><span class="p">[</span><span class="s2">&quot;deprecated&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="geemap.ai.Collection.bands" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bands</span><span class="p">()</span></code>

<a href="#geemap.ai.Collection.bands" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Gets the bands of the collection.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[Dict[str, Any]]: A list of dictionaries representing the bands.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geemap/ai.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">bands</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets the bands of the collection.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[Dict[str, Any]]: A list of dictionaries representing the bands.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">summaries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stac_json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;summaries&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">summaries</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="k">return</span> <span class="n">summaries</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;eo:bands&quot;</span><span class="p">,</span> <span class="p">[])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="geemap.ai.Collection.bbox_list" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bbox_list</span><span class="p">()</span></code>

<a href="#geemap.ai.Collection.bbox_list" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Gets the bounding boxes of the collection.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Sequence">Sequence</span>[<a class="autorefs autorefs-internal" title="BBox


  
      dataclass
   (geemap.ai.BBox)" href="#geemap.ai.BBox">BBox</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sequence[BBox]: A sequence of bounding boxes.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geemap/ai.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">bbox_list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">BBox</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets the bounding boxes of the collection.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Sequence[BBox]: A sequence of bounding boxes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;extent&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stac_json</span><span class="p">:</span>
        <span class="c1"># Assume global if nothing listed.</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">BBox</span><span class="p">(</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">90</span><span class="p">),)</span>
    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span>
        <span class="p">[</span><span class="n">BBox</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stac_json</span><span class="p">[</span><span class="s2">&quot;extent&quot;</span><span class="p">][</span><span class="s2">&quot;spatial&quot;</span><span class="p">][</span><span class="s2">&quot;bbox&quot;</span><span class="p">]]</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="geemap.ai.Collection.catalog_url" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">catalog_url</span><span class="p">()</span></code>

<a href="#geemap.ai.Collection.catalog_url" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Gets the URL of the catalog for the collection.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The URL of the catalog for the collection.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geemap/ai.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">catalog_url</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets the URL of the catalog for the collection.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The URL of the catalog for the collection.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">links</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stac_json</span><span class="p">[</span><span class="s2">&quot;links&quot;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">links</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;rel&quot;</span> <span class="ow">in</span> <span class="n">link</span> <span class="ow">and</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;rel&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;catalog&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;href&quot;</span><span class="p">]</span>

        <span class="c1"># Ideally there would be a &#39;catalog&#39; link but sometimes there isn&#39;t.</span>
        <span class="n">base_url</span> <span class="o">=</span> <span class="s2">&quot;https://developers.google.com/earth-engine/datasets/catalog/&quot;</span>
        <span class="k">if</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;href&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">base_url</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;href&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No catalog link found for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">public_id</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="s2">&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="geemap.ai.Collection.datetime_interval" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">datetime_interval</span><span class="p">()</span></code>

<a href="#geemap.ai.Collection.datetime_interval" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Returns datetime objects representing temporal extents.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Iterable">Iterable</span>[<span title="typing.Tuple">Tuple</span>[<span title="datetime.datetime">datetime</span>, <span title="typing.Optional">Optional</span>[<span title="datetime.datetime">datetime</span>]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Iterable[Tuple[datetime.datetime, Optional[datetime.datetime]]]:
An iterable of tuples representing temporal extents.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the temporal interval start is not found.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geemap/ai.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">datetime_interval</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">]]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns datetime objects representing temporal extents.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Iterable[Tuple[datetime.datetime, Optional[datetime.datetime]]]:</span>
<span class="sd">            An iterable of tuples representing temporal extents.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If the temporal interval start is not found.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">stac_interval</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stac_json</span><span class="p">[</span><span class="s2">&quot;extent&quot;</span><span class="p">][</span><span class="s2">&quot;temporal&quot;</span><span class="p">][</span><span class="s2">&quot;interval&quot;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">stac_interval</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Expected a non-empty temporal interval start for &quot;</span>
                <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">public_id</span><span class="p">()</span>
            <span class="p">)</span>
        <span class="n">start_date</span> <span class="o">=</span> <span class="n">iso8601</span><span class="o">.</span><span class="n">parse_date</span><span class="p">(</span><span class="n">stac_interval</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">stac_interval</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">end_date</span> <span class="o">=</span> <span class="n">iso8601</span><span class="o">.</span><span class="n">parse_date</span><span class="p">(</span><span class="n">stac_interval</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">end_date</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">yield</span> <span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="geemap.ai.Collection.end" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">end</span><span class="p">()</span></code>

<a href="#geemap.ai.Collection.end" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Gets the end datetime of the collection.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="datetime.datetime">datetime</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional[datetime.datetime]: The end datetime of the collection.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geemap/ai.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">end</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets the end datetime of the collection.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Optional[datetime.datetime]: The end datetime of the collection.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">datetime_interval</span><span class="p">())[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="geemap.ai.Collection.end_str" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">end_str</span><span class="p">()</span></code>

<a href="#geemap.ai.Collection.end_str" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Gets the end datetime of the collection as a string.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The end datetime of the collection as a string.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geemap/ai.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">end_str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets the end datetime of the collection as a string.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The end datetime of the collection as a string.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">end</span><span class="p">():</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">end</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="geemap.ai.Collection.get" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#geemap.ai.Collection.get" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Matches dict's get by returning None if there is no item.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>item</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The key of the item to get.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>default</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The default value to return if the item is not found. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional[Any]: The value of the item or the default value.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geemap/ai.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span>
<span class="normal">956</span>
<span class="normal">957</span>
<span class="normal">958</span>
<span class="normal">959</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Matches dict&#39;s get by returning None if there is no item.</span>

<span class="sd">    Args:</span>
<span class="sd">        item (str): The key of the item to get.</span>
<span class="sd">        default (Optional[Any]): The default value to return if the item is not found. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Optional[Any]: The value of the item or the default value.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stac_json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="geemap.ai.Collection.get_dataset_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_dataset_type</span><span class="p">()</span></code>

<a href="#geemap.ai.Collection.get_dataset_type" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Gets the dataset type of the collection.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dataset type of the collection.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geemap/ai.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">977</span>
<span class="normal">978</span>
<span class="normal">979</span>
<span class="normal">980</span>
<span class="normal">981</span>
<span class="normal">982</span>
<span class="normal">983</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_dataset_type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets the dataset type of the collection.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The dataset type of the collection.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gee:type&quot;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="geemap.ai.Collection.hyphen_id" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">hyphen_id</span><span class="p">()</span></code>

<a href="#geemap.ai.Collection.hyphen_id" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Gets the hyphenated ID of the collection.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The hyphenated ID of the collection.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geemap/ai.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">969</span>
<span class="normal">970</span>
<span class="normal">971</span>
<span class="normal">972</span>
<span class="normal">973</span>
<span class="normal">974</span>
<span class="normal">975</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">hyphen_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets the hyphenated ID of the collection.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The hyphenated ID of the collection.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="geemap.ai.Collection.image_preview_url" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">image_preview_url</span><span class="p">()</span></code>

<a href="#geemap.ai.Collection.image_preview_url" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Gets the URL of the preview image for the collection.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The URL of the preview image for the collection.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If no preview image is found.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geemap/ai.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">image_preview_url</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets the URL of the preview image for the collection.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The URL of the preview image for the collection.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If no preview image is found.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stac_json</span><span class="p">[</span><span class="s2">&quot;links&quot;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="s2">&quot;rel&quot;</span> <span class="ow">in</span> <span class="n">link</span>
            <span class="ow">and</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;rel&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;preview&quot;</span>
            <span class="ow">and</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;image/png&quot;</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;href&quot;</span><span class="p">]</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No preview image found for </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="geemap.ai.Collection.is_deprecated" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_deprecated</span><span class="p">()</span></code>

<a href="#geemap.ai.Collection.is_deprecated" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Checks if the collection is deprecated or has a successor.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if the collection is deprecated or has a successor, False otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geemap/ai.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">985</span>
<span class="normal">986</span>
<span class="normal">987</span>
<span class="normal">988</span>
<span class="normal">989</span>
<span class="normal">990</span>
<span class="normal">991</span>
<span class="normal">992</span>
<span class="normal">993</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">is_deprecated</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Checks if the collection is deprecated or has a successor.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if the collection is deprecated or has a successor, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;deprecated&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Skipping deprecated collection: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">public_id</span><span class="p">())</span>
        <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="geemap.ai.Collection.public_id" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">public_id</span><span class="p">()</span></code>

<a href="#geemap.ai.Collection.public_id" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Gets the public ID of the collection.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The public ID of the collection.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geemap/ai.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">961</span>
<span class="normal">962</span>
<span class="normal">963</span>
<span class="normal">964</span>
<span class="normal">965</span>
<span class="normal">966</span>
<span class="normal">967</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">public_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets the public ID of the collection.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The public ID of the collection.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="geemap.ai.Collection.python_code" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">python_code</span><span class="p">()</span></code>

<a href="#geemap.ai.Collection.python_code" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Gets the Python code sample for the collection.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Python code sample for the collection.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geemap/ai.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">python_code</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets the Python code sample for the collection.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The Python code sample for the collection.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stac_json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;code&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">code</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>

    <span class="k">return</span> <span class="n">code</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;py_code&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="geemap.ai.Collection.set_js_code" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_js_code</span><span class="p">(</span><span class="n">code</span><span class="p">)</span></code>

<a href="#geemap.ai.Collection.set_js_code" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Sets the JavaScript code sample for the collection.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>code</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The JavaScript code sample to set.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geemap/ai.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">set_js_code</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Sets the JavaScript code sample for the collection.</span>

<span class="sd">    Args:</span>
<span class="sd">        code (str): The JavaScript code sample to set.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">code</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>
    <span class="n">js_code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stac_json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;code&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;js_code&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">stac_json</span><span class="p">[</span><span class="s2">&quot;code&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;js_code&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;py_code&quot;</span><span class="p">:</span> <span class="n">code</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="geemap.ai.Collection.set_python_code" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_python_code</span><span class="p">(</span><span class="n">code</span><span class="p">)</span></code>

<a href="#geemap.ai.Collection.set_python_code" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Sets the Python code sample for the collection.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>code</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Python code sample to set.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geemap/ai.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">set_python_code</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Sets the Python code sample for the collection.</span>

<span class="sd">    Args:</span>
<span class="sd">        code (str): The Python code sample to set.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">code</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stac_json</span><span class="p">[</span><span class="s2">&quot;code&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;js_code&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;py_code&quot;</span><span class="p">:</span> <span class="n">code</span><span class="p">}</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">stac_json</span><span class="p">[</span><span class="s2">&quot;code&quot;</span><span class="p">][</span><span class="s2">&quot;py_code&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">code</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="geemap.ai.Collection.spatial_resolution_m" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">spatial_resolution_m</span><span class="p">()</span></code>

<a href="#geemap.ai.Collection.spatial_resolution_m" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Gets the spatial resolution of the collection in meters.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>float</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The spatial resolution of the collection in meters.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geemap/ai.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">spatial_resolution_m</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets the spatial resolution of the collection in meters.</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: The spatial resolution of the collection in meters.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">summaries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stac_json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;summaries&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">summaries</span><span class="p">:</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">if</span> <span class="n">summaries</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;gsd&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">summaries</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;gsd&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Fallback for cases where the stac does not follow convention.</span>
    <span class="n">gsd_lst</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;&quot;gsd&quot;: (\d+)&#39;</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stac_json</span><span class="p">))</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">gsd_lst</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">gsd_lst</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="geemap.ai.Collection.start" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">start</span><span class="p">()</span></code>

<a href="#geemap.ai.Collection.start" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Gets the start datetime of the collection.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="datetime.datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>datetime.datetime: The start datetime of the collection.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geemap/ai.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets the start datetime of the collection.</span>

<span class="sd">    Returns:</span>
<span class="sd">        datetime.datetime: The start datetime of the collection.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">datetime_interval</span><span class="p">())[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="geemap.ai.Collection.start_str" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">start_str</span><span class="p">()</span></code>

<a href="#geemap.ai.Collection.start_str" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Gets the start datetime of the collection as a string.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The start datetime of the collection as a string.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geemap/ai.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">start_str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets the start datetime of the collection as a string.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The start datetime of the collection as a string.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">():</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="geemap.ai.Collection.temporal_resolution_str" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">temporal_resolution_str</span><span class="p">()</span></code>

<a href="#geemap.ai.Collection.temporal_resolution_str" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Gets the temporal resolution of the collection as a string.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The temporal resolution of the collection as a string.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geemap/ai.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">temporal_resolution_str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets the temporal resolution of the collection as a string.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The temporal resolution of the collection as a string.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">interval_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stac_json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;gee:interval&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">interval_dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">interval_dict</span><span class="p">[</span><span class="s1">&#39;interval&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">interval_dict</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="geemap.ai.CollectionList" class="doc doc-heading">
            <code>CollectionList</code>


<a href="#geemap.ai.CollectionList" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="typing.Sequence">Sequence</span>[<a class="autorefs autorefs-internal" title="Collection (geemap.ai.Collection)" href="#geemap.ai.Collection">Collection</a>]</code></p>


        <p>List of stac.Collections; can be filtered to return a smaller sublist.</p>








              <details class="quote">
                <summary>Source code in <code>geemap/ai.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">CollectionList</span><span class="p">(</span><span class="n">Sequence</span><span class="p">[</span><span class="n">Collection</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;List of stac.Collections; can be filtered to return a smaller sublist.&quot;&quot;&quot;</span>

    <span class="n">_collections</span> <span class="o">=</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Collection</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collections</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Collection</span><span class="p">]):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_collections</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">collections</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_collections</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collections</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_collections</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">CollectionList</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collections</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">_collections</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_collections</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">filter_by_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ids</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a sublist with only the collections matching the given ids.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">([</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collections</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">public_id</span><span class="p">()</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">filter_by_datetime</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">query_datetime</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a sublist with the time interval matching the given time.&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">collection</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collections</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">datetime_interval</span> <span class="ow">in</span> <span class="n">collection</span><span class="o">.</span><span class="n">datetime_interval</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">matches_datetime</span><span class="p">(</span><span class="n">datetime_interval</span><span class="p">,</span> <span class="n">query_datetime</span><span class="p">):</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span>
                    <span class="k">break</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">filter_by_interval</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">query_interval</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">],</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a sublist with the time interval matching the given interval.&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">collection</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collections</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">datetime_interval</span> <span class="ow">in</span> <span class="n">collection</span><span class="o">.</span><span class="n">datetime_interval</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">matches_interval</span><span class="p">(</span><span class="n">datetime_interval</span><span class="p">,</span> <span class="n">query_interval</span><span class="p">):</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span>
                    <span class="k">break</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">filter_by_bounding_box_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query_bbox</span><span class="p">:</span> <span class="n">BBox</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a sublist with the bbox matching the given bbox.&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">collection</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collections</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">collection_bbox</span> <span class="ow">in</span> <span class="n">collection</span><span class="o">.</span><span class="n">bbox_list</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">collection_bbox</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="n">query_bbox</span><span class="p">):</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span>
                    <span class="k">break</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">filter_by_bounding_box</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query_bbox</span><span class="p">:</span> <span class="n">BBox</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a sublist with the bbox matching the given bbox.&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">collection</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collections</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">collection_bbox</span> <span class="ow">in</span> <span class="n">collection</span><span class="o">.</span><span class="n">bbox_list</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">collection_bbox</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="n">query_bbox</span><span class="p">):</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span>
                    <span class="k">break</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">start_str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">sort_by_spatial_resolution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sorts the collections based on their spatial resolution.</span>
<span class="sd">        Collections with spatial_resolution_m() == -1 are pushed to the end.</span>

<span class="sd">        Args:</span>
<span class="sd">            reverse (bool): If True, sort in descending order (highest resolution first).</span>
<span class="sd">                            If False (default), sort in ascending order (lowest resolution first).</span>

<span class="sd">        Returns:</span>
<span class="sd">            CollectionList: A new CollectionList instance with sorted collections.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">sort_key</span><span class="p">(</span><span class="n">collection</span><span class="p">):</span>
            <span class="n">resolution</span> <span class="o">=</span> <span class="n">collection</span><span class="o">.</span><span class="n">spatial_resolution_m</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">resolution</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">reverse</span> <span class="k">else</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;-inf&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">resolution</span>

        <span class="n">sorted_collections</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_collections</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">sort_key</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="n">reverse</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">sorted_collections</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">limit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a new CollectionList containing the first n entries.</span>

<span class="sd">        Args:</span>
<span class="sd">            n (int): The number of entries to include in the new list.</span>

<span class="sd">        Returns:</span>
<span class="sd">            CollectionList: A new CollectionList instance with at most n collections.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_collections</span><span class="p">[:</span><span class="n">n</span><span class="p">])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_df</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Converts a collection list to a dataframe with a select set of fields.&quot;&quot;&quot;</span>

        <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collections</span><span class="p">:</span>
            <span class="c1"># Remove text in parens in dataset name.</span>
            <span class="n">short_title</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\([^)]*\)&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">col</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

            <span class="n">row</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">col</span><span class="o">.</span><span class="n">public_id</span><span class="p">(),</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">short_title</span><span class="p">,</span>
                <span class="s2">&quot;temp_res&quot;</span><span class="p">:</span> <span class="n">col</span><span class="o">.</span><span class="n">temporal_resolution_str</span><span class="p">(),</span>
                <span class="s2">&quot;spatial_res_m&quot;</span><span class="p">:</span> <span class="n">col</span><span class="o">.</span><span class="n">spatial_resolution_m</span><span class="p">(),</span>
                <span class="s2">&quot;earliest&quot;</span><span class="p">:</span> <span class="n">col</span><span class="o">.</span><span class="n">start_str</span><span class="p">(),</span>
                <span class="s2">&quot;latest&quot;</span><span class="p">:</span> <span class="n">col</span><span class="o">.</span><span class="n">end_str</span><span class="p">(),</span>
                <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">col</span><span class="o">.</span><span class="n">catalog_url</span><span class="p">(),</span>
            <span class="p">}</span>
            <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="geemap.ai.CollectionList.filter_by_bounding_box" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">filter_by_bounding_box</span><span class="p">(</span><span class="n">query_bbox</span><span class="p">)</span></code>

<a href="#geemap.ai.CollectionList.filter_by_bounding_box" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Returns a sublist with the bbox matching the given bbox.</p>


            <details class="quote">
              <summary>Source code in <code>geemap/ai.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">filter_by_bounding_box</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query_bbox</span><span class="p">:</span> <span class="n">BBox</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a sublist with the bbox matching the given bbox.&quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">collection</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collections</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">collection_bbox</span> <span class="ow">in</span> <span class="n">collection</span><span class="o">.</span><span class="n">bbox_list</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">collection_bbox</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="n">query_bbox</span><span class="p">):</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span>
                <span class="k">break</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="geemap.ai.CollectionList.filter_by_bounding_box_list" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">filter_by_bounding_box_list</span><span class="p">(</span><span class="n">query_bbox</span><span class="p">)</span></code>

<a href="#geemap.ai.CollectionList.filter_by_bounding_box_list" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Returns a sublist with the bbox matching the given bbox.</p>


            <details class="quote">
              <summary>Source code in <code>geemap/ai.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">filter_by_bounding_box_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query_bbox</span><span class="p">:</span> <span class="n">BBox</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a sublist with the bbox matching the given bbox.&quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">collection</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collections</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">collection_bbox</span> <span class="ow">in</span> <span class="n">collection</span><span class="o">.</span><span class="n">bbox_list</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">collection_bbox</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="n">query_bbox</span><span class="p">):</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span>
                <span class="k">break</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="geemap.ai.CollectionList.filter_by_datetime" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">filter_by_datetime</span><span class="p">(</span><span class="n">query_datetime</span><span class="p">)</span></code>

<a href="#geemap.ai.CollectionList.filter_by_datetime" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Returns a sublist with the time interval matching the given time.</p>


            <details class="quote">
              <summary>Source code in <code>geemap/ai.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">filter_by_datetime</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">query_datetime</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a sublist with the time interval matching the given time.&quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">collection</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collections</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">datetime_interval</span> <span class="ow">in</span> <span class="n">collection</span><span class="o">.</span><span class="n">datetime_interval</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">matches_datetime</span><span class="p">(</span><span class="n">datetime_interval</span><span class="p">,</span> <span class="n">query_datetime</span><span class="p">):</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span>
                <span class="k">break</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="geemap.ai.CollectionList.filter_by_ids" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">filter_by_ids</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span></code>

<a href="#geemap.ai.CollectionList.filter_by_ids" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Returns a sublist with only the collections matching the given ids.</p>


            <details class="quote">
              <summary>Source code in <code>geemap/ai.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">filter_by_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ids</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a sublist with only the collections matching the given ids.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">([</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collections</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">public_id</span><span class="p">()</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="geemap.ai.CollectionList.filter_by_interval" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">filter_by_interval</span><span class="p">(</span><span class="n">query_interval</span><span class="p">)</span></code>

<a href="#geemap.ai.CollectionList.filter_by_interval" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Returns a sublist with the time interval matching the given interval.</p>


            <details class="quote">
              <summary>Source code in <code>geemap/ai.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">filter_by_interval</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">query_interval</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">],</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a sublist with the time interval matching the given interval.&quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">collection</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collections</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">datetime_interval</span> <span class="ow">in</span> <span class="n">collection</span><span class="o">.</span><span class="n">datetime_interval</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">matches_interval</span><span class="p">(</span><span class="n">datetime_interval</span><span class="p">,</span> <span class="n">query_interval</span><span class="p">):</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span>
                <span class="k">break</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="geemap.ai.CollectionList.limit" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">limit</span><span class="p">(</span><span class="n">n</span><span class="p">)</span></code>

<a href="#geemap.ai.CollectionList.limit" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Returns a new CollectionList containing the first n entries.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>n</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of entries to include in the new list.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>CollectionList</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A new CollectionList instance with at most n collections.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geemap/ai.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">limit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a new CollectionList containing the first n entries.</span>

<span class="sd">    Args:</span>
<span class="sd">        n (int): The number of entries to include in the new list.</span>

<span class="sd">    Returns:</span>
<span class="sd">        CollectionList: A new CollectionList instance with at most n collections.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_collections</span><span class="p">[:</span><span class="n">n</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="geemap.ai.CollectionList.sort_by_spatial_resolution" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">sort_by_spatial_resolution</span><span class="p">(</span><span class="n">reverse</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#geemap.ai.CollectionList.sort_by_spatial_resolution" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Sorts the collections based on their spatial resolution.
Collections with spatial_resolution_m() == -1 are pushed to the end.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>reverse</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, sort in descending order (highest resolution first).
            If False (default), sort in ascending order (lowest resolution first).</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>CollectionList</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A new CollectionList instance with sorted collections.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geemap/ai.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">sort_by_spatial_resolution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sorts the collections based on their spatial resolution.</span>
<span class="sd">    Collections with spatial_resolution_m() == -1 are pushed to the end.</span>

<span class="sd">    Args:</span>
<span class="sd">        reverse (bool): If True, sort in descending order (highest resolution first).</span>
<span class="sd">                        If False (default), sort in ascending order (lowest resolution first).</span>

<span class="sd">    Returns:</span>
<span class="sd">        CollectionList: A new CollectionList instance with sorted collections.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">sort_key</span><span class="p">(</span><span class="n">collection</span><span class="p">):</span>
        <span class="n">resolution</span> <span class="o">=</span> <span class="n">collection</span><span class="o">.</span><span class="n">spatial_resolution_m</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">resolution</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">reverse</span> <span class="k">else</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;-inf&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">resolution</span>

    <span class="n">sorted_collections</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_collections</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">sort_key</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="n">reverse</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">sorted_collections</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="geemap.ai.CollectionList.to_df" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_df</span><span class="p">()</span></code>

<a href="#geemap.ai.CollectionList.to_df" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Converts a collection list to a dataframe with a select set of fields.</p>


            <details class="quote">
              <summary>Source code in <code>geemap/ai.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">to_df</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts a collection list to a dataframe with a select set of fields.&quot;&quot;&quot;</span>

    <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collections</span><span class="p">:</span>
        <span class="c1"># Remove text in parens in dataset name.</span>
        <span class="n">short_title</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\([^)]*\)&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">col</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="n">row</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">col</span><span class="o">.</span><span class="n">public_id</span><span class="p">(),</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">short_title</span><span class="p">,</span>
            <span class="s2">&quot;temp_res&quot;</span><span class="p">:</span> <span class="n">col</span><span class="o">.</span><span class="n">temporal_resolution_str</span><span class="p">(),</span>
            <span class="s2">&quot;spatial_res_m&quot;</span><span class="p">:</span> <span class="n">col</span><span class="o">.</span><span class="n">spatial_resolution_m</span><span class="p">(),</span>
            <span class="s2">&quot;earliest&quot;</span><span class="p">:</span> <span class="n">col</span><span class="o">.</span><span class="n">start_str</span><span class="p">(),</span>
            <span class="s2">&quot;latest&quot;</span><span class="p">:</span> <span class="n">col</span><span class="o">.</span><span class="n">end_str</span><span class="p">(),</span>
            <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">col</span><span class="o">.</span><span class="n">catalog_url</span><span class="p">(),</span>
        <span class="p">}</span>
        <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="geemap.ai.DatasetExplorer" class="doc doc-heading">
            <code>DatasetExplorer</code>


<a href="#geemap.ai.DatasetExplorer" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">


        <p>A widget for exploring Earth Engine datasets.
The DataExplorer class source code is adapted from <a href="https://bit.ly/48cE24D">https://bit.ly/48cE24D</a>.
Credit to the original author Renee Johnston (<a href="https://github.com/raj02006">https://github.com/raj02006</a>)</p>








              <details class="quote">
                <summary>Source code in <code>geemap/ai.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2201</span>
<span class="normal">2202</span>
<span class="normal">2203</span>
<span class="normal">2204</span>
<span class="normal">2205</span>
<span class="normal">2206</span>
<span class="normal">2207</span>
<span class="normal">2208</span>
<span class="normal">2209</span>
<span class="normal">2210</span>
<span class="normal">2211</span>
<span class="normal">2212</span>
<span class="normal">2213</span>
<span class="normal">2214</span>
<span class="normal">2215</span>
<span class="normal">2216</span>
<span class="normal">2217</span>
<span class="normal">2218</span>
<span class="normal">2219</span>
<span class="normal">2220</span>
<span class="normal">2221</span>
<span class="normal">2222</span>
<span class="normal">2223</span>
<span class="normal">2224</span>
<span class="normal">2225</span>
<span class="normal">2226</span>
<span class="normal">2227</span>
<span class="normal">2228</span>
<span class="normal">2229</span>
<span class="normal">2230</span>
<span class="normal">2231</span>
<span class="normal">2232</span>
<span class="normal">2233</span>
<span class="normal">2234</span>
<span class="normal">2235</span>
<span class="normal">2236</span>
<span class="normal">2237</span>
<span class="normal">2238</span>
<span class="normal">2239</span>
<span class="normal">2240</span>
<span class="normal">2241</span>
<span class="normal">2242</span>
<span class="normal">2243</span>
<span class="normal">2244</span>
<span class="normal">2245</span>
<span class="normal">2246</span>
<span class="normal">2247</span>
<span class="normal">2248</span>
<span class="normal">2249</span>
<span class="normal">2250</span>
<span class="normal">2251</span>
<span class="normal">2252</span>
<span class="normal">2253</span>
<span class="normal">2254</span>
<span class="normal">2255</span>
<span class="normal">2256</span>
<span class="normal">2257</span>
<span class="normal">2258</span>
<span class="normal">2259</span>
<span class="normal">2260</span>
<span class="normal">2261</span>
<span class="normal">2262</span>
<span class="normal">2263</span>
<span class="normal">2264</span>
<span class="normal">2265</span>
<span class="normal">2266</span>
<span class="normal">2267</span>
<span class="normal">2268</span>
<span class="normal">2269</span>
<span class="normal">2270</span>
<span class="normal">2271</span>
<span class="normal">2272</span>
<span class="normal">2273</span>
<span class="normal">2274</span>
<span class="normal">2275</span>
<span class="normal">2276</span>
<span class="normal">2277</span>
<span class="normal">2278</span>
<span class="normal">2279</span>
<span class="normal">2280</span>
<span class="normal">2281</span>
<span class="normal">2282</span>
<span class="normal">2283</span>
<span class="normal">2284</span>
<span class="normal">2285</span>
<span class="normal">2286</span>
<span class="normal">2287</span>
<span class="normal">2288</span>
<span class="normal">2289</span>
<span class="normal">2290</span>
<span class="normal">2291</span>
<span class="normal">2292</span>
<span class="normal">2293</span>
<span class="normal">2294</span>
<span class="normal">2295</span>
<span class="normal">2296</span>
<span class="normal">2297</span>
<span class="normal">2298</span>
<span class="normal">2299</span>
<span class="normal">2300</span>
<span class="normal">2301</span>
<span class="normal">2302</span>
<span class="normal">2303</span>
<span class="normal">2304</span>
<span class="normal">2305</span>
<span class="normal">2306</span>
<span class="normal">2307</span>
<span class="normal">2308</span>
<span class="normal">2309</span>
<span class="normal">2310</span>
<span class="normal">2311</span>
<span class="normal">2312</span>
<span class="normal">2313</span>
<span class="normal">2314</span>
<span class="normal">2315</span>
<span class="normal">2316</span>
<span class="normal">2317</span>
<span class="normal">2318</span>
<span class="normal">2319</span>
<span class="normal">2320</span>
<span class="normal">2321</span>
<span class="normal">2322</span>
<span class="normal">2323</span>
<span class="normal">2324</span>
<span class="normal">2325</span>
<span class="normal">2326</span>
<span class="normal">2327</span>
<span class="normal">2328</span>
<span class="normal">2329</span>
<span class="normal">2330</span>
<span class="normal">2331</span>
<span class="normal">2332</span>
<span class="normal">2333</span>
<span class="normal">2334</span>
<span class="normal">2335</span>
<span class="normal">2336</span>
<span class="normal">2337</span>
<span class="normal">2338</span>
<span class="normal">2339</span>
<span class="normal">2340</span>
<span class="normal">2341</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">DatasetExplorer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A widget for exploring Earth Engine datasets.</span>
<span class="sd">    The DataExplorer class source code is adapted from &lt;https://bit.ly/48cE24D&gt;.</span>
<span class="sd">    Credit to the original author Renee Johnston (&lt;https://github.com/raj02006&gt;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;GOOGLE_PROJECT_ID&quot;</span><span class="p">,</span>
        <span class="n">google_api_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;GOOGLE_API_KEY&quot;</span><span class="p">,</span>
        <span class="n">vertex_ai_zone</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;us-central1&quot;</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;gemini-1.5-pro&quot;</span><span class="p">,</span>
        <span class="n">embeddings_cloud_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;gs://earthengine-catalog/embeddings/catalog_embeddings.jsonl&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initializes the DatasetExplorer.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_id (str): Google Cloud project ID. Defaults to &quot;GOOGLE_PROJECT_ID&quot;.</span>
<span class="sd">            google_api_key (str): Google API key. Defaults to &quot;GOOGLE_API_KEY&quot;.</span>
<span class="sd">            vertex_ai_zone (str): Vertex AI zone. Defaults to &quot;us-central1&quot;.</span>
<span class="sd">            model (str): Model name for ChatGoogleGenerativeAI. Defaults to &quot;gemini-1.5-pro&quot;.</span>
<span class="sd">            embeddings_cloud_path (str): Cloud path to the embeddings file.</span>
<span class="sd">                Defaults to &quot;gs://earthengine-catalog/embeddings/catalog_embeddings.jsonl&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># @title Setup</span>
        <span class="n">project_name</span> <span class="o">=</span> <span class="n">get_env_var</span><span class="p">(</span><span class="n">project_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">project_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">project_name</span> <span class="o">=</span> <span class="n">get_env_var</span><span class="p">(</span><span class="s2">&quot;EE_PROJECT_ID&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">project_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Please provide a Google Cloud project ID.&quot;</span><span class="p">)</span>

        <span class="n">genai</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="n">get_env_var</span><span class="p">(</span><span class="n">google_api_key</span><span class="p">))</span>

        <span class="n">ee</span><span class="o">.</span><span class="n">Authenticate</span><span class="p">()</span>
        <span class="n">ee</span><span class="o">.</span><span class="n">Initialize</span><span class="p">(</span><span class="n">project</span><span class="o">=</span><span class="n">project_name</span><span class="p">)</span>
        <span class="n">storage_client</span> <span class="o">=</span> <span class="n">storage</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">project</span><span class="o">=</span><span class="n">project_name</span><span class="p">)</span>
        <span class="n">vertexai</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">project</span><span class="o">=</span><span class="n">project_name</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="n">vertex_ai_zone</span><span class="p">)</span>

        <span class="c1"># Make sure geemap initialized correctly.</span>
        <span class="n">ee_initialize</span><span class="p">(</span><span class="n">project</span><span class="o">=</span><span class="n">project_name</span><span class="p">)</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">Map</span><span class="p">(</span><span class="n">draw_ctrl</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">m</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;layer_manager&quot;</span><span class="p">)</span>

        <span class="n">catalog</span> <span class="o">=</span> <span class="n">Catalog</span><span class="p">(</span><span class="n">storage_client</span><span class="p">)</span>

        <span class="c1"># Pre-built embeddings.</span>
        <span class="n">EMBEDDINGS_CLOUD_PATH</span> <span class="o">=</span> <span class="n">embeddings_cloud_path</span>

        <span class="c1"># Copy embeddings from GCS bucket to a local file</span>
        <span class="n">EMBEDDINGS_LOCAL_PATH</span> <span class="o">=</span> <span class="s2">&quot;catalog_embeddings.jsonl&quot;</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">load_embeddings</span><span class="p">(</span>
            <span class="n">gcs_path</span><span class="o">=</span><span class="n">EMBEDDINGS_CLOUD_PATH</span><span class="p">,</span> <span class="n">local_path</span><span class="o">=</span><span class="n">EMBEDDINGS_LOCAL_PATH</span>
        <span class="p">):</span>
            <span class="n">parts</span> <span class="o">=</span> <span class="n">gcs_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
            <span class="n">bucket_name</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">blob_path</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">3</span><span class="p">:])</span>
            <span class="n">bucket</span> <span class="o">=</span> <span class="n">storage_client</span><span class="o">.</span><span class="n">get_bucket</span><span class="p">(</span><span class="n">bucket_name</span><span class="p">)</span>
            <span class="n">blob</span> <span class="o">=</span> <span class="n">bucket</span><span class="o">.</span><span class="n">blob</span><span class="p">(</span><span class="n">blob_path</span><span class="p">)</span>
            <span class="n">blob</span><span class="o">.</span><span class="n">download_to_filename</span><span class="p">(</span><span class="n">local_path</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">local_path</span>

        <span class="c1"># Load our embeddings data into a dataframe:</span>
        <span class="n">local_path</span> <span class="o">=</span> <span class="n">load_embeddings</span><span class="p">(</span><span class="n">EMBEDDINGS_CLOUD_PATH</span><span class="p">,</span> <span class="n">EMBEDDINGS_LOCAL_PATH</span><span class="p">)</span>
        <span class="n">embeddings_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">local_path</span><span class="p">,</span> <span class="n">lines</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">llm</span> <span class="o">=</span> <span class="n">ChatGoogleGenerativeAI</span><span class="p">(</span>
            <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">google_api_key</span><span class="o">=</span><span class="n">get_env_var</span><span class="p">(</span><span class="n">google_api_key</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">local_path</span> <span class="o">=</span> <span class="n">load_embeddings</span><span class="p">(</span><span class="n">EMBEDDINGS_CLOUD_PATH</span><span class="p">,</span> <span class="n">EMBEDDINGS_LOCAL_PATH</span><span class="p">)</span>
        <span class="n">embeddings_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">local_path</span><span class="p">,</span> <span class="n">lines</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">langchain_index</span> <span class="o">=</span> <span class="n">make_langchain_index</span><span class="p">(</span><span class="n">embeddings_df</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ee_index</span> <span class="o">=</span> <span class="n">EarthEngineDatasetIndex</span><span class="p">(</span><span class="n">catalog</span><span class="p">,</span> <span class="n">langchain_index</span><span class="p">,</span> <span class="n">llm</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">widgets</span><span class="o">.</span><span class="n">VBox</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Displays a query interface for searching datasets.</span>

<span class="sd">        Args:</span>
<span class="sd">            query (Optional[str]): The initial query string. Defaults to None.</span>
<span class="sd">            **kwargs (Any): Additional keyword arguments for widget styling.</span>

<span class="sd">        Returns:</span>
<span class="sd">            widgets.VBox: A VBox containing the query input and output display.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">output</span><span class="o">.</span><span class="n">no_vertical_scroll</span><span class="p">()</span>

        <span class="k">if</span> <span class="s2">&quot;style&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;style&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;description_width&quot;</span><span class="p">:</span> <span class="s2">&quot;initial&quot;</span><span class="p">}</span>
        <span class="k">if</span> <span class="s2">&quot;layout&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;layout&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s2">&quot;98%&quot;</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">Question</span><span class="p">(</span><span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Handles the query and displays the dataset search results.</span>

<span class="sd">            Args:</span>
<span class="sd">                query (str): The query string.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_valid_question</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Invalid question. Please try again.&quot;</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="n">datasets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ee_index</span><span class="o">.</span><span class="n">find_top_matches</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
            <span class="c1"># datasets = datasets.sort_by_spatial_resolution().limit(5)</span>
            <span class="n">datasets</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
            <span class="n">dataset_search</span> <span class="o">=</span> <span class="n">DatasetSearchInterface</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">datasets</span><span class="p">)</span>
            <span class="n">dataset_search</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">query</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;How have global land surface temperatures changed over time?&quot;</span>

        <span class="n">query_widget</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span>
            <span class="n">value</span><span class="o">=</span><span class="n">query</span><span class="p">,</span>
            <span class="n">placeholder</span><span class="o">=</span><span class="s2">&quot;Type your query here and press Enter&quot;</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Query:&quot;</span><span class="p">,</span>
            <span class="n">tooltip</span><span class="o">=</span><span class="s2">&quot;Type your query here and press Enter&quot;</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">output_widget</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Output</span><span class="p">()</span>

        <span class="n">display_widget</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">VBox</span><span class="p">([</span><span class="n">query_widget</span><span class="p">,</span> <span class="n">output_widget</span><span class="p">])</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">on_query_change</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Text</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Handles the event when the query text is submitted.</span>

<span class="sd">            Args:</span>
<span class="sd">                text (widgets.Text): The text widget containing the query.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">output_widget</span><span class="o">.</span><span class="n">clear_output</span><span class="p">()</span>
            <span class="k">with</span> <span class="n">output_widget</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Loading ...&quot;</span><span class="p">)</span>
                <span class="n">output_widget</span><span class="o">.</span><span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">Question</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

        <span class="n">query_widget</span><span class="o">.</span><span class="n">on_submit</span><span class="p">(</span><span class="n">on_query_change</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">display_widget</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="geemap.ai.DatasetExplorer.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">project_id</span><span class="o">=</span><span class="s1">&#39;GOOGLE_PROJECT_ID&#39;</span><span class="p">,</span> <span class="n">google_api_key</span><span class="o">=</span><span class="s1">&#39;GOOGLE_API_KEY&#39;</span><span class="p">,</span> <span class="n">vertex_ai_zone</span><span class="o">=</span><span class="s1">&#39;us-central1&#39;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s1">&#39;gemini-1.5-pro&#39;</span><span class="p">,</span> <span class="n">embeddings_cloud_path</span><span class="o">=</span><span class="s1">&#39;gs://earthengine-catalog/embeddings/catalog_embeddings.jsonl&#39;</span><span class="p">)</span></code>

<a href="#geemap.ai.DatasetExplorer.__init__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Initializes the DatasetExplorer.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>project_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Google Cloud project ID. Defaults to "GOOGLE_PROJECT_ID".</p>
              </div>
            </td>
            <td>
                  <code>&#39;GOOGLE_PROJECT_ID&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>google_api_key</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Google API key. Defaults to "GOOGLE_API_KEY".</p>
              </div>
            </td>
            <td>
                  <code>&#39;GOOGLE_API_KEY&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>vertex_ai_zone</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Vertex AI zone. Defaults to "us-central1".</p>
              </div>
            </td>
            <td>
                  <code>&#39;us-central1&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Model name for ChatGoogleGenerativeAI. Defaults to "gemini-1.5-pro".</p>
              </div>
            </td>
            <td>
                  <code>&#39;gemini-1.5-pro&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>embeddings_cloud_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Cloud path to the embeddings file.
Defaults to "gs://earthengine-catalog/embeddings/catalog_embeddings.jsonl".</p>
              </div>
            </td>
            <td>
                  <code>&#39;gs://earthengine-catalog/embeddings/catalog_embeddings.jsonl&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geemap/ai.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2207</span>
<span class="normal">2208</span>
<span class="normal">2209</span>
<span class="normal">2210</span>
<span class="normal">2211</span>
<span class="normal">2212</span>
<span class="normal">2213</span>
<span class="normal">2214</span>
<span class="normal">2215</span>
<span class="normal">2216</span>
<span class="normal">2217</span>
<span class="normal">2218</span>
<span class="normal">2219</span>
<span class="normal">2220</span>
<span class="normal">2221</span>
<span class="normal">2222</span>
<span class="normal">2223</span>
<span class="normal">2224</span>
<span class="normal">2225</span>
<span class="normal">2226</span>
<span class="normal">2227</span>
<span class="normal">2228</span>
<span class="normal">2229</span>
<span class="normal">2230</span>
<span class="normal">2231</span>
<span class="normal">2232</span>
<span class="normal">2233</span>
<span class="normal">2234</span>
<span class="normal">2235</span>
<span class="normal">2236</span>
<span class="normal">2237</span>
<span class="normal">2238</span>
<span class="normal">2239</span>
<span class="normal">2240</span>
<span class="normal">2241</span>
<span class="normal">2242</span>
<span class="normal">2243</span>
<span class="normal">2244</span>
<span class="normal">2245</span>
<span class="normal">2246</span>
<span class="normal">2247</span>
<span class="normal">2248</span>
<span class="normal">2249</span>
<span class="normal">2250</span>
<span class="normal">2251</span>
<span class="normal">2252</span>
<span class="normal">2253</span>
<span class="normal">2254</span>
<span class="normal">2255</span>
<span class="normal">2256</span>
<span class="normal">2257</span>
<span class="normal">2258</span>
<span class="normal">2259</span>
<span class="normal">2260</span>
<span class="normal">2261</span>
<span class="normal">2262</span>
<span class="normal">2263</span>
<span class="normal">2264</span>
<span class="normal">2265</span>
<span class="normal">2266</span>
<span class="normal">2267</span>
<span class="normal">2268</span>
<span class="normal">2269</span>
<span class="normal">2270</span>
<span class="normal">2271</span>
<span class="normal">2272</span>
<span class="normal">2273</span>
<span class="normal">2274</span>
<span class="normal">2275</span>
<span class="normal">2276</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">project_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;GOOGLE_PROJECT_ID&quot;</span><span class="p">,</span>
    <span class="n">google_api_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;GOOGLE_API_KEY&quot;</span><span class="p">,</span>
    <span class="n">vertex_ai_zone</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;us-central1&quot;</span><span class="p">,</span>
    <span class="n">model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;gemini-1.5-pro&quot;</span><span class="p">,</span>
    <span class="n">embeddings_cloud_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;gs://earthengine-catalog/embeddings/catalog_embeddings.jsonl&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initializes the DatasetExplorer.</span>

<span class="sd">    Args:</span>
<span class="sd">        project_id (str): Google Cloud project ID. Defaults to &quot;GOOGLE_PROJECT_ID&quot;.</span>
<span class="sd">        google_api_key (str): Google API key. Defaults to &quot;GOOGLE_API_KEY&quot;.</span>
<span class="sd">        vertex_ai_zone (str): Vertex AI zone. Defaults to &quot;us-central1&quot;.</span>
<span class="sd">        model (str): Model name for ChatGoogleGenerativeAI. Defaults to &quot;gemini-1.5-pro&quot;.</span>
<span class="sd">        embeddings_cloud_path (str): Cloud path to the embeddings file.</span>
<span class="sd">            Defaults to &quot;gs://earthengine-catalog/embeddings/catalog_embeddings.jsonl&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># @title Setup</span>
    <span class="n">project_name</span> <span class="o">=</span> <span class="n">get_env_var</span><span class="p">(</span><span class="n">project_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">project_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">project_name</span> <span class="o">=</span> <span class="n">get_env_var</span><span class="p">(</span><span class="s2">&quot;EE_PROJECT_ID&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">project_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Please provide a Google Cloud project ID.&quot;</span><span class="p">)</span>

    <span class="n">genai</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="n">get_env_var</span><span class="p">(</span><span class="n">google_api_key</span><span class="p">))</span>

    <span class="n">ee</span><span class="o">.</span><span class="n">Authenticate</span><span class="p">()</span>
    <span class="n">ee</span><span class="o">.</span><span class="n">Initialize</span><span class="p">(</span><span class="n">project</span><span class="o">=</span><span class="n">project_name</span><span class="p">)</span>
    <span class="n">storage_client</span> <span class="o">=</span> <span class="n">storage</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">project</span><span class="o">=</span><span class="n">project_name</span><span class="p">)</span>
    <span class="n">vertexai</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">project</span><span class="o">=</span><span class="n">project_name</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="n">vertex_ai_zone</span><span class="p">)</span>

    <span class="c1"># Make sure geemap initialized correctly.</span>
    <span class="n">ee_initialize</span><span class="p">(</span><span class="n">project</span><span class="o">=</span><span class="n">project_name</span><span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">Map</span><span class="p">(</span><span class="n">draw_ctrl</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;layer_manager&quot;</span><span class="p">)</span>

    <span class="n">catalog</span> <span class="o">=</span> <span class="n">Catalog</span><span class="p">(</span><span class="n">storage_client</span><span class="p">)</span>

    <span class="c1"># Pre-built embeddings.</span>
    <span class="n">EMBEDDINGS_CLOUD_PATH</span> <span class="o">=</span> <span class="n">embeddings_cloud_path</span>

    <span class="c1"># Copy embeddings from GCS bucket to a local file</span>
    <span class="n">EMBEDDINGS_LOCAL_PATH</span> <span class="o">=</span> <span class="s2">&quot;catalog_embeddings.jsonl&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">load_embeddings</span><span class="p">(</span>
        <span class="n">gcs_path</span><span class="o">=</span><span class="n">EMBEDDINGS_CLOUD_PATH</span><span class="p">,</span> <span class="n">local_path</span><span class="o">=</span><span class="n">EMBEDDINGS_LOCAL_PATH</span>
    <span class="p">):</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="n">gcs_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
        <span class="n">bucket_name</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">blob_path</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">3</span><span class="p">:])</span>
        <span class="n">bucket</span> <span class="o">=</span> <span class="n">storage_client</span><span class="o">.</span><span class="n">get_bucket</span><span class="p">(</span><span class="n">bucket_name</span><span class="p">)</span>
        <span class="n">blob</span> <span class="o">=</span> <span class="n">bucket</span><span class="o">.</span><span class="n">blob</span><span class="p">(</span><span class="n">blob_path</span><span class="p">)</span>
        <span class="n">blob</span><span class="o">.</span><span class="n">download_to_filename</span><span class="p">(</span><span class="n">local_path</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">local_path</span>

    <span class="c1"># Load our embeddings data into a dataframe:</span>
    <span class="n">local_path</span> <span class="o">=</span> <span class="n">load_embeddings</span><span class="p">(</span><span class="n">EMBEDDINGS_CLOUD_PATH</span><span class="p">,</span> <span class="n">EMBEDDINGS_LOCAL_PATH</span><span class="p">)</span>
    <span class="n">embeddings_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">local_path</span><span class="p">,</span> <span class="n">lines</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">llm</span> <span class="o">=</span> <span class="n">ChatGoogleGenerativeAI</span><span class="p">(</span>
        <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">google_api_key</span><span class="o">=</span><span class="n">get_env_var</span><span class="p">(</span><span class="n">google_api_key</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="n">local_path</span> <span class="o">=</span> <span class="n">load_embeddings</span><span class="p">(</span><span class="n">EMBEDDINGS_CLOUD_PATH</span><span class="p">,</span> <span class="n">EMBEDDINGS_LOCAL_PATH</span><span class="p">)</span>
    <span class="n">embeddings_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">local_path</span><span class="p">,</span> <span class="n">lines</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">langchain_index</span> <span class="o">=</span> <span class="n">make_langchain_index</span><span class="p">(</span><span class="n">embeddings_df</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">ee_index</span> <span class="o">=</span> <span class="n">EarthEngineDatasetIndex</span><span class="p">(</span><span class="n">catalog</span><span class="p">,</span> <span class="n">langchain_index</span><span class="p">,</span> <span class="n">llm</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="geemap.ai.DatasetExplorer.show" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">show</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

<a href="#geemap.ai.DatasetExplorer.show" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Displays a query interface for searching datasets.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>query</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The initial query string. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional keyword arguments for widget styling.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ipywidgets.VBox">VBox</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>widgets.VBox: A VBox containing the query input and output display.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geemap/ai.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2278</span>
<span class="normal">2279</span>
<span class="normal">2280</span>
<span class="normal">2281</span>
<span class="normal">2282</span>
<span class="normal">2283</span>
<span class="normal">2284</span>
<span class="normal">2285</span>
<span class="normal">2286</span>
<span class="normal">2287</span>
<span class="normal">2288</span>
<span class="normal">2289</span>
<span class="normal">2290</span>
<span class="normal">2291</span>
<span class="normal">2292</span>
<span class="normal">2293</span>
<span class="normal">2294</span>
<span class="normal">2295</span>
<span class="normal">2296</span>
<span class="normal">2297</span>
<span class="normal">2298</span>
<span class="normal">2299</span>
<span class="normal">2300</span>
<span class="normal">2301</span>
<span class="normal">2302</span>
<span class="normal">2303</span>
<span class="normal">2304</span>
<span class="normal">2305</span>
<span class="normal">2306</span>
<span class="normal">2307</span>
<span class="normal">2308</span>
<span class="normal">2309</span>
<span class="normal">2310</span>
<span class="normal">2311</span>
<span class="normal">2312</span>
<span class="normal">2313</span>
<span class="normal">2314</span>
<span class="normal">2315</span>
<span class="normal">2316</span>
<span class="normal">2317</span>
<span class="normal">2318</span>
<span class="normal">2319</span>
<span class="normal">2320</span>
<span class="normal">2321</span>
<span class="normal">2322</span>
<span class="normal">2323</span>
<span class="normal">2324</span>
<span class="normal">2325</span>
<span class="normal">2326</span>
<span class="normal">2327</span>
<span class="normal">2328</span>
<span class="normal">2329</span>
<span class="normal">2330</span>
<span class="normal">2331</span>
<span class="normal">2332</span>
<span class="normal">2333</span>
<span class="normal">2334</span>
<span class="normal">2335</span>
<span class="normal">2336</span>
<span class="normal">2337</span>
<span class="normal">2338</span>
<span class="normal">2339</span>
<span class="normal">2340</span>
<span class="normal">2341</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">widgets</span><span class="o">.</span><span class="n">VBox</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Displays a query interface for searching datasets.</span>

<span class="sd">    Args:</span>
<span class="sd">        query (Optional[str]): The initial query string. Defaults to None.</span>
<span class="sd">        **kwargs (Any): Additional keyword arguments for widget styling.</span>

<span class="sd">    Returns:</span>
<span class="sd">        widgets.VBox: A VBox containing the query input and output display.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">output</span><span class="o">.</span><span class="n">no_vertical_scroll</span><span class="p">()</span>

    <span class="k">if</span> <span class="s2">&quot;style&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;style&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;description_width&quot;</span><span class="p">:</span> <span class="s2">&quot;initial&quot;</span><span class="p">}</span>
    <span class="k">if</span> <span class="s2">&quot;layout&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;layout&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s2">&quot;98%&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">Question</span><span class="p">(</span><span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handles the query and displays the dataset search results.</span>

<span class="sd">        Args:</span>
<span class="sd">            query (str): The query string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_valid_question</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Invalid question. Please try again.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">datasets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ee_index</span><span class="o">.</span><span class="n">find_top_matches</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="c1"># datasets = datasets.sort_by_spatial_resolution().limit(5)</span>
        <span class="n">datasets</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
        <span class="n">dataset_search</span> <span class="o">=</span> <span class="n">DatasetSearchInterface</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">datasets</span><span class="p">)</span>
        <span class="n">dataset_search</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">query</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;How have global land surface temperatures changed over time?&quot;</span>

    <span class="n">query_widget</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span>
        <span class="n">value</span><span class="o">=</span><span class="n">query</span><span class="p">,</span>
        <span class="n">placeholder</span><span class="o">=</span><span class="s2">&quot;Type your query here and press Enter&quot;</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Query:&quot;</span><span class="p">,</span>
        <span class="n">tooltip</span><span class="o">=</span><span class="s2">&quot;Type your query here and press Enter&quot;</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">output_widget</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Output</span><span class="p">()</span>

    <span class="n">display_widget</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">VBox</span><span class="p">([</span><span class="n">query_widget</span><span class="p">,</span> <span class="n">output_widget</span><span class="p">])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">on_query_change</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Text</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handles the event when the query text is submitted.</span>

<span class="sd">        Args:</span>
<span class="sd">            text (widgets.Text): The text widget containing the query.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">output_widget</span><span class="o">.</span><span class="n">clear_output</span><span class="p">()</span>
        <span class="k">with</span> <span class="n">output_widget</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Loading ...&quot;</span><span class="p">)</span>
            <span class="n">output_widget</span><span class="o">.</span><span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">Question</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="n">query_widget</span><span class="o">.</span><span class="n">on_submit</span><span class="p">(</span><span class="n">on_query_change</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">display_widget</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="geemap.ai.DatasetSearchInterface" class="doc doc-heading">
            <code>DatasetSearchInterface</code>


<a href="#geemap.ai.DatasetSearchInterface" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">


        <p>Interface for searching and displaying Earth Engine datasets.</p>








              <details class="quote">
                <summary>Source code in <code>geemap/ai.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1878</span>
<span class="normal">1879</span>
<span class="normal">1880</span>
<span class="normal">1881</span>
<span class="normal">1882</span>
<span class="normal">1883</span>
<span class="normal">1884</span>
<span class="normal">1885</span>
<span class="normal">1886</span>
<span class="normal">1887</span>
<span class="normal">1888</span>
<span class="normal">1889</span>
<span class="normal">1890</span>
<span class="normal">1891</span>
<span class="normal">1892</span>
<span class="normal">1893</span>
<span class="normal">1894</span>
<span class="normal">1895</span>
<span class="normal">1896</span>
<span class="normal">1897</span>
<span class="normal">1898</span>
<span class="normal">1899</span>
<span class="normal">1900</span>
<span class="normal">1901</span>
<span class="normal">1902</span>
<span class="normal">1903</span>
<span class="normal">1904</span>
<span class="normal">1905</span>
<span class="normal">1906</span>
<span class="normal">1907</span>
<span class="normal">1908</span>
<span class="normal">1909</span>
<span class="normal">1910</span>
<span class="normal">1911</span>
<span class="normal">1912</span>
<span class="normal">1913</span>
<span class="normal">1914</span>
<span class="normal">1915</span>
<span class="normal">1916</span>
<span class="normal">1917</span>
<span class="normal">1918</span>
<span class="normal">1919</span>
<span class="normal">1920</span>
<span class="normal">1921</span>
<span class="normal">1922</span>
<span class="normal">1923</span>
<span class="normal">1924</span>
<span class="normal">1925</span>
<span class="normal">1926</span>
<span class="normal">1927</span>
<span class="normal">1928</span>
<span class="normal">1929</span>
<span class="normal">1930</span>
<span class="normal">1931</span>
<span class="normal">1932</span>
<span class="normal">1933</span>
<span class="normal">1934</span>
<span class="normal">1935</span>
<span class="normal">1936</span>
<span class="normal">1937</span>
<span class="normal">1938</span>
<span class="normal">1939</span>
<span class="normal">1940</span>
<span class="normal">1941</span>
<span class="normal">1942</span>
<span class="normal">1943</span>
<span class="normal">1944</span>
<span class="normal">1945</span>
<span class="normal">1946</span>
<span class="normal">1947</span>
<span class="normal">1948</span>
<span class="normal">1949</span>
<span class="normal">1950</span>
<span class="normal">1951</span>
<span class="normal">1952</span>
<span class="normal">1953</span>
<span class="normal">1954</span>
<span class="normal">1955</span>
<span class="normal">1956</span>
<span class="normal">1957</span>
<span class="normal">1958</span>
<span class="normal">1959</span>
<span class="normal">1960</span>
<span class="normal">1961</span>
<span class="normal">1962</span>
<span class="normal">1963</span>
<span class="normal">1964</span>
<span class="normal">1965</span>
<span class="normal">1966</span>
<span class="normal">1967</span>
<span class="normal">1968</span>
<span class="normal">1969</span>
<span class="normal">1970</span>
<span class="normal">1971</span>
<span class="normal">1972</span>
<span class="normal">1973</span>
<span class="normal">1974</span>
<span class="normal">1975</span>
<span class="normal">1976</span>
<span class="normal">1977</span>
<span class="normal">1978</span>
<span class="normal">1979</span>
<span class="normal">1980</span>
<span class="normal">1981</span>
<span class="normal">1982</span>
<span class="normal">1983</span>
<span class="normal">1984</span>
<span class="normal">1985</span>
<span class="normal">1986</span>
<span class="normal">1987</span>
<span class="normal">1988</span>
<span class="normal">1989</span>
<span class="normal">1990</span>
<span class="normal">1991</span>
<span class="normal">1992</span>
<span class="normal">1993</span>
<span class="normal">1994</span>
<span class="normal">1995</span>
<span class="normal">1996</span>
<span class="normal">1997</span>
<span class="normal">1998</span>
<span class="normal">1999</span>
<span class="normal">2000</span>
<span class="normal">2001</span>
<span class="normal">2002</span>
<span class="normal">2003</span>
<span class="normal">2004</span>
<span class="normal">2005</span>
<span class="normal">2006</span>
<span class="normal">2007</span>
<span class="normal">2008</span>
<span class="normal">2009</span>
<span class="normal">2010</span>
<span class="normal">2011</span>
<span class="normal">2012</span>
<span class="normal">2013</span>
<span class="normal">2014</span>
<span class="normal">2015</span>
<span class="normal">2016</span>
<span class="normal">2017</span>
<span class="normal">2018</span>
<span class="normal">2019</span>
<span class="normal">2020</span>
<span class="normal">2021</span>
<span class="normal">2022</span>
<span class="normal">2023</span>
<span class="normal">2024</span>
<span class="normal">2025</span>
<span class="normal">2026</span>
<span class="normal">2027</span>
<span class="normal">2028</span>
<span class="normal">2029</span>
<span class="normal">2030</span>
<span class="normal">2031</span>
<span class="normal">2032</span>
<span class="normal">2033</span>
<span class="normal">2034</span>
<span class="normal">2035</span>
<span class="normal">2036</span>
<span class="normal">2037</span>
<span class="normal">2038</span>
<span class="normal">2039</span>
<span class="normal">2040</span>
<span class="normal">2041</span>
<span class="normal">2042</span>
<span class="normal">2043</span>
<span class="normal">2044</span>
<span class="normal">2045</span>
<span class="normal">2046</span>
<span class="normal">2047</span>
<span class="normal">2048</span>
<span class="normal">2049</span>
<span class="normal">2050</span>
<span class="normal">2051</span>
<span class="normal">2052</span>
<span class="normal">2053</span>
<span class="normal">2054</span>
<span class="normal">2055</span>
<span class="normal">2056</span>
<span class="normal">2057</span>
<span class="normal">2058</span>
<span class="normal">2059</span>
<span class="normal">2060</span>
<span class="normal">2061</span>
<span class="normal">2062</span>
<span class="normal">2063</span>
<span class="normal">2064</span>
<span class="normal">2065</span>
<span class="normal">2066</span>
<span class="normal">2067</span>
<span class="normal">2068</span>
<span class="normal">2069</span>
<span class="normal">2070</span>
<span class="normal">2071</span>
<span class="normal">2072</span>
<span class="normal">2073</span>
<span class="normal">2074</span>
<span class="normal">2075</span>
<span class="normal">2076</span>
<span class="normal">2077</span>
<span class="normal">2078</span>
<span class="normal">2079</span>
<span class="normal">2080</span>
<span class="normal">2081</span>
<span class="normal">2082</span>
<span class="normal">2083</span>
<span class="normal">2084</span>
<span class="normal">2085</span>
<span class="normal">2086</span>
<span class="normal">2087</span>
<span class="normal">2088</span>
<span class="normal">2089</span>
<span class="normal">2090</span>
<span class="normal">2091</span>
<span class="normal">2092</span>
<span class="normal">2093</span>
<span class="normal">2094</span>
<span class="normal">2095</span>
<span class="normal">2096</span>
<span class="normal">2097</span>
<span class="normal">2098</span>
<span class="normal">2099</span>
<span class="normal">2100</span>
<span class="normal">2101</span>
<span class="normal">2102</span>
<span class="normal">2103</span>
<span class="normal">2104</span>
<span class="normal">2105</span>
<span class="normal">2106</span>
<span class="normal">2107</span>
<span class="normal">2108</span>
<span class="normal">2109</span>
<span class="normal">2110</span>
<span class="normal">2111</span>
<span class="normal">2112</span>
<span class="normal">2113</span>
<span class="normal">2114</span>
<span class="normal">2115</span>
<span class="normal">2116</span>
<span class="normal">2117</span>
<span class="normal">2118</span>
<span class="normal">2119</span>
<span class="normal">2120</span>
<span class="normal">2121</span>
<span class="normal">2122</span>
<span class="normal">2123</span>
<span class="normal">2124</span>
<span class="normal">2125</span>
<span class="normal">2126</span>
<span class="normal">2127</span>
<span class="normal">2128</span>
<span class="normal">2129</span>
<span class="normal">2130</span>
<span class="normal">2131</span>
<span class="normal">2132</span>
<span class="normal">2133</span>
<span class="normal">2134</span>
<span class="normal">2135</span>
<span class="normal">2136</span>
<span class="normal">2137</span>
<span class="normal">2138</span>
<span class="normal">2139</span>
<span class="normal">2140</span>
<span class="normal">2141</span>
<span class="normal">2142</span>
<span class="normal">2143</span>
<span class="normal">2144</span>
<span class="normal">2145</span>
<span class="normal">2146</span>
<span class="normal">2147</span>
<span class="normal">2148</span>
<span class="normal">2149</span>
<span class="normal">2150</span>
<span class="normal">2151</span>
<span class="normal">2152</span>
<span class="normal">2153</span>
<span class="normal">2154</span>
<span class="normal">2155</span>
<span class="normal">2156</span>
<span class="normal">2157</span>
<span class="normal">2158</span>
<span class="normal">2159</span>
<span class="normal">2160</span>
<span class="normal">2161</span>
<span class="normal">2162</span>
<span class="normal">2163</span>
<span class="normal">2164</span>
<span class="normal">2165</span>
<span class="normal">2166</span>
<span class="normal">2167</span>
<span class="normal">2168</span>
<span class="normal">2169</span>
<span class="normal">2170</span>
<span class="normal">2171</span>
<span class="normal">2172</span>
<span class="normal">2173</span>
<span class="normal">2174</span>
<span class="normal">2175</span>
<span class="normal">2176</span>
<span class="normal">2177</span>
<span class="normal">2178</span>
<span class="normal">2179</span>
<span class="normal">2180</span>
<span class="normal">2181</span>
<span class="normal">2182</span>
<span class="normal">2183</span>
<span class="normal">2184</span>
<span class="normal">2185</span>
<span class="normal">2186</span>
<span class="normal">2187</span>
<span class="normal">2188</span>
<span class="normal">2189</span>
<span class="normal">2190</span>
<span class="normal">2191</span>
<span class="normal">2192</span>
<span class="normal">2193</span>
<span class="normal">2194</span>
<span class="normal">2195</span>
<span class="normal">2196</span>
<span class="normal">2197</span>
<span class="normal">2198</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">DatasetSearchInterface</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Interface for searching and displaying Earth Engine datasets.&quot;&quot;&quot;</span>

    <span class="n">collections</span><span class="p">:</span> <span class="n">CollectionList</span>
    <span class="n">query</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">dataset_table</span><span class="p">:</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Widget</span>
    <span class="n">code_output</span><span class="p">:</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Widget</span>
    <span class="n">details_output</span><span class="p">:</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Widget</span>
    <span class="n">map_output</span><span class="p">:</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Widget</span>
    <span class="n">geemap_instance</span><span class="p">:</span> <span class="n">Map</span>

    <span class="c1"># Parent containers for controlling widget visibility.</span>
    <span class="n">details_code_box</span><span class="p">:</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Widget</span>
    <span class="n">map_widget</span><span class="p">:</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Widget</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">collections</span><span class="p">:</span> <span class="n">CollectionList</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initializes the DatasetSearchInterface.</span>

<span class="sd">        Args:</span>
<span class="sd">            query (str): The search query string.</span>
<span class="sd">            collections (CollectionList): The list of dataset collections.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">query</span> <span class="o">=</span> <span class="n">query</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collections</span> <span class="o">=</span> <span class="n">collections</span>

        <span class="c1"># Create the output widgets</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">code_output</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Output</span><span class="p">(</span><span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s2">&quot;50%&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">details_output</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Output</span><span class="p">(</span>
            <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="s2">&quot;300px&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="s2">&quot;100%&quot;</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Initialize dataset table</span>
        <span class="n">table_html</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_table_html</span><span class="p">(</span><span class="n">collections</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataset_table</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">HTML</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">table_html</span><span class="p">)</span>

        <span class="n">_callback_id</span> <span class="o">=</span> <span class="s2">&quot;dataset-select&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
        <span class="n">output</span><span class="o">.</span><span class="n">register_callback</span><span class="p">(</span><span class="n">_callback_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_outputs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset_select_js_code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dataset_select_js_code</span><span class="p">(</span><span class="n">_callback_id</span><span class="p">)</span>
        <span class="c1"># self._dataset_select_js_code(_callback_id)</span>

        <span class="c1"># Initialize map</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">map_output</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Output</span><span class="p">(</span><span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s2">&quot;100%&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">geemap_instance</span> <span class="o">=</span> <span class="n">Map</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="s2">&quot;600px&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="s2">&quot;100%&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">display</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Display the UI in the cell.&quot;&quot;&quot;</span>
        <span class="c1"># Create title and description with Material Design styling</span>
        <span class="c1"># title = widgets.HTML(value=&#39;&lt;h2 class=&quot;main-title&quot;&gt;Earth Engine Dataset Explorer&lt;/h2&gt;&#39;)</span>

        <span class="c1"># Wrap outputs in a widget box for border styling</span>
        <span class="n">details_widget</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">details_output</span><span class="p">],</span>
            <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span>
                <span class="n">border</span><span class="o">=</span><span class="s2">&quot;1px solid #E0E0E0&quot;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s2">&quot;10px&quot;</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="s2">&quot;5px&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="s2">&quot;100%&quot;</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="n">code_widget</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">code_output</span><span class="p">],</span>
            <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span>
                <span class="n">border</span><span class="o">=</span><span class="s2">&quot;1px solid #E0E0E0&quot;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s2">&quot;10px&quot;</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="s2">&quot;5px&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="s2">&quot;100%&quot;</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">map_widget</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map_output</span><span class="p">],</span>
            <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span>
                <span class="n">border</span><span class="o">=</span><span class="s2">&quot;1px solid #E0E0E0&quot;</span><span class="p">,</span>
                <span class="n">padding</span><span class="o">=</span><span class="s2">&quot;10px&quot;</span><span class="p">,</span>
                <span class="n">margin</span><span class="o">=</span><span class="s2">&quot;5px&quot;</span><span class="p">,</span>
                <span class="n">width</span><span class="o">=</span><span class="s2">&quot;100%&quot;</span><span class="p">,</span>
                <span class="n">height</span><span class="o">=</span><span class="s2">&quot;600x&quot;</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># Create the vertical box for code and details</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">details_code_box</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">VBox</span><span class="p">(</span>
            <span class="p">[</span><span class="n">details_widget</span><span class="p">,</span> <span class="n">code_widget</span><span class="p">],</span>
            <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s2">&quot;50%&quot;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="s2">&quot;600px&quot;</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># Create a horizontal box for map and details/code</span>
        <span class="n">map_details_code_box</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">(</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map_widget</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">details_code_box</span><span class="p">],</span>
            <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span>
                <span class="n">border</span><span class="o">=</span><span class="s2">&quot;1px solid #E0E0E0&quot;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s2">&quot;10px&quot;</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="s2">&quot;5px&quot;</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># Create the main layout with Material Design styling</span>
        <span class="n">main_content</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">VBox</span><span class="p">(</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_table</span><span class="p">,</span> <span class="n">map_details_code_box</span><span class="p">],</span>
            <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span>
                <span class="n">width</span><span class="o">=</span><span class="s2">&quot;100%&quot;</span><span class="p">,</span> <span class="n">border</span><span class="o">=</span><span class="s2">&quot;1px solid #E0E0E0&quot;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s2">&quot;10px&quot;</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="s2">&quot;5px&quot;</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># Add debug panel to the main layout</span>
        <span class="n">main_layout</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">VBox</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="c1"># title,</span>
                <span class="n">main_content</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="s2">&quot;1500px&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="s2">&quot;100%&quot;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s2">&quot;24px&quot;</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># @title CSS</span>
        <span class="c1"># Custom CSS for Material Design styling with enhanced table styling, chat panel, and debug panel</span>
        <span class="n">CSS</span> <span class="o">=</span> <span class="n">syntax</span><span class="o">.</span><span class="n">css</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        @import url(&#39;https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&amp;display=swap&#39;);</span>

<span class="sd">        body {</span>
<span class="sd">            font-family: &#39;Roboto&#39;, sans-serif;</span>
<span class="sd">            margin: 0;</span>
<span class="sd">            padding: 0;</span>
<span class="sd">        }</span>

<span class="sd">        .main-title {</span>
<span class="sd">            font-size: 24px;</span>
<span class="sd">            font-weight: 500;</span>
<span class="sd">            color: #212121;</span>
<span class="sd">            margin-bottom: 16px;</span>
<span class="sd">        }</span>

<span class="sd">        .custom-title {</span>
<span class="sd">            font-size: 18px;</span>
<span class="sd">            font-weight: 500;</span>
<span class="sd">            color: #212121;</span>
<span class="sd">            margin-bottom: 12px;</span>
<span class="sd">        }</span>

<span class="sd">        .details-text {</span>
<span class="sd">            font-size: 14px;</span>
<span class="sd">            color: #616161;</span>
<span class="sd">            line-height: 1.5;</span>
<span class="sd">        }</span>

<span class="sd">        .custom-table {</span>
<span class="sd">            width: 100%;</span>
<span class="sd">            border-collapse: collapse;</span>
<span class="sd">            margin-bottom: 24px;</span>
<span class="sd">            font-family: &#39;Roboto&#39;, sans-serif;</span>
<span class="sd">        }</span>
<span class="sd">        .custom-table th, .custom-table td {</span>
<span class="sd">            text-align: left;</span>
<span class="sd">            padding: 12px;</span>
<span class="sd">            border-bottom: 1px solid #E0E0E0;</span>
<span class="sd">        }</span>
<span class="sd">        .custom-table th {</span>
<span class="sd">            background-color: #F5F5F5;</span>
<span class="sd">            font-weight: 500;</span>
<span class="sd">            color: #212121;</span>
<span class="sd">        }</span>
<span class="sd">        .custom-table tr:hover {</span>
<span class="sd">            background-color: #E3F2FD;</span>
<span class="sd">        }</span>
<span class="sd">        .custom-table tr.selected {</span>
<span class="sd">            background-color: #BBDEFB;</span>
<span class="sd">        }</span>

<span class="sd">        /* Ensure borders are visible */</span>
<span class="sd">        .jupyter-widgets.widget-box {</span>
<span class="sd">            border: 1px solid #E0E0E0 !important;</span>
<span class="sd">            overflow: auto;</span>
<span class="sd">        }</span>

<span class="sd">        /* Make the map span full width */</span>
<span class="sd">        .geemap-container {</span>
<span class="sd">            width: 100% !important;</span>
<span class="sd">            height: 600px !important;</span>
<span class="sd">        }</span>

<span class="sd">        # Disable table clicks while things are loading</span>
<span class="sd">        .disabled {</span>
<span class="sd">        pointer-events: none;</span>
<span class="sd">        /* You might also want to visually indicate the disabled state */</span>
<span class="sd">        opacity: 0.5;</span>
<span class="sd">        cursor: default;</span>
<span class="sd">        }</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Display the widget</span>
        <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&lt;style&gt;</span><span class="si">{</span><span class="n">CSS</span><span class="si">}</span><span class="s2">&lt;/style&gt;&quot;</span><span class="p">))</span>
        <span class="n">display</span><span class="p">(</span><span class="n">main_layout</span><span class="p">)</span>
        <span class="n">display</span><span class="p">(</span><span class="n">Javascript</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset_select_js_code</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_build_table_html</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collections</span><span class="p">:</span> <span class="n">CollectionList</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Builds the HTML for the dataset table.</span>

<span class="sd">        Args:</span>
<span class="sd">            collections (CollectionList): The list of dataset collections.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The HTML string for the dataset table.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">table_html</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    &lt;table class=&quot;custom-table&quot;&gt;</span>
<span class="s2">        &lt;tr&gt;</span>
<span class="s2">            &lt;th&gt;Dataset ID&lt;/th&gt;</span>
<span class="s2">            &lt;th&gt; Name &lt;/th&gt;</span>
<span class="s2">            &lt;th&gt;Temporal Resolution&lt;/th&gt;</span>
<span class="s2">            &lt;th&gt;Spatial Resolution (m)&lt;/th&gt;</span>
<span class="s2">            &lt;th&gt;Earliest&lt;/th&gt;</span>
<span class="s2">            &lt;th&gt;Latest&lt;/th&gt;</span>
<span class="s2">        &lt;/tr&gt;</span>
<span class="s2">    &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="n">collections</span><span class="p">:</span>
            <span class="n">table_html</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        &lt;tr data-dataset=&quot;</span><span class="si">{</span><span class="n">dataset</span><span class="o">.</span><span class="n">public_id</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;&gt;</span>
<span class="s2">            &lt;td&gt;</span><span class="si">{</span><span class="n">dataset</span><span class="o">.</span><span class="n">public_id</span><span class="p">()</span><span class="si">}</span><span class="s2">&lt;/td&gt;</span>
<span class="s2">            &lt;td&gt;</span><span class="si">{</span><span class="n">dataset</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&lt;/td&gt;</span>
<span class="s2">            &lt;td&gt;</span><span class="si">{</span><span class="n">dataset</span><span class="o">.</span><span class="n">temporal_resolution_str</span><span class="p">()</span><span class="si">}</span><span class="s2">&lt;/td&gt;</span>
<span class="s2">            &lt;td&gt;</span><span class="si">{</span><span class="n">dataset</span><span class="o">.</span><span class="n">spatial_resolution_m</span><span class="p">()</span><span class="si">}</span><span class="s2">&lt;/td&gt;</span>
<span class="s2">            &lt;td&gt;</span><span class="si">{</span><span class="n">dataset</span><span class="o">.</span><span class="n">start_str</span><span class="p">()</span><span class="si">}</span><span class="s2">&lt;/td&gt;</span>
<span class="s2">            &lt;td&gt;</span><span class="si">{</span><span class="n">dataset</span><span class="o">.</span><span class="n">end_str</span><span class="p">()</span><span class="si">}</span><span class="s2">&lt;/td&gt;</span>
<span class="s2">        &lt;/tr&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>

        <span class="n">table_html</span> <span class="o">+=</span> <span class="s2">&quot;&lt;/table&gt;&quot;</span>
        <span class="k">return</span> <span class="n">table_html</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update_outputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selected_dataset</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Updates the output widgets based on the selected dataset.</span>

<span class="sd">        Args:</span>
<span class="sd">            selected_dataset (str): The ID of the selected dataset.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">collection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">filter_by_ids</span><span class="p">([</span><span class="n">selected_dataset</span><span class="p">])</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">collection</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">details_code_box</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s2">&quot;hidden&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">map_widget</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s2">&quot;hidden&quot;</span>
            <span class="k">return</span>

        <span class="n">dataset</span> <span class="o">=</span> <span class="n">collection</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Clear everything when a new dataset is selected.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">map_output</span><span class="o">.</span><span class="n">clear_output</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">code_output</span><span class="o">.</span><span class="n">clear_output</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">details_output</span><span class="o">.</span><span class="n">clear_output</span><span class="p">()</span>
        <span class="c1"># Clear previous layers. Keep only the base layer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">geemap_instance</span><span class="o">.</span><span class="n">layers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geemap_instance</span><span class="o">.</span><span class="n">layers</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_output</span><span class="p">:</span>
            <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="s2">&quot;&lt;h3&gt;Loading...&lt;/h3&gt;&quot;</span><span class="p">))</span>
            <span class="n">code</span> <span class="o">=</span> <span class="n">fix_ee_python_code</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">python_code</span><span class="p">(),</span> <span class="n">ee</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">geemap_instance</span><span class="p">)</span>
            <span class="n">llm_thoughts</span> <span class="o">=</span> <span class="n">explain_relevance_from_stac_json</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">,</span> <span class="n">dataset</span><span class="o">.</span><span class="n">stac_json</span>
            <span class="p">)</span>

        <span class="c1"># Code and LLM thought content is now fully loaded.</span>
        <span class="c1"># We ought to make this asynchronous in another version</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">map_output</span><span class="o">.</span><span class="n">clear_output</span><span class="p">()</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">code_output</span><span class="p">:</span>
            <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="s1">&#39;&lt;div class=&quot;custom-title&quot;&gt;Earth Engine Code&lt;/div&gt;&#39;</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">details_output</span><span class="p">:</span>
            <span class="c1"># display(HTML(&#39;&lt;h3&gt;Thinking...&lt;/h3&gt;&#39;))</span>
            <span class="c1"># self.details_output.clear_output()</span>
            <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="s1">&#39;&lt;div class=&quot;custom-title&quot;&gt;Thoughts with Gemini&lt;/div&gt;&#39;</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">llm_thoughts</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_output</span><span class="p">:</span>
            <span class="n">display</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geemap_instance</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">details_code_box</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s2">&quot;visible&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">map_widget</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s2">&quot;visible&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_dataset_select_js_code</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callback_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generates JavaScript code for handling dataset selection.</span>

<span class="sd">        Args:</span>
<span class="sd">            callback_id (str): The callback ID for the dataset selection.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The JavaScript code as a string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Template</span><span class="p">(</span>
            <span class="n">syntax</span><span class="o">.</span><span class="n">javascript</span><span class="p">(</span>
<span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    function initializeTableInteraction() {</span>
<span class="sd">        const table = document.querySelector(&#39;.custom-table&#39;);</span>
<span class="sd">        if (!table) {</span>
<span class="sd">            console.error(&#39;Table not found&#39;);</span>
<span class="sd">            return;</span>
<span class="sd">        }</span>

<span class="sd">        function selectRow(row) {</span>
<span class="sd">            // Remove selection from previously selected row</span>
<span class="sd">            const prevSelected = table.querySelector(&#39;tr.selected&#39;);</span>
<span class="sd">            if (prevSelected) prevSelected.classList.remove(&#39;selected&#39;);</span>

<span class="sd">            // Add selection to the new row</span>
<span class="sd">            row.classList.add(&#39;selected&#39;);</span>
<span class="sd">            const selectedDataset = row.dataset.dataset;</span>
<span class="sd">            console.log(&#39;Selected dataset:&#39;, selectedDataset);</span>
<span class="sd">            google.colab.kernel.invokeFunction(&#39;{{callback_id}}&#39;, [selectedDataset], {});</span>

<span class="sd">        }</span>

<span class="sd">        table.addEventListener(&#39;click&#39;, (event) =&gt; {</span>
<span class="sd">            const row = event.target.closest(&#39;tr&#39;);</span>
<span class="sd">            if (!row || !row.dataset.dataset) return;</span>
<span class="sd">            selectRow(row);</span>
<span class="sd">        });</span>

<span class="sd">        // Select the first row by default</span>
<span class="sd">        const firstRow = table.querySelector(&#39;tr[data-dataset]&#39;);</span>
<span class="sd">        if (firstRow) {</span>
<span class="sd">            selectRow(firstRow);</span>
<span class="sd">        }</span>
<span class="sd">    }</span>

<span class="sd">    // Run the initialization function after a short delay to ensure the DOM is ready</span>
<span class="sd">    setTimeout(initializeTableInteraction, 1000);</span>
<span class="sd">    &quot;&quot;&quot;</span>
            <span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">callback_id</span><span class="o">=</span><span class="n">callback_id</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="geemap.ai.DatasetSearchInterface.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">collections</span><span class="p">)</span></code>

<a href="#geemap.ai.DatasetSearchInterface.__init__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Initializes the DatasetSearchInterface.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>query</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The search query string.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>collections</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="CollectionList (geemap.ai.CollectionList)" href="#geemap.ai.CollectionList">CollectionList</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The list of dataset collections.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geemap/ai.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1893</span>
<span class="normal">1894</span>
<span class="normal">1895</span>
<span class="normal">1896</span>
<span class="normal">1897</span>
<span class="normal">1898</span>
<span class="normal">1899</span>
<span class="normal">1900</span>
<span class="normal">1901</span>
<span class="normal">1902</span>
<span class="normal">1903</span>
<span class="normal">1904</span>
<span class="normal">1905</span>
<span class="normal">1906</span>
<span class="normal">1907</span>
<span class="normal">1908</span>
<span class="normal">1909</span>
<span class="normal">1910</span>
<span class="normal">1911</span>
<span class="normal">1912</span>
<span class="normal">1913</span>
<span class="normal">1914</span>
<span class="normal">1915</span>
<span class="normal">1916</span>
<span class="normal">1917</span>
<span class="normal">1918</span>
<span class="normal">1919</span>
<span class="normal">1920</span>
<span class="normal">1921</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">collections</span><span class="p">:</span> <span class="n">CollectionList</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initializes the DatasetSearchInterface.</span>

<span class="sd">    Args:</span>
<span class="sd">        query (str): The search query string.</span>
<span class="sd">        collections (CollectionList): The list of dataset collections.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">query</span> <span class="o">=</span> <span class="n">query</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">collections</span> <span class="o">=</span> <span class="n">collections</span>

    <span class="c1"># Create the output widgets</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">code_output</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Output</span><span class="p">(</span><span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s2">&quot;50%&quot;</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">details_output</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Output</span><span class="p">(</span>
        <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="s2">&quot;300px&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="s2">&quot;100%&quot;</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># Initialize dataset table</span>
    <span class="n">table_html</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_table_html</span><span class="p">(</span><span class="n">collections</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dataset_table</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">HTML</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">table_html</span><span class="p">)</span>

    <span class="n">_callback_id</span> <span class="o">=</span> <span class="s2">&quot;dataset-select&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
    <span class="n">output</span><span class="o">.</span><span class="n">register_callback</span><span class="p">(</span><span class="n">_callback_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_outputs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_dataset_select_js_code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dataset_select_js_code</span><span class="p">(</span><span class="n">_callback_id</span><span class="p">)</span>
    <span class="c1"># self._dataset_select_js_code(_callback_id)</span>

    <span class="c1"># Initialize map</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">map_output</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Output</span><span class="p">(</span><span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s2">&quot;100%&quot;</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">geemap_instance</span> <span class="o">=</span> <span class="n">Map</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="s2">&quot;600px&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="s2">&quot;100%&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="geemap.ai.DatasetSearchInterface.display" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">display</span><span class="p">()</span></code>

<a href="#geemap.ai.DatasetSearchInterface.display" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Display the UI in the cell.</p>


            <details class="quote">
              <summary>Source code in <code>geemap/ai.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1923</span>
<span class="normal">1924</span>
<span class="normal">1925</span>
<span class="normal">1926</span>
<span class="normal">1927</span>
<span class="normal">1928</span>
<span class="normal">1929</span>
<span class="normal">1930</span>
<span class="normal">1931</span>
<span class="normal">1932</span>
<span class="normal">1933</span>
<span class="normal">1934</span>
<span class="normal">1935</span>
<span class="normal">1936</span>
<span class="normal">1937</span>
<span class="normal">1938</span>
<span class="normal">1939</span>
<span class="normal">1940</span>
<span class="normal">1941</span>
<span class="normal">1942</span>
<span class="normal">1943</span>
<span class="normal">1944</span>
<span class="normal">1945</span>
<span class="normal">1946</span>
<span class="normal">1947</span>
<span class="normal">1948</span>
<span class="normal">1949</span>
<span class="normal">1950</span>
<span class="normal">1951</span>
<span class="normal">1952</span>
<span class="normal">1953</span>
<span class="normal">1954</span>
<span class="normal">1955</span>
<span class="normal">1956</span>
<span class="normal">1957</span>
<span class="normal">1958</span>
<span class="normal">1959</span>
<span class="normal">1960</span>
<span class="normal">1961</span>
<span class="normal">1962</span>
<span class="normal">1963</span>
<span class="normal">1964</span>
<span class="normal">1965</span>
<span class="normal">1966</span>
<span class="normal">1967</span>
<span class="normal">1968</span>
<span class="normal">1969</span>
<span class="normal">1970</span>
<span class="normal">1971</span>
<span class="normal">1972</span>
<span class="normal">1973</span>
<span class="normal">1974</span>
<span class="normal">1975</span>
<span class="normal">1976</span>
<span class="normal">1977</span>
<span class="normal">1978</span>
<span class="normal">1979</span>
<span class="normal">1980</span>
<span class="normal">1981</span>
<span class="normal">1982</span>
<span class="normal">1983</span>
<span class="normal">1984</span>
<span class="normal">1985</span>
<span class="normal">1986</span>
<span class="normal">1987</span>
<span class="normal">1988</span>
<span class="normal">1989</span>
<span class="normal">1990</span>
<span class="normal">1991</span>
<span class="normal">1992</span>
<span class="normal">1993</span>
<span class="normal">1994</span>
<span class="normal">1995</span>
<span class="normal">1996</span>
<span class="normal">1997</span>
<span class="normal">1998</span>
<span class="normal">1999</span>
<span class="normal">2000</span>
<span class="normal">2001</span>
<span class="normal">2002</span>
<span class="normal">2003</span>
<span class="normal">2004</span>
<span class="normal">2005</span>
<span class="normal">2006</span>
<span class="normal">2007</span>
<span class="normal">2008</span>
<span class="normal">2009</span>
<span class="normal">2010</span>
<span class="normal">2011</span>
<span class="normal">2012</span>
<span class="normal">2013</span>
<span class="normal">2014</span>
<span class="normal">2015</span>
<span class="normal">2016</span>
<span class="normal">2017</span>
<span class="normal">2018</span>
<span class="normal">2019</span>
<span class="normal">2020</span>
<span class="normal">2021</span>
<span class="normal">2022</span>
<span class="normal">2023</span>
<span class="normal">2024</span>
<span class="normal">2025</span>
<span class="normal">2026</span>
<span class="normal">2027</span>
<span class="normal">2028</span>
<span class="normal">2029</span>
<span class="normal">2030</span>
<span class="normal">2031</span>
<span class="normal">2032</span>
<span class="normal">2033</span>
<span class="normal">2034</span>
<span class="normal">2035</span>
<span class="normal">2036</span>
<span class="normal">2037</span>
<span class="normal">2038</span>
<span class="normal">2039</span>
<span class="normal">2040</span>
<span class="normal">2041</span>
<span class="normal">2042</span>
<span class="normal">2043</span>
<span class="normal">2044</span>
<span class="normal">2045</span>
<span class="normal">2046</span>
<span class="normal">2047</span>
<span class="normal">2048</span>
<span class="normal">2049</span>
<span class="normal">2050</span>
<span class="normal">2051</span>
<span class="normal">2052</span>
<span class="normal">2053</span>
<span class="normal">2054</span>
<span class="normal">2055</span>
<span class="normal">2056</span>
<span class="normal">2057</span>
<span class="normal">2058</span>
<span class="normal">2059</span>
<span class="normal">2060</span>
<span class="normal">2061</span>
<span class="normal">2062</span>
<span class="normal">2063</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">display</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Display the UI in the cell.&quot;&quot;&quot;</span>
    <span class="c1"># Create title and description with Material Design styling</span>
    <span class="c1"># title = widgets.HTML(value=&#39;&lt;h2 class=&quot;main-title&quot;&gt;Earth Engine Dataset Explorer&lt;/h2&gt;&#39;)</span>

    <span class="c1"># Wrap outputs in a widget box for border styling</span>
    <span class="n">details_widget</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span>
        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">details_output</span><span class="p">],</span>
        <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span>
            <span class="n">border</span><span class="o">=</span><span class="s2">&quot;1px solid #E0E0E0&quot;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s2">&quot;10px&quot;</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="s2">&quot;5px&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="s2">&quot;100%&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">code_widget</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span>
        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">code_output</span><span class="p">],</span>
        <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span>
            <span class="n">border</span><span class="o">=</span><span class="s2">&quot;1px solid #E0E0E0&quot;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s2">&quot;10px&quot;</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="s2">&quot;5px&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="s2">&quot;100%&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">map_widget</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span>
        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map_output</span><span class="p">],</span>
        <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span>
            <span class="n">border</span><span class="o">=</span><span class="s2">&quot;1px solid #E0E0E0&quot;</span><span class="p">,</span>
            <span class="n">padding</span><span class="o">=</span><span class="s2">&quot;10px&quot;</span><span class="p">,</span>
            <span class="n">margin</span><span class="o">=</span><span class="s2">&quot;5px&quot;</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="s2">&quot;100%&quot;</span><span class="p">,</span>
            <span class="n">height</span><span class="o">=</span><span class="s2">&quot;600x&quot;</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>

    <span class="c1"># Create the vertical box for code and details</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">details_code_box</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">VBox</span><span class="p">(</span>
        <span class="p">[</span><span class="n">details_widget</span><span class="p">,</span> <span class="n">code_widget</span><span class="p">],</span>
        <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s2">&quot;50%&quot;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="s2">&quot;600px&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="c1"># Create a horizontal box for map and details/code</span>
    <span class="n">map_details_code_box</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">(</span>
        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map_widget</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">details_code_box</span><span class="p">],</span>
        <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span>
            <span class="n">border</span><span class="o">=</span><span class="s2">&quot;1px solid #E0E0E0&quot;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s2">&quot;10px&quot;</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="s2">&quot;5px&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>

    <span class="c1"># Create the main layout with Material Design styling</span>
    <span class="n">main_content</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">VBox</span><span class="p">(</span>
        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_table</span><span class="p">,</span> <span class="n">map_details_code_box</span><span class="p">],</span>
        <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span>
            <span class="n">width</span><span class="o">=</span><span class="s2">&quot;100%&quot;</span><span class="p">,</span> <span class="n">border</span><span class="o">=</span><span class="s2">&quot;1px solid #E0E0E0&quot;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s2">&quot;10px&quot;</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="s2">&quot;5px&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>

    <span class="c1"># Add debug panel to the main layout</span>
    <span class="n">main_layout</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">VBox</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="c1"># title,</span>
            <span class="n">main_content</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="s2">&quot;1500px&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="s2">&quot;100%&quot;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s2">&quot;24px&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="c1"># @title CSS</span>
    <span class="c1"># Custom CSS for Material Design styling with enhanced table styling, chat panel, and debug panel</span>
    <span class="n">CSS</span> <span class="o">=</span> <span class="n">syntax</span><span class="o">.</span><span class="n">css</span><span class="p">(</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    @import url(&#39;https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&amp;display=swap&#39;);</span>

<span class="sd">    body {</span>
<span class="sd">        font-family: &#39;Roboto&#39;, sans-serif;</span>
<span class="sd">        margin: 0;</span>
<span class="sd">        padding: 0;</span>
<span class="sd">    }</span>

<span class="sd">    .main-title {</span>
<span class="sd">        font-size: 24px;</span>
<span class="sd">        font-weight: 500;</span>
<span class="sd">        color: #212121;</span>
<span class="sd">        margin-bottom: 16px;</span>
<span class="sd">    }</span>

<span class="sd">    .custom-title {</span>
<span class="sd">        font-size: 18px;</span>
<span class="sd">        font-weight: 500;</span>
<span class="sd">        color: #212121;</span>
<span class="sd">        margin-bottom: 12px;</span>
<span class="sd">    }</span>

<span class="sd">    .details-text {</span>
<span class="sd">        font-size: 14px;</span>
<span class="sd">        color: #616161;</span>
<span class="sd">        line-height: 1.5;</span>
<span class="sd">    }</span>

<span class="sd">    .custom-table {</span>
<span class="sd">        width: 100%;</span>
<span class="sd">        border-collapse: collapse;</span>
<span class="sd">        margin-bottom: 24px;</span>
<span class="sd">        font-family: &#39;Roboto&#39;, sans-serif;</span>
<span class="sd">    }</span>
<span class="sd">    .custom-table th, .custom-table td {</span>
<span class="sd">        text-align: left;</span>
<span class="sd">        padding: 12px;</span>
<span class="sd">        border-bottom: 1px solid #E0E0E0;</span>
<span class="sd">    }</span>
<span class="sd">    .custom-table th {</span>
<span class="sd">        background-color: #F5F5F5;</span>
<span class="sd">        font-weight: 500;</span>
<span class="sd">        color: #212121;</span>
<span class="sd">    }</span>
<span class="sd">    .custom-table tr:hover {</span>
<span class="sd">        background-color: #E3F2FD;</span>
<span class="sd">    }</span>
<span class="sd">    .custom-table tr.selected {</span>
<span class="sd">        background-color: #BBDEFB;</span>
<span class="sd">    }</span>

<span class="sd">    /* Ensure borders are visible */</span>
<span class="sd">    .jupyter-widgets.widget-box {</span>
<span class="sd">        border: 1px solid #E0E0E0 !important;</span>
<span class="sd">        overflow: auto;</span>
<span class="sd">    }</span>

<span class="sd">    /* Make the map span full width */</span>
<span class="sd">    .geemap-container {</span>
<span class="sd">        width: 100% !important;</span>
<span class="sd">        height: 600px !important;</span>
<span class="sd">    }</span>

<span class="sd">    # Disable table clicks while things are loading</span>
<span class="sd">    .disabled {</span>
<span class="sd">    pointer-events: none;</span>
<span class="sd">    /* You might also want to visually indicate the disabled state */</span>
<span class="sd">    opacity: 0.5;</span>
<span class="sd">    cursor: default;</span>
<span class="sd">    }</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="p">)</span>

    <span class="c1"># Display the widget</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&lt;style&gt;</span><span class="si">{</span><span class="n">CSS</span><span class="si">}</span><span class="s2">&lt;/style&gt;&quot;</span><span class="p">))</span>
    <span class="n">display</span><span class="p">(</span><span class="n">main_layout</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">Javascript</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset_select_js_code</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="geemap.ai.DatasetSearchInterface.update_outputs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_outputs</span><span class="p">(</span><span class="n">selected_dataset</span><span class="p">)</span></code>

<a href="#geemap.ai.DatasetSearchInterface.update_outputs" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Updates the output widgets based on the selected dataset.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>selected_dataset</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The ID of the selected dataset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geemap/ai.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2100</span>
<span class="normal">2101</span>
<span class="normal">2102</span>
<span class="normal">2103</span>
<span class="normal">2104</span>
<span class="normal">2105</span>
<span class="normal">2106</span>
<span class="normal">2107</span>
<span class="normal">2108</span>
<span class="normal">2109</span>
<span class="normal">2110</span>
<span class="normal">2111</span>
<span class="normal">2112</span>
<span class="normal">2113</span>
<span class="normal">2114</span>
<span class="normal">2115</span>
<span class="normal">2116</span>
<span class="normal">2117</span>
<span class="normal">2118</span>
<span class="normal">2119</span>
<span class="normal">2120</span>
<span class="normal">2121</span>
<span class="normal">2122</span>
<span class="normal">2123</span>
<span class="normal">2124</span>
<span class="normal">2125</span>
<span class="normal">2126</span>
<span class="normal">2127</span>
<span class="normal">2128</span>
<span class="normal">2129</span>
<span class="normal">2130</span>
<span class="normal">2131</span>
<span class="normal">2132</span>
<span class="normal">2133</span>
<span class="normal">2134</span>
<span class="normal">2135</span>
<span class="normal">2136</span>
<span class="normal">2137</span>
<span class="normal">2138</span>
<span class="normal">2139</span>
<span class="normal">2140</span>
<span class="normal">2141</span>
<span class="normal">2142</span>
<span class="normal">2143</span>
<span class="normal">2144</span>
<span class="normal">2145</span>
<span class="normal">2146</span>
<span class="normal">2147</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">update_outputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selected_dataset</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Updates the output widgets based on the selected dataset.</span>

<span class="sd">    Args:</span>
<span class="sd">        selected_dataset (str): The ID of the selected dataset.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">collection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">filter_by_ids</span><span class="p">([</span><span class="n">selected_dataset</span><span class="p">])</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">collection</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">details_code_box</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s2">&quot;hidden&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">map_widget</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s2">&quot;hidden&quot;</span>
        <span class="k">return</span>

    <span class="n">dataset</span> <span class="o">=</span> <span class="n">collection</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Clear everything when a new dataset is selected.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">map_output</span><span class="o">.</span><span class="n">clear_output</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">code_output</span><span class="o">.</span><span class="n">clear_output</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">details_output</span><span class="o">.</span><span class="n">clear_output</span><span class="p">()</span>
    <span class="c1"># Clear previous layers. Keep only the base layer</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">geemap_instance</span><span class="o">.</span><span class="n">layers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geemap_instance</span><span class="o">.</span><span class="n">layers</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_output</span><span class="p">:</span>
        <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="s2">&quot;&lt;h3&gt;Loading...&lt;/h3&gt;&quot;</span><span class="p">))</span>
        <span class="n">code</span> <span class="o">=</span> <span class="n">fix_ee_python_code</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">python_code</span><span class="p">(),</span> <span class="n">ee</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">geemap_instance</span><span class="p">)</span>
        <span class="n">llm_thoughts</span> <span class="o">=</span> <span class="n">explain_relevance_from_stac_json</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">,</span> <span class="n">dataset</span><span class="o">.</span><span class="n">stac_json</span>
        <span class="p">)</span>

    <span class="c1"># Code and LLM thought content is now fully loaded.</span>
    <span class="c1"># We ought to make this asynchronous in another version</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">map_output</span><span class="o">.</span><span class="n">clear_output</span><span class="p">()</span>

    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">code_output</span><span class="p">:</span>
        <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="s1">&#39;&lt;div class=&quot;custom-title&quot;&gt;Earth Engine Code&lt;/div&gt;&#39;</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>

    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">details_output</span><span class="p">:</span>
        <span class="c1"># display(HTML(&#39;&lt;h3&gt;Thinking...&lt;/h3&gt;&#39;))</span>
        <span class="c1"># self.details_output.clear_output()</span>
        <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="s1">&#39;&lt;div class=&quot;custom-title&quot;&gt;Thoughts with Gemini&lt;/div&gt;&#39;</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">llm_thoughts</span><span class="p">)</span>

    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_output</span><span class="p">:</span>
        <span class="n">display</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geemap_instance</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">details_code_box</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s2">&quot;visible&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">map_widget</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s2">&quot;visible&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="geemap.ai.EarthEngineDatasetIndex" class="doc doc-heading">
            <code>EarthEngineDatasetIndex</code>


<a href="#geemap.ai.EarthEngineDatasetIndex" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">


        <p>Class for indexing and searching Earth Engine datasets.</p>








              <details class="quote">
                <summary>Source code in <code>geemap/ai.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span>
<span class="normal">1599</span>
<span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span>
<span class="normal">1603</span>
<span class="normal">1604</span>
<span class="normal">1605</span>
<span class="normal">1606</span>
<span class="normal">1607</span>
<span class="normal">1608</span>
<span class="normal">1609</span>
<span class="normal">1610</span>
<span class="normal">1611</span>
<span class="normal">1612</span>
<span class="normal">1613</span>
<span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span>
<span class="normal">1622</span>
<span class="normal">1623</span>
<span class="normal">1624</span>
<span class="normal">1625</span>
<span class="normal">1626</span>
<span class="normal">1627</span>
<span class="normal">1628</span>
<span class="normal">1629</span>
<span class="normal">1630</span>
<span class="normal">1631</span>
<span class="normal">1632</span>
<span class="normal">1633</span>
<span class="normal">1634</span>
<span class="normal">1635</span>
<span class="normal">1636</span>
<span class="normal">1637</span>
<span class="normal">1638</span>
<span class="normal">1639</span>
<span class="normal">1640</span>
<span class="normal">1641</span>
<span class="normal">1642</span>
<span class="normal">1643</span>
<span class="normal">1644</span>
<span class="normal">1645</span>
<span class="normal">1646</span>
<span class="normal">1647</span>
<span class="normal">1648</span>
<span class="normal">1649</span>
<span class="normal">1650</span>
<span class="normal">1651</span>
<span class="normal">1652</span>
<span class="normal">1653</span>
<span class="normal">1654</span>
<span class="normal">1655</span>
<span class="normal">1656</span>
<span class="normal">1657</span>
<span class="normal">1658</span>
<span class="normal">1659</span>
<span class="normal">1660</span>
<span class="normal">1661</span>
<span class="normal">1662</span>
<span class="normal">1663</span>
<span class="normal">1664</span>
<span class="normal">1665</span>
<span class="normal">1666</span>
<span class="normal">1667</span>
<span class="normal">1668</span>
<span class="normal">1669</span>
<span class="normal">1670</span>
<span class="normal">1671</span>
<span class="normal">1672</span>
<span class="normal">1673</span>
<span class="normal">1674</span>
<span class="normal">1675</span>
<span class="normal">1676</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">EarthEngineDatasetIndex</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class for indexing and searching Earth Engine datasets.&quot;&quot;&quot;</span>

    <span class="n">index</span><span class="p">:</span> <span class="n">VectorStoreIndexWrapper</span>
    <span class="n">vectorstore</span><span class="p">:</span> <span class="n">VectorStore</span>
    <span class="n">data_catalog</span><span class="p">:</span> <span class="n">Catalog</span>
    <span class="n">llm</span><span class="p">:</span> <span class="n">BaseLanguageModel</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_catalog</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">llm</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initializes the EarthEngineDatasetIndex.</span>

<span class="sd">        Args:</span>
<span class="sd">            data_catalog (Catalog): The data catalog containing the datasets.</span>
<span class="sd">            index (VectorStoreIndexWrapper): The vector store index wrapper.</span>
<span class="sd">            llm (BaseLanguageModel): The language model for query processing.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span> <span class="o">=</span> <span class="n">data_catalog</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vectorstore</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">vectorstore</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">llm</span> <span class="o">=</span> <span class="n">llm</span>

    <span class="nd">@tenacity</span><span class="o">.</span><span class="n">retry</span><span class="p">(</span>
        <span class="n">stop</span><span class="o">=</span><span class="n">stop_after_attempt</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
        <span class="n">wait</span><span class="o">=</span><span class="n">wait_exponential</span><span class="p">(</span><span class="n">multiplier</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span>
        <span class="n">retry</span><span class="o">=</span><span class="n">retry_if_exception_type</span><span class="p">(</span>
            <span class="p">(</span><span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">RequestException</span><span class="p">,</span> <span class="ne">ConnectionError</span><span class="p">)</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">find_top_matches</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">results</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
        <span class="n">threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.7</span><span class="p">,</span>
        <span class="n">bounding_box</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">temporal_interval</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CollectionList</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve relevant datasets from the Earth Engine data catalog.</span>

<span class="sd">        Args:</span>
<span class="sd">            query (str): The kind of data being searched for, e.g., &#39;population&#39;.</span>
<span class="sd">            results (int): The number of datasets to return. Defaults to 10.</span>
<span class="sd">            threshold (float): The maximum dot product between the query and catalog embeddings.</span>
<span class="sd">                Defaults to 0.7.</span>
<span class="sd">            bounding_box (Optional[List[float]]): The spatial bounding box for the query,</span>
<span class="sd">                in the format [lon1, lat1, lon2, lon2]. Defaults to None.</span>
<span class="sd">            temporal_interval (Optional[Tuple[datetime.datetime, datetime.datetime]]):</span>
<span class="sd">            Temporal constraints as a tuple of datetime objects. Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            CollectionList: A list of collections that match the query.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">similar_docs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">vectorstore</span><span class="o">.</span><span class="n">similarity_search_with_score</span><span class="p">(</span>
            <span class="n">query</span><span class="p">,</span> <span class="n">llm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">llm</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">results</span>
        <span class="p">)</span>
        <span class="n">dataset_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">doc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">page_content</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">similar_docs</span><span class="p">]</span>
        <span class="n">datasets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">filter_by_ids</span><span class="p">(</span><span class="n">dataset_ids</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">datasets</span>

    <span class="nd">@tenacity</span><span class="o">.</span><span class="n">retry</span><span class="p">(</span>
        <span class="n">stop</span><span class="o">=</span><span class="n">stop_after_attempt</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
        <span class="n">wait</span><span class="o">=</span><span class="n">wait_exponential</span><span class="p">(</span><span class="n">multiplier</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span>
        <span class="n">retry</span><span class="o">=</span><span class="n">retry_if_exception_type</span><span class="p">(</span>
            <span class="p">(</span><span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">RequestException</span><span class="p">,</span> <span class="ne">ConnectionError</span><span class="p">)</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">find_top_matches_with_score_df</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">results</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
        <span class="n">threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.7</span><span class="p">,</span>
        <span class="n">bounding_box</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">temporal_interval</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve relevant datasets and their match scores as a DataFrame.</span>

<span class="sd">        Args:</span>
<span class="sd">            query (str): The kind of data being searched for, e.g., &#39;population&#39;.</span>
<span class="sd">            results (int): The number of datasets to return. Defaults to 20.</span>
<span class="sd">            threshold (float): The maximum dot product between the query and catalog embeddings.</span>
<span class="sd">                Defaults to 0.7.</span>
<span class="sd">            bounding_box (Optional[List[float]]): The spatial bounding box for the query,</span>
<span class="sd">                in the format [lon1, lat1, lon2, lon2]. Defaults to None.</span>
<span class="sd">            temporal_interval (Optional[Tuple[datetime.datetime, datetime.datetime]]):</span>
<span class="sd">                Temporal constraints as a tuple of datetime objects. Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: A DataFrame containing the dataset IDs and their match scores.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">scores_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ids_to_match_scores_df</span><span class="p">(</span>
            <span class="n">query</span><span class="p">,</span> <span class="n">results</span><span class="p">,</span> <span class="n">bounding_box</span><span class="p">,</span> <span class="n">temporal_interval</span>
        <span class="p">)</span>
        <span class="n">dataset_ids</span> <span class="o">=</span> <span class="n">scores_df</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">col_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">filter_by_ids</span><span class="p">(</span><span class="n">dataset_ids</span><span class="p">)</span>
        <span class="n">collection_df</span> <span class="o">=</span> <span class="n">col_list</span><span class="o">.</span><span class="n">to_df</span><span class="p">()</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">collection_df</span><span class="p">,</span> <span class="n">scores_df</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;match_score&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">ids_to_match_scores_df</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">results</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">bounding_box</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">temporal_interval</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert dataset IDs and match scores to a DataFrame.</span>

<span class="sd">        Args:</span>
<span class="sd">            query (str): The kind of data being searched for, e.g., &#39;population&#39;.</span>
<span class="sd">            results (int): The number of datasets to return.</span>
<span class="sd">            bounding_box (Optional[List[float]]): The spatial bounding box for the query,</span>
<span class="sd">                in the format [lon1, lat1, lon2, lon2]. Defaults to None.</span>
<span class="sd">            temporal_interval (Optional[Tuple[datetime.datetime, datetime.datetime]]):</span>
<span class="sd">                Temporal constraints as a tuple of datetime objects. Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: A DataFrame containing the dataset IDs and their match scores.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">similar_docs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">vectorstore</span><span class="o">.</span><span class="n">similarity_search_with_score</span><span class="p">(</span>
            <span class="n">query</span><span class="p">,</span> <span class="n">llm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">llm</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">results</span>
        <span class="p">)</span>
        <span class="n">dataset_ids</span><span class="p">,</span> <span class="n">scores</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span>
            <span class="o">*</span><span class="p">[(</span><span class="n">doc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">page_content</span><span class="p">,</span> <span class="n">doc</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">similar_docs</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">dataset_ids</span><span class="p">,</span> <span class="s2">&quot;match_score&quot;</span><span class="p">:</span> <span class="n">scores</span><span class="p">})</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="geemap.ai.EarthEngineDatasetIndex.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">data_catalog</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">llm</span><span class="p">)</span></code>

<a href="#geemap.ai.EarthEngineDatasetIndex.__init__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Initializes the EarthEngineDatasetIndex.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>data_catalog</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Catalog (geemap.ai.Catalog)" href="#geemap.ai.Catalog">Catalog</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The data catalog containing the datasets.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>index</code>
            </td>
            <td>
                  <code><span title="langchain.indexes.vectorstore.VectorStoreIndexWrapper">VectorStoreIndexWrapper</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The vector store index wrapper.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>llm</code>
            </td>
            <td>
                  <code><span title="langchain_core.language_models.base.BaseLanguageModel">BaseLanguageModel</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The language model for query processing.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geemap/ai.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_catalog</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">llm</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initializes the EarthEngineDatasetIndex.</span>

<span class="sd">    Args:</span>
<span class="sd">        data_catalog (Catalog): The data catalog containing the datasets.</span>
<span class="sd">        index (VectorStoreIndexWrapper): The vector store index wrapper.</span>
<span class="sd">        llm (BaseLanguageModel): The language model for query processing.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">index</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span> <span class="o">=</span> <span class="n">data_catalog</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">vectorstore</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">vectorstore</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">llm</span> <span class="o">=</span> <span class="n">llm</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="geemap.ai.EarthEngineDatasetIndex.find_top_matches" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">find_top_matches</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">results</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">bounding_box</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">temporal_interval</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#geemap.ai.EarthEngineDatasetIndex.find_top_matches" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Retrieve relevant datasets from the Earth Engine data catalog.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>query</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The kind of data being searched for, e.g., 'population'.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>results</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of datasets to return. Defaults to 10.</p>
              </div>
            </td>
            <td>
                  <code>10</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>threshold</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum dot product between the query and catalog embeddings.
Defaults to 0.7.</p>
              </div>
            </td>
            <td>
                  <code>0.7</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bounding_box</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<span title="float">float</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The spatial bounding box for the query,
in the format [lon1, lat1, lon2, lon2]. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>temporal_interval</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Tuple">Tuple</span>[<span title="datetime.datetime">datetime</span>, <span title="datetime.datetime">datetime</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>CollectionList</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="CollectionList (geemap.ai.CollectionList)" href="#geemap.ai.CollectionList">CollectionList</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of collections that match the query.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geemap/ai.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span>
<span class="normal">1599</span>
<span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span>
<span class="normal">1603</span>
<span class="normal">1604</span>
<span class="normal">1605</span>
<span class="normal">1606</span>
<span class="normal">1607</span>
<span class="normal">1608</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@tenacity</span><span class="o">.</span><span class="n">retry</span><span class="p">(</span>
    <span class="n">stop</span><span class="o">=</span><span class="n">stop_after_attempt</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
    <span class="n">wait</span><span class="o">=</span><span class="n">wait_exponential</span><span class="p">(</span><span class="n">multiplier</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span>
    <span class="n">retry</span><span class="o">=</span><span class="n">retry_if_exception_type</span><span class="p">(</span>
        <span class="p">(</span><span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">RequestException</span><span class="p">,</span> <span class="ne">ConnectionError</span><span class="p">)</span>
    <span class="p">),</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">find_top_matches</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">results</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.7</span><span class="p">,</span>
    <span class="n">bounding_box</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">temporal_interval</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CollectionList</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Retrieve relevant datasets from the Earth Engine data catalog.</span>

<span class="sd">    Args:</span>
<span class="sd">        query (str): The kind of data being searched for, e.g., &#39;population&#39;.</span>
<span class="sd">        results (int): The number of datasets to return. Defaults to 10.</span>
<span class="sd">        threshold (float): The maximum dot product between the query and catalog embeddings.</span>
<span class="sd">            Defaults to 0.7.</span>
<span class="sd">        bounding_box (Optional[List[float]]): The spatial bounding box for the query,</span>
<span class="sd">            in the format [lon1, lat1, lon2, lon2]. Defaults to None.</span>
<span class="sd">        temporal_interval (Optional[Tuple[datetime.datetime, datetime.datetime]]):</span>
<span class="sd">        Temporal constraints as a tuple of datetime objects. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        CollectionList: A list of collections that match the query.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">similar_docs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">vectorstore</span><span class="o">.</span><span class="n">similarity_search_with_score</span><span class="p">(</span>
        <span class="n">query</span><span class="p">,</span> <span class="n">llm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">llm</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">results</span>
    <span class="p">)</span>
    <span class="n">dataset_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">doc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">page_content</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">similar_docs</span><span class="p">]</span>
    <span class="n">datasets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">filter_by_ids</span><span class="p">(</span><span class="n">dataset_ids</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">datasets</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="geemap.ai.EarthEngineDatasetIndex.find_top_matches_with_score_df" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">find_top_matches_with_score_df</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">results</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">bounding_box</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">temporal_interval</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#geemap.ai.EarthEngineDatasetIndex.find_top_matches_with_score_df" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Retrieve relevant datasets and their match scores as a DataFrame.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>query</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The kind of data being searched for, e.g., 'population'.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>results</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of datasets to return. Defaults to 20.</p>
              </div>
            </td>
            <td>
                  <code>20</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>threshold</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum dot product between the query and catalog embeddings.
Defaults to 0.7.</p>
              </div>
            </td>
            <td>
                  <code>0.7</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bounding_box</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<span title="float">float</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The spatial bounding box for the query,
in the format [lon1, lat1, lon2, lon2]. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>temporal_interval</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Tuple">Tuple</span>[<span title="datetime.datetime">datetime</span>, <span title="datetime.datetime">datetime</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Temporal constraints as a tuple of datetime objects. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pd.DataFrame: A DataFrame containing the dataset IDs and their match scores.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geemap/ai.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1610</span>
<span class="normal">1611</span>
<span class="normal">1612</span>
<span class="normal">1613</span>
<span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span>
<span class="normal">1622</span>
<span class="normal">1623</span>
<span class="normal">1624</span>
<span class="normal">1625</span>
<span class="normal">1626</span>
<span class="normal">1627</span>
<span class="normal">1628</span>
<span class="normal">1629</span>
<span class="normal">1630</span>
<span class="normal">1631</span>
<span class="normal">1632</span>
<span class="normal">1633</span>
<span class="normal">1634</span>
<span class="normal">1635</span>
<span class="normal">1636</span>
<span class="normal">1637</span>
<span class="normal">1638</span>
<span class="normal">1639</span>
<span class="normal">1640</span>
<span class="normal">1641</span>
<span class="normal">1642</span>
<span class="normal">1643</span>
<span class="normal">1644</span>
<span class="normal">1645</span>
<span class="normal">1646</span>
<span class="normal">1647</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@tenacity</span><span class="o">.</span><span class="n">retry</span><span class="p">(</span>
    <span class="n">stop</span><span class="o">=</span><span class="n">stop_after_attempt</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
    <span class="n">wait</span><span class="o">=</span><span class="n">wait_exponential</span><span class="p">(</span><span class="n">multiplier</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span>
    <span class="n">retry</span><span class="o">=</span><span class="n">retry_if_exception_type</span><span class="p">(</span>
        <span class="p">(</span><span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">RequestException</span><span class="p">,</span> <span class="ne">ConnectionError</span><span class="p">)</span>
    <span class="p">),</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">find_top_matches_with_score_df</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">results</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
    <span class="n">threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.7</span><span class="p">,</span>
    <span class="n">bounding_box</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">temporal_interval</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Retrieve relevant datasets and their match scores as a DataFrame.</span>

<span class="sd">    Args:</span>
<span class="sd">        query (str): The kind of data being searched for, e.g., &#39;population&#39;.</span>
<span class="sd">        results (int): The number of datasets to return. Defaults to 20.</span>
<span class="sd">        threshold (float): The maximum dot product between the query and catalog embeddings.</span>
<span class="sd">            Defaults to 0.7.</span>
<span class="sd">        bounding_box (Optional[List[float]]): The spatial bounding box for the query,</span>
<span class="sd">            in the format [lon1, lat1, lon2, lon2]. Defaults to None.</span>
<span class="sd">        temporal_interval (Optional[Tuple[datetime.datetime, datetime.datetime]]):</span>
<span class="sd">            Temporal constraints as a tuple of datetime objects. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: A DataFrame containing the dataset IDs and their match scores.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">scores_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ids_to_match_scores_df</span><span class="p">(</span>
        <span class="n">query</span><span class="p">,</span> <span class="n">results</span><span class="p">,</span> <span class="n">bounding_box</span><span class="p">,</span> <span class="n">temporal_interval</span>
    <span class="p">)</span>
    <span class="n">dataset_ids</span> <span class="o">=</span> <span class="n">scores_df</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">col_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">filter_by_ids</span><span class="p">(</span><span class="n">dataset_ids</span><span class="p">)</span>
    <span class="n">collection_df</span> <span class="o">=</span> <span class="n">col_list</span><span class="o">.</span><span class="n">to_df</span><span class="p">()</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">collection_df</span><span class="p">,</span> <span class="n">scores_df</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;match_score&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="geemap.ai.EarthEngineDatasetIndex.ids_to_match_scores_df" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ids_to_match_scores_df</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">results</span><span class="p">,</span> <span class="n">bounding_box</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">temporal_interval</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#geemap.ai.EarthEngineDatasetIndex.ids_to_match_scores_df" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Convert dataset IDs and match scores to a DataFrame.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>query</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The kind of data being searched for, e.g., 'population'.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>results</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of datasets to return.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bounding_box</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<span title="float">float</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The spatial bounding box for the query,
in the format [lon1, lat1, lon2, lon2]. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>temporal_interval</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Tuple">Tuple</span>[<span title="datetime.datetime">datetime</span>, <span title="datetime.datetime">datetime</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Temporal constraints as a tuple of datetime objects. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pd.DataFrame: A DataFrame containing the dataset IDs and their match scores.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geemap/ai.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1649</span>
<span class="normal">1650</span>
<span class="normal">1651</span>
<span class="normal">1652</span>
<span class="normal">1653</span>
<span class="normal">1654</span>
<span class="normal">1655</span>
<span class="normal">1656</span>
<span class="normal">1657</span>
<span class="normal">1658</span>
<span class="normal">1659</span>
<span class="normal">1660</span>
<span class="normal">1661</span>
<span class="normal">1662</span>
<span class="normal">1663</span>
<span class="normal">1664</span>
<span class="normal">1665</span>
<span class="normal">1666</span>
<span class="normal">1667</span>
<span class="normal">1668</span>
<span class="normal">1669</span>
<span class="normal">1670</span>
<span class="normal">1671</span>
<span class="normal">1672</span>
<span class="normal">1673</span>
<span class="normal">1674</span>
<span class="normal">1675</span>
<span class="normal">1676</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">ids_to_match_scores_df</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">results</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">bounding_box</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">temporal_interval</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert dataset IDs and match scores to a DataFrame.</span>

<span class="sd">    Args:</span>
<span class="sd">        query (str): The kind of data being searched for, e.g., &#39;population&#39;.</span>
<span class="sd">        results (int): The number of datasets to return.</span>
<span class="sd">        bounding_box (Optional[List[float]]): The spatial bounding box for the query,</span>
<span class="sd">            in the format [lon1, lat1, lon2, lon2]. Defaults to None.</span>
<span class="sd">        temporal_interval (Optional[Tuple[datetime.datetime, datetime.datetime]]):</span>
<span class="sd">            Temporal constraints as a tuple of datetime objects. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: A DataFrame containing the dataset IDs and their match scores.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">similar_docs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">vectorstore</span><span class="o">.</span><span class="n">similarity_search_with_score</span><span class="p">(</span>
        <span class="n">query</span><span class="p">,</span> <span class="n">llm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">llm</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">results</span>
    <span class="p">)</span>
    <span class="n">dataset_ids</span><span class="p">,</span> <span class="n">scores</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span>
        <span class="o">*</span><span class="p">[(</span><span class="n">doc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">page_content</span><span class="p">,</span> <span class="n">doc</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">similar_docs</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">dataset_ids</span><span class="p">,</span> <span class="s2">&quot;match_score&quot;</span><span class="p">:</span> <span class="n">scores</span><span class="p">})</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="geemap.ai.Genie" class="doc doc-heading">
            <code>Genie</code>


<a href="#geemap.ai.Genie" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="ipywidgets.VBox">VBox</span></code></p>


        <p>A widget for interacting with the Genie AI model.</p>
<p>The source code is adapted from the ee_genie.ipynb at <a href="https://bit.ly/3YEm7B6">https://bit.ly/3YEm7B6</a>.
Credit to the original author Simon Ilyushchenko (<a href="https://github.com/simonff">https://github.com/simonff</a>).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>project</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Google Cloud project ID. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>google_api_key</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Google API key. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>gemini_model</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Gemini model to use. Defaults to "gemini-1.5-flash".
For a list of available models, see https://bit.ly/4fKfXW7.</p>
              </div>
            </td>
            <td>
                  <code>&#39;gemini-1.5-flash&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>target_score</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The target score for the model. Defaults to 0.8.</p>
              </div>
            </td>
            <td>
                  <code>0.8</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>widget_height</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The height of the widget. Defaults to "600px".</p>
              </div>
            </td>
            <td>
                  <code>&#39;600px&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>initialize_ee</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to initialize Earth Engine. Defaults to True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the project ID or Google API key is not provided.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>geemap/ai.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Genie</span><span class="p">(</span><span class="n">widgets</span><span class="o">.</span><span class="n">VBox</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A widget for interacting with the Genie AI model.</span>

<span class="sd">    The source code is adapted from the ee_genie.ipynb at &lt;https://bit.ly/3YEm7B6&gt;.</span>
<span class="sd">    Credit to the original author Simon Ilyushchenko (&lt;https://github.com/simonff&gt;).</span>

<span class="sd">    Args:</span>
<span class="sd">        project (Optional[str], optional): Google Cloud project ID. Defaults to None.</span>
<span class="sd">        google_api_key (Optional[str], optional): Google API key. Defaults to None.</span>
<span class="sd">        gemini_model (str, optional): The Gemini model to use. Defaults to &quot;gemini-1.5-flash&quot;.</span>
<span class="sd">            For a list of available models, see https://bit.ly/4fKfXW7.</span>
<span class="sd">        target_score (float, optional): The target score for the model. Defaults to 0.8.</span>
<span class="sd">        widget_height (str, optional): The height of the widget. Defaults to &quot;600px&quot;.</span>
<span class="sd">        initialize_ee (bool, optional): Whether to initialize Earth Engine. Defaults to True.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If the project ID or Google API key is not provided.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">google_api_key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">gemini_model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;gemini-1.5-flash&quot;</span><span class="p">,</span>
        <span class="n">target_score</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span>
        <span class="n">widget_height</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;600px&quot;</span><span class="p">,</span>
        <span class="n">initialize_ee</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Initialization</span>

        <span class="k">if</span> <span class="n">project</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">project</span> <span class="o">=</span> <span class="n">get_env_var</span><span class="p">(</span><span class="s2">&quot;EE_PROJECT_ID&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">get_env_var</span><span class="p">(</span><span class="s2">&quot;GOOGLE_PROJECT_ID&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">project</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Please provide a valid project ID via the &#39;project&#39; parameter.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">google_api_key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">google_api_key</span> <span class="o">=</span> <span class="n">get_env_var</span><span class="p">(</span><span class="s2">&quot;GOOGLE_API_KEY&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">google_api_key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Please provide a valid Google API key via the &#39;google_api_key&#39; parameter.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">initialize_ee</span><span class="p">:</span>
            <span class="n">ee_initialize</span><span class="p">(</span><span class="n">project</span><span class="o">=</span><span class="n">project</span><span class="p">)</span>

        <span class="n">genai</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="n">google_api_key</span><span class="p">)</span>
        <span class="n">storage_client</span> <span class="o">=</span> <span class="n">storage</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">project</span><span class="o">=</span><span class="n">project</span><span class="p">)</span>
        <span class="n">bucket</span> <span class="o">=</span> <span class="n">storage_client</span><span class="o">.</span><span class="n">get_bucket</span><span class="p">(</span><span class="s2">&quot;earthengine-stac&quot;</span><span class="p">)</span>

        <span class="c1"># Score to aim for (on the 0-1 scale). The exact meaning of what &quot;score&quot; means</span>
        <span class="c1"># is left to the LLM.</span>

        <span class="c1"># Count of analysis rounds</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">iteration</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">map_dirty</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">m</span> <span class="o">=</span> <span class="n">Map</span><span class="p">()</span>
        <span class="n">m</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;layer_manager&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">map</span> <span class="o">=</span> <span class="n">m</span>

        <span class="n">analysis_model</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">image_model</span> <span class="o">=</span> <span class="n">genai</span><span class="o">.</span><span class="n">GenerativeModel</span><span class="p">(</span><span class="n">gemini_model</span><span class="p">)</span>

        <span class="c1"># UI widget definitions</span>

        <span class="c1"># We define the widgets early because some functions will write to the debug</span>
        <span class="c1"># and/or chat panels.</span>

        <span class="n">command_input</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span>
            <span class="n">value</span><span class="o">=</span><span class="s2">&quot;show a whole continent Australia DEM visualization using a palette that captures the elevation range&quot;</span><span class="p">,</span>
            <span class="c1"># value=&#39;show NYC&#39;,</span>
            <span class="c1"># value=&#39;show an area with many center pivot irrigation circles&#39;,</span>
            <span class="c1"># value=&#39;show a fire scar&#39;,</span>
            <span class="c1"># value=&#39;show an open pit mine&#39;,</span>
            <span class="c1"># value=&#39;a sea port&#39;,</span>
            <span class="c1"># value=&#39;flood consequences&#39;,</span>
            <span class="c1"># value=&#39;show an interesting modis composite with the relevant visualization and analyze it over Costa Rica&#39;,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;❓&quot;</span><span class="p">,</span>
            <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s2">&quot;100%&quot;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="s2">&quot;50px&quot;</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="n">command_output</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span>
            <span class="n">value</span><span class="o">=</span><span class="s2">&quot;Last command will be here&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">status_label</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Textarea</span><span class="p">(</span>
            <span class="n">value</span><span class="o">=</span><span class="s2">&quot;LLM response will be here&quot;</span><span class="p">,</span>
            <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s2">&quot;50%&quot;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="s2">&quot;100px&quot;</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># widget_height = &quot;600px&quot;</span>
        <span class="n">debug_output</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Output</span><span class="p">(</span>
            <span class="n">layout</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;border&quot;</span><span class="p">:</span> <span class="s2">&quot;1px solid black&quot;</span><span class="p">,</span>
                <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="n">widget_height</span><span class="p">,</span>
                <span class="s2">&quot;overflow&quot;</span><span class="p">:</span> <span class="s2">&quot;scroll&quot;</span><span class="p">,</span>
                <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="s2">&quot;500px&quot;</span><span class="p">,</span>
                <span class="s2">&quot;padding&quot;</span><span class="p">:</span> <span class="s2">&quot;5px&quot;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="k">with</span> <span class="n">debug_output</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DEBUG COLUMN</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">logo</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">&quot;https://drive.usercontent.google.com/download?id=1zE6G_nxXa3G5N0G_32jEhzdum2kMDfNY&amp;export=view&amp;authuser=0&quot;</span>
        <span class="p">)</span><span class="o">.</span><span class="n">content</span>

        <span class="n">image_widget</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">logo</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;png&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>

        <span class="n">chat_output</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Output</span><span class="p">(</span>
            <span class="n">layout</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;border&quot;</span><span class="p">:</span> <span class="s2">&quot;1px solid black&quot;</span><span class="p">,</span>
                <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="s2">&quot;600px&quot;</span><span class="p">,</span>
                <span class="s2">&quot;overflow&quot;</span><span class="p">:</span> <span class="s2">&quot;scroll&quot;</span><span class="p">,</span>
                <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="s2">&quot;300px&quot;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="k">with</span> <span class="n">chat_output</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CHAT COLUMN</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Simple functions that LLM will call</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">set_center</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">zoom</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Sets the map center to the given coordinates and zoom level and</span>
<span class="sd">            returns instructions on what to do next.&quot;&quot;&quot;</span>
            <span class="k">with</span> <span class="n">debug_output</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SET_CENTER(</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">y</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">zoom</span><span class="si">}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">m</span><span class="o">.</span><span class="n">set_center</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
            <span class="n">m</span><span class="o">.</span><span class="n">zoom</span> <span class="o">=</span> <span class="n">zoom</span>
            <span class="c1"># global map_dirty</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">map_dirty</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="s2">&quot;Do not call any more functions in this request to let geemap bounds &quot;</span>
                <span class="s2">&quot;update. Wait for user input.&quot;</span>
            <span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">add_image_layer</span><span class="p">(</span><span class="n">image_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Adds to the map center an ee.Image with the given id</span>
<span class="sd">            and returns status message (success or failure).&quot;&quot;&quot;</span>
            <span class="n">m</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="n">command_output</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;add_image_layer(&#39;</span><span class="si">{</span><span class="n">image_id</span><span class="si">}</span><span class="s2">&#39;)&quot;</span>
            <span class="n">m</span><span class="o">.</span><span class="n">addLayer</span><span class="p">(</span><span class="n">ee</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="n">image_id</span><span class="p">))</span>
            <span class="k">return</span> <span class="s2">&quot;success&quot;</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">get_dataset_description</span><span class="p">(</span><span class="n">dataset_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Fetches JSON STAC description for the given Earth Engine dataset id.&quot;&quot;&quot;</span>
            <span class="k">with</span> <span class="n">debug_output</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;LOOKING UP </span><span class="si">{</span><span class="n">dataset_id</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">parent</span> <span class="o">=</span> <span class="n">dataset_id</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># Get the blob (file)</span>
            <span class="n">path</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;catalog&quot;</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">dataset_id</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;.json&quot;</span>
            <span class="p">)</span>
            <span class="n">blob</span> <span class="o">=</span> <span class="n">bucket</span><span class="o">.</span><span class="n">blob</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">blob</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="k">return</span> <span class="s2">&quot;dataset file not found: &quot;</span> <span class="o">+</span> <span class="n">path</span>

            <span class="n">file_contents</span> <span class="o">=</span> <span class="n">blob</span><span class="o">.</span><span class="n">download_as_string</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">file_contents</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">get_image</span><span class="p">(</span><span class="n">image_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Fetches from Earth Engine the content of the given URL as bytes.&quot;&quot;&quot;</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">image_url</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
                <span class="n">image_widget</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span>
                <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">error_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Error downloading image: </span><span class="si">{</span><span class="n">response</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">error_details</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
                        <span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="p">{})</span>
                        <span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">)</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">error_details</span><span class="p">:</span>
                        <span class="n">error_message</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; - </span><span class="si">{</span><span class="n">error_details</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">except</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">with</span> <span class="n">debug_output</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;URL </span><span class="si">%s</span><span class="s2"> causes </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">image_url</span><span class="p">,</span> <span class="n">error_message</span><span class="p">))</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">show_layer</span><span class="p">(</span><span class="n">python_code</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Execute the given Earth Engine Python client code and add the result to</span>
<span class="sd">            the map. Returns the status message (success or error message).&quot;&quot;&quot;</span>
            <span class="n">m</span><span class="o">.</span><span class="n">layers</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">layers</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">while</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&quot;&#39;</span> <span class="ow">in</span> <span class="n">python_code</span><span class="p">:</span>
                <span class="n">python_code</span> <span class="o">=</span> <span class="n">python_code</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&quot;&#39;</span><span class="p">,</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>
            <span class="n">command_output</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;show_layer(&#39;</span><span class="si">{</span><span class="n">python_code</span><span class="si">}</span><span class="s2">&#39;)&quot;</span>
            <span class="k">with</span> <span class="n">debug_output</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;IMAGE:</span><span class="se">\n</span><span class="s2"> </span><span class="si">{</span><span class="n">python_code</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nb">locals</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">exec</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;import ee; im = </span><span class="si">{</span><span class="n">python_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">{},</span> <span class="nb">locals</span><span class="p">)</span>
                <span class="n">m</span><span class="o">.</span><span class="n">addLayer</span><span class="p">(</span><span class="nb">locals</span><span class="p">[</span><span class="s2">&quot;im&quot;</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">debug_output</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ERROR: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="k">return</span> <span class="s2">&quot;success&quot;</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">inner_monologue</span><span class="p">(</span><span class="n">thoughts</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Sends the current thinking of the LLM model to the user so that they are</span>
<span class="sd">            aware of what the model is thinking between function calls.&quot;&quot;&quot;</span>
            <span class="k">with</span> <span class="n">debug_output</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;THOUGHTS:</span><span class="se">\n</span><span class="s2"> </span><span class="si">{</span><span class="n">thoughts</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="s2">&quot;success&quot;</span>

        <span class="c1"># Functions for textual analysis of images</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_lat_lon_to_tile</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">zoom_level</span><span class="p">):</span>
            <span class="c1"># Convert latitude and longitude to Mercator coordinates</span>
            <span class="n">x_merc</span> <span class="o">=</span> <span class="p">(</span><span class="n">lon</span> <span class="o">+</span> <span class="mi">180</span><span class="p">)</span> <span class="o">/</span> <span class="mi">360</span>
            <span class="n">y_merc</span> <span class="o">=</span> <span class="p">(</span>
                <span class="mi">1</span>
                <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                    <span class="n">math</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">lat</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">lat</span><span class="p">))</span>
                <span class="p">)</span>
                <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span>
            <span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

            <span class="c1"># Calculate number of tiles</span>
            <span class="n">n</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="n">zoom_level</span>

            <span class="c1"># Convert to tile coordinates</span>
            <span class="n">X</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">x_merc</span> <span class="o">*</span> <span class="n">n</span><span class="p">)</span>
            <span class="n">Y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">y_merc</span> <span class="o">*</span> <span class="n">n</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">analyze_image</span><span class="p">(</span><span class="n">additional_instructions</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Returns GenAI image analysis describing the current map image.</span>
<span class="sd">            Optional additional instructions might be passed to target the analysis</span>
<span class="sd">            more precisely.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="c1"># global map_dirty</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_dirty</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;MAP DIRTY&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="p">(</span>
                    <span class="s2">&quot;Map is not ready. Stop further processing and ask for user input&quot;</span>
                <span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">_analyze_image</span><span class="p">(</span><span class="n">additional_instructions</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_analyze_image</span><span class="p">(</span><span class="n">additional_instructions</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
            <span class="c1"># bounds = m.bounds</span>
            <span class="c1"># s, w = bounds[0]</span>
            <span class="c1"># n, e = bounds[1]</span>
            <span class="c1"># zoom = int(m.zoom)</span>

            <span class="c1"># min_tile_x, max_tile_y = _lat_lon_to_tile(w, s, zoom)</span>
            <span class="c1"># max_tile_x, min_tile_y = _lat_lon_to_tile(e, n, zoom)</span>
            <span class="c1"># min_tile_x = max(0, min_tile_x)</span>
            <span class="c1"># max_tile_x = min(2**zoom - 1, max_tile_x)</span>
            <span class="c1"># min_tile_y = max(0, min_tile_y)</span>
            <span class="c1"># max_tile_y = min(2**zoom - 1, max_tile_y)</span>

            <span class="c1"># with debug_output:</span>
            <span class="c1">#     if additional_instructions:</span>
            <span class="c1">#         print(f&quot;RUNNING IMAGE ANALYSIS: {additional_instructions}...\n&quot;)</span>
            <span class="c1">#     else:</span>
            <span class="c1">#         print(&quot;RUNNING IMAGE ANALYSIS...\n&quot;)</span>

            <span class="c1"># layers = list(m.ee_layer_dict.values())</span>
            <span class="c1"># if not layers:</span>
            <span class="c1">#     return &quot;No data layers loaded&quot;</span>
            <span class="c1"># url_template = layers[-1][&quot;ee_layer&quot;].url</span>
            <span class="c1"># tile_width = 256</span>
            <span class="c1"># tile_height = 256</span>
            <span class="c1"># image_width = (max_tile_x - min_tile_x + 1) * tile_width</span>
            <span class="c1"># image_height = (max_tile_y - min_tile_y + 1) * tile_height</span>

            <span class="c1"># # Create a new blank image</span>
            <span class="c1"># image = PIL.Image.new(&quot;RGB&quot;, (image_width, image_height))</span>

            <span class="c1"># for y in range(min_tile_y, max_tile_y + 1):</span>
            <span class="c1">#     for x in range(min_tile_x, max_tile_x + 1):</span>
            <span class="c1">#         tile_url = str.format(url_template, x=x, y=y, z=zoom)</span>
            <span class="c1">#         # print(tile_url)</span>
            <span class="c1">#         tile_img = PIL.Image.open(io.BytesIO(get_image(tile_url)))</span>

            <span class="c1">#         offset_x = (x - min_tile_x) * tile_width</span>
            <span class="c1">#         offset_y = (y - min_tile_y) * tile_height</span>
            <span class="c1">#         image.paste(tile_img, (offset_x, offset_y))</span>

            <span class="c1"># width, height = image.size</span>
            <span class="c1"># num_bands = len(image.getbands())</span>

            <span class="k">with</span> <span class="n">debug_output</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">additional_instructions</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;RUNNING IMAGE ANALYSIS: </span><span class="si">{</span><span class="n">additional_instructions</span><span class="si">}</span><span class="s2">...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;RUNNING IMAGE ANALYSIS...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">layers</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">ee_layer_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">layers</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;No data layers loaded&quot;</span>
            <span class="n">image_temp_file</span> <span class="o">=</span> <span class="n">temp_file_path</span><span class="p">(</span><span class="n">extension</span><span class="o">=</span><span class="s2">&quot;jpg&quot;</span><span class="p">)</span>
            <span class="n">layer_name</span> <span class="o">=</span> <span class="n">layers</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;ee_layer&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
            <span class="n">m</span><span class="o">.</span><span class="n">layer_to_image</span><span class="p">(</span><span class="n">layer_name</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">image_temp_file</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">get_scale</span><span class="p">())</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">PIL</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">image_temp_file</span><span class="p">)</span>

            <span class="n">image_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
            <span class="n">image_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">image_array</span><span class="p">)</span>
            <span class="n">image_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">image_array</span><span class="p">)</span>

            <span class="n">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">image_temp_file</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span>
            <span class="n">image_widget</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

            <span class="c1"># Skip an LLM call when we can simply tell that something is wrong.</span>
            <span class="c1"># (Also, LLMs might hallucinate on uniform images.)</span>
            <span class="k">if</span> <span class="n">image_min</span> <span class="o">==</span> <span class="n">image_max</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;The image tile has a single uniform color with value &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">image_min</span><span class="si">}</span><span class="s2">.&quot;</span>
                <span class="p">)</span>

            <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;You are an objective, precise overhead imagery analyst.</span>
<span class="s2">        Describe what the provided map tile depicts in terms of:</span>

<span class="s2">        1. The colors, textures, and patterns visible in the image.</span>
<span class="s2">        2. The spatial distribution, shape, and extent of distinct features or regions.</span>
<span class="s2">        3. Any notable contrasts, boundaries, or gradients between different areas.</span>

<span class="s2">        Avoid making assumptions about the specific geographic location, time period,</span>
<span class="s2">        or cause of the observed features. Focus solely on the literal contents of the</span>
<span class="s2">        image itself. Clearly indicate which features look natural, which look human-made,</span>
<span class="s2">        and which look like image artifacts. (Eg, a completely straight blue line</span>
<span class="s2">        is unlikely to be a river.)</span>

<span class="s2">        If the image is ambiguous or unclear, state so directly. Do not speculate or</span>
<span class="s2">        hypothesize beyond what is directly visible.</span>

<span class="s2">        If the image is of mostly the same color (white, gray, or black) with little</span>
<span class="s2">        contrast, just report that and do not describe the features.</span>

<span class="s2">        Use clear, concise language. Avoid subjective interpretations or analogies.</span>
<span class="s2">        Organize your response into structured paragraphs.</span>
<span class="s2">        &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="n">additional_instructions</span><span class="p">:</span>
                <span class="n">query</span> <span class="o">+=</span> <span class="n">additional_instructions</span>
            <span class="n">req</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;parts&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">query</span><span class="p">},</span>
                    <span class="p">{</span><span class="s2">&quot;inline_data&quot;</span><span class="p">:</span> <span class="n">image</span><span class="p">},</span>
                <span class="p">]</span>
            <span class="p">}</span>
            <span class="n">image_response</span> <span class="o">=</span> <span class="n">image_model</span><span class="o">.</span><span class="n">generate_content</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">debug_output</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ANALYSIS RESULT: </span><span class="si">{</span><span class="n">image_response</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">image_response</span><span class="o">.</span><span class="n">text</span>
            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">debug_output</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;UNEXPECTED IMAGE RESPONSE: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">image_response</span><span class="p">)</span>
                <span class="nb">breakpoint</span><span class="p">()</span>

        <span class="c1"># Function for scoring how well image analysis corresponds to the user query.</span>

        <span class="c1"># Note that we ask for the score outside of the main agent chat to keep</span>
        <span class="c1"># the scoring more objective.</span>

        <span class="n">scoring_system_prompt</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        After looking at the user query and the map tile analysis, start</span>
<span class="s2">        your answer with a number between 0 and 1 indicating how relevant</span>
<span class="s2">        the image is as an answer to the query. (0=irrelevant, 1=perfect answer)</span>

<span class="s2">        Make sure you have enough justification to definitively declare the analysis</span>
<span class="s2">        relevant - it&#39;s better to give a false negative than a false positive. However,</span>
<span class="s2">        the image analysis identifies specific matching landmarks (eg, the</span>
<span class="s2">        the outlines of Manhattan island for a request to show NYC), believe it.</span>

<span class="s2">        Do not assume  too much (eg, that the presence of green doesn&#39;t by itself mean the</span>
<span class="s2">        image shows forest); attempt to find multiple (at least three) independent</span>
<span class="s2">        lines of evidence before declaring victory and cite all these lines of evidence</span>
<span class="s2">        in your response.</span>

<span class="s2">        Be very, very skeptical - look for specific features that match only the query</span>
<span class="s2">        and nothing else (eg, if the query looks for a river, a completely straight blue</span>
<span class="s2">        line is unlikely to be a river). Think about what size the features are based on</span>
<span class="s2">        the zoom level and whether this size matches the feature size expected from</span>
<span class="s2">        first principles.</span>

<span class="s2">        If there is ambiguity or uncertainty, express it in your analysis and</span>
<span class="s2">        lower the score accordingly. If the image analysis is inconclusive, try zooming</span>
<span class="s2">        out to make sure you are looking at the right spot. Do not reduce the score if</span>
<span class="s2">        the analysis does not mention visualization parameters - they are just given for</span>
<span class="s2">        your reference. The image might show an area slightly larger than requested -</span>
<span class="s2">        this is okay, do not reduce the score on this account.</span>
<span class="s2">        &quot;&quot;&quot;</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">score_response</span><span class="p">(</span>
            <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">visualization_parameters</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">analysis</span><span class="p">:</span> <span class="nb">str</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Returns how well the given analysis describes a map tile returned for</span>
<span class="sd">            the given query. The analysis starts with a number between 0 and 1.</span>

<span class="sd">            Arguments:</span>
<span class="sd">            query: user-specified query</span>
<span class="sd">            visualization_parameters: description of the bands used and visualization</span>
<span class="sd">                parameters applied to the map tile</span>
<span class="sd">            analysis: the textual description of the map tile</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">with</span> <span class="n">debug_output</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;VIZ PARAMS: </span><span class="si">{</span><span class="n">visualization_parameters</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">question</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;For user query </span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2"> please score the following analysis:</span>
<span class="s2">            </span><span class="si">{</span><span class="n">analysis</span><span class="si">}</span><span class="s2">. The answer must start with a number between 0 and 1.&quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="n">visualization_parameters</span><span class="p">:</span>
                <span class="n">question</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Do not assume that common bands or visualization</span>
<span class="s2">                parameters should have been used, as the visualization used the</span>
<span class="s2">                following parameters: </span><span class="si">{</span><span class="n">visualization_parameters</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span>

            <span class="n">result</span> <span class="o">=</span> <span class="n">analysis_model</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="n">question</span><span class="p">)</span>
            <span class="c1"># global iteration</span>
            <span class="k">with</span> <span class="n">debug_output</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SCORE #</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">iteration</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="s2"> </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">iteration</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">debug_output</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;UNEXPECTED SCORE RESPONSE: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span>

        <span class="c1"># Main prompt for the agent</span>

        <span class="n">system_prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        The client is running in a Python notebook with a geemap Map displayed.</span>
<span class="s2">        When composing Python code, do not use getMapId - just return the single-line</span>
<span class="s2">        layer definition like &#39;ee.Image(&quot;USGS/SRTMGL1_003&quot;)&#39; that we will pass to</span>
<span class="s2">        Map.addLayer(). Do not escape quotation marks in Python code.</span>

<span class="s2">        Be sure to use Python, not Javascript, syntax for keyword parameters in</span>
<span class="s2">        Python code (that is, &quot;function(arg=value)&quot;) Using the provided functions,</span>
<span class="s2">        respond to the user command following below (or respond why it&#39;s not possible).</span>
<span class="s2">        If you get an Earth Engine error, attempt to fix it and then try again.</span>

<span class="s2">        Before you choose a dataset, think about what kind of dataset would be most</span>
<span class="s2">        suitable for the query. Also think about what zoom level would be suitable for</span>
<span class="s2">        the query, keeping in mind that for high-resolution image collections higher</span>
<span class="s2">        zoom levels are better to speed up tile loading.</span>

<span class="s2">        Once you have chosen a dataset, read its description using the provided function</span>
<span class="s2">        to see what spatial and temporal range it covers, what bands it has, as well as</span>
<span class="s2">        to find the recommended visualization parameters. Explain using the inner</span>
<span class="s2">        monlogue function why you chose a specific dataset, zoom level and map location.</span>

<span class="s2">        Prefer mosaicing image collections using the mosaic() function, don&#39;t get</span>
<span class="s2">        individual images from collections via</span>
<span class="s2">        &#39;first()&#39;. Choose a tile size and zoom level that will ensure the</span>
<span class="s2">        tile has enough pixels in it to avoid graininess, but not so many</span>
<span class="s2">        that processing becomes very expensive. Do not use wide date ranges</span>
<span class="s2">        with collections that have many images, but remember that Landsat and</span>
<span class="s2">        Sentinel-2 have revisit period of several days. Do not use sample</span>
<span class="s2">        locations - try to come up with actual locations that are relevant to</span>
<span class="s2">        the request.</span>

<span class="s2">        Use Landsat Collection 2, not Landsat Collection 1 ids. If you are getting</span>
<span class="s2">        repeated errors when filtering by a time range, read the dataset description</span>
<span class="s2">        to confirm that the dataset has data for the selected range.</span>

<span class="s2">        Important: after using the set_center() function, just say that you have called</span>
<span class="s2">        this function and wait for the user to hit enter, after which you should</span>
<span class="s2">        continue answering the original request. This will make sure the map is updated</span>
<span class="s2">        on the client side.</span>

<span class="s2">        Once the map is updated and the user told you to proceed, call the analyze_image</span>
<span class="s2">        function() to describe the image for the same location that will be shown in</span>
<span class="s2">        geemap. If you pass additional instructions to analyze_image(), do not disclose</span>
<span class="s2">        what the image is supposed to be to discourage hallucinations - you can only tell</span>
<span class="s2">        the analysis function to pay attention to specific areas (eg, center or top left)</span>
<span class="s2">        or shapes (eg, a line at the bottom) in the image. You can also tell the analysis</span>
<span class="s2">        function about the chosen bands, color palette and min/max visualization</span>
<span class="s2">        parameters, if any, to help it interpret the colors correctly. If the image</span>
<span class="s2">        turns out to be uniform in color with no features,</span>
<span class="s2">        use min/max visualization parameters to enhance contrast.</span>

<span class="s2">        Frequently call the inner_monologue() functions to tell the user about your</span>
<span class="s2">        current thought process. This is a good time to reflect if you have been running</span>
<span class="s2">        into repeated errors of the same kind, and if so, to try a different approach.</span>

<span class="s2">        When you are done, call the score_response() function to evaluate the analysis.</span>
<span class="s2">        You can also tell the scoring function about the chosen bands, color palette</span>
<span class="s2">        and min/max visualization parameters, if any. If the analysis score is below</span>
<span class="s2">        </span><span class="si">{</span><span class="n">target_score</span><span class="si">}</span><span class="s2">,</span>
<span class="s2">        keep trying to find and show a better image. You might have to change the dataset,</span>
<span class="s2">        map location, zoom level, date range, bands, or other parameters - think about</span>
<span class="s2">        what went wrong in the previous attempt and make the change that&#39;s most likely</span>
<span class="s2">        to improve the score.</span>
<span class="s2">        &quot;&quot;&quot;</span>

        <span class="c1"># Class for LLM chat with function calling</span>

        <span class="n">gemini_tools</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">set_center</span><span class="p">,</span>
            <span class="n">show_layer</span><span class="p">,</span>
            <span class="n">analyze_image</span><span class="p">,</span>
            <span class="n">inner_monologue</span><span class="p">,</span>
            <span class="n">get_dataset_description</span><span class="p">,</span>
            <span class="n">score_response</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="k">class</span><span class="w"> </span><span class="nc">Gemini</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Gemini LLM.&quot;&quot;&quot;</span>

            <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="n">system_prompt</span><span class="p">,</span> <span class="n">tools</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="s2">&quot;gemini-1.5-pro-latest&quot;</span>
            <span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">tools</span><span class="p">:</span>
                    <span class="n">tools</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_text_model</span> <span class="o">=</span> <span class="n">genai</span><span class="o">.</span><span class="n">GenerativeModel</span><span class="p">(</span>
                    <span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span><span class="p">,</span> <span class="n">tools</span><span class="o">=</span><span class="n">tools</span>
                <span class="p">)</span>

                <span class="n">initial_messages</span> <span class="o">=</span> <span class="n">glm</span><span class="o">.</span><span class="n">Content</span><span class="p">(</span>
                    <span class="n">role</span><span class="o">=</span><span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="n">parts</span><span class="o">=</span><span class="p">[</span><span class="n">glm</span><span class="o">.</span><span class="n">Part</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">system_prompt</span><span class="p">)]</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_chat_proxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_text_model</span><span class="o">.</span><span class="n">start_chat</span><span class="p">(</span>
                    <span class="n">history</span><span class="o">=</span><span class="n">initial_messages</span><span class="p">,</span> <span class="n">enable_automatic_function_calling</span><span class="o">=</span><span class="kc">True</span>
                <span class="p">)</span>

            <span class="k">def</span><span class="w"> </span><span class="nf">ask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">question</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
                <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">condition</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">sleep_duration</span> <span class="o">=</span> <span class="mi">10</span>
                        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_text_model</span><span class="o">.</span><span class="n">generate_content</span><span class="p">(</span>
                            <span class="n">question</span> <span class="o">+</span> <span class="n">condition</span>
                        <span class="p">)</span>
                        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>
                    <span class="k">except</span> <span class="n">genai</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">generation_types</span><span class="o">.</span><span class="n">StopCandidateException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span>
                            <span class="n">glm</span><span class="o">.</span><span class="n">Candidate</span><span class="o">.</span><span class="n">FinishReason</span><span class="o">.</span><span class="n">RECITATION</span>
                            <span class="o">==</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">finish_reason</span>
                        <span class="p">):</span>
                            <span class="n">condition</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="s2">&quot;Previous attempt returned a RECITATION error. &quot;</span>
                                <span class="s2">&quot;Rephrase the answer to avoid it.&quot;</span>
                            <span class="p">)</span>
                        <span class="k">with</span> <span class="n">chat_output</span><span class="p">:</span>
                            <span class="n">command_input</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;🆁&quot;</span>
                        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                        <span class="k">with</span> <span class="n">chat_output</span><span class="p">:</span>
                            <span class="n">command_input</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;🤔&quot;</span>
                        <span class="k">continue</span>
                    <span class="k">except</span> <span class="p">(</span>
                        <span class="n">google</span><span class="o">.</span><span class="n">api_core</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">TooManyRequests</span><span class="p">,</span>
                        <span class="n">google</span><span class="o">.</span><span class="n">api_core</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">DeadlineExceeded</span><span class="p">,</span>
                    <span class="p">):</span>
                        <span class="k">with</span> <span class="n">debug_output</span><span class="p">:</span>
                            <span class="n">command_input</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;💤&quot;</span>
                        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">sleep_duration</span><span class="p">)</span>
                        <span class="k">continue</span>
                    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="k">with</span> <span class="n">debug_output</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Response </span><span class="si">{</span><span class="n">response</span><span class="si">}</span><span class="s2"> led to error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="nb">breakpoint</span><span class="p">()</span>
                        <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="k">def</span><span class="w"> </span><span class="nf">chat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">question</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">                </span><span class="sd">&quot;&quot;&quot;Adds a question to the ongoing chat session.&quot;&quot;&quot;</span>
                <span class="c1"># Always delay a bit to reduce the chance for rate-limiting errors.</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">condition</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="n">sleep_duration</span> <span class="o">=</span> <span class="mi">10</span>
                <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">response</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chat_proxy</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span>
                            <span class="n">question</span> <span class="o">+</span> <span class="n">condition</span><span class="p">,</span>
                            <span class="n">generation_config</span><span class="o">=</span><span class="p">{</span>
                                <span class="s2">&quot;temperature&quot;</span><span class="p">:</span> <span class="n">temperature</span><span class="p">,</span>
                                <span class="c1"># Use a generous but limited output size to encourage in-depth</span>
                                <span class="c1"># replies.</span>
                                <span class="s2">&quot;max_output_tokens&quot;</span><span class="p">:</span> <span class="mi">5000</span><span class="p">,</span>
                            <span class="p">},</span>
                        <span class="p">)</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">response</span><span class="o">.</span><span class="n">parts</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                                <span class="s2">&quot;Cannot get analysis with reason&quot;</span>
                                <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">candidates</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">finish_reason</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, terminating&quot;</span>
                            <span class="p">)</span>
                    <span class="k">except</span> <span class="n">genai</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">generation_types</span><span class="o">.</span><span class="n">StopCandidateException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span>
                            <span class="n">glm</span><span class="o">.</span><span class="n">Candidate</span><span class="o">.</span><span class="n">FinishReason</span><span class="o">.</span><span class="n">RECITATION</span>
                            <span class="o">==</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">finish_reason</span>
                        <span class="p">):</span>
                            <span class="n">condition</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="s2">&quot;Previous attempt returned a RECITATION error. &quot;</span>
                                <span class="s2">&quot;Rephrase the answer to avoid it.&quot;</span>
                            <span class="p">)</span>
                        <span class="k">with</span> <span class="n">chat_output</span><span class="p">:</span>
                            <span class="n">command_input</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;🆁&quot;</span>
                        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                        <span class="k">with</span> <span class="n">chat_output</span><span class="p">:</span>
                            <span class="n">command_input</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;🤔&quot;</span>
                        <span class="k">continue</span>
                    <span class="k">except</span> <span class="p">(</span>
                        <span class="n">google</span><span class="o">.</span><span class="n">api_core</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">TooManyRequests</span><span class="p">,</span>
                        <span class="n">google</span><span class="o">.</span><span class="n">api_core</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">DeadlineExceeded</span><span class="p">,</span>
                    <span class="p">):</span>
                        <span class="k">with</span> <span class="n">debug_output</span><span class="p">:</span>
                            <span class="n">command_input</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;💤&quot;</span>
                        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
                        <span class="k">continue</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>
                    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="k">with</span> <span class="n">debug_output</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Response </span><span class="si">{</span><span class="n">response</span><span class="si">}</span><span class="s2"> led to the error </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">model</span> <span class="o">=</span> <span class="n">Gemini</span><span class="p">(</span><span class="n">system_prompt</span><span class="p">,</span> <span class="n">gemini_tools</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="n">gemini_model</span><span class="p">)</span>
        <span class="n">analysis_model</span> <span class="o">=</span> <span class="n">Gemini</span><span class="p">(</span><span class="n">scoring_system_prompt</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="n">gemini_model</span><span class="p">)</span>

        <span class="c1"># UI functions</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">set_cursor_waiting</span><span class="p">():</span>
            <span class="n">js_code</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            document.querySelector(&#39;body&#39;).style.cursor = &#39;wait&#39;;</span>
<span class="s2">            &quot;&quot;&quot;</span>
            <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&lt;script&gt;</span><span class="si">{</span><span class="n">js_code</span><span class="si">}</span><span class="s2">&lt;/script&gt;&quot;</span><span class="p">))</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">set_cursor_default</span><span class="p">():</span>
            <span class="n">js_code</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            document.querySelector(&#39;body&#39;).style.cursor = &#39;default&#39;;</span>
<span class="s2">            &quot;&quot;&quot;</span>
            <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&lt;script&gt;</span><span class="si">{</span><span class="n">js_code</span><span class="si">}</span><span class="s2">&lt;/script&gt;&quot;</span><span class="p">))</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">on_submit</span><span class="p">(</span><span class="n">widget</span><span class="p">):</span>
            <span class="c1"># global map_dirty</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">map_dirty</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">command_input</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;❓&quot;</span>
            <span class="n">command</span> <span class="o">=</span> <span class="n">widget</span><span class="o">.</span><span class="n">value</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">command</span><span class="p">:</span>
                <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;go on&quot;</span>
            <span class="k">with</span> <span class="n">chat_output</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&gt; &quot;</span> <span class="o">+</span> <span class="n">command</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">command</span> <span class="o">!=</span> <span class="s2">&quot;go on&quot;</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">debug_output</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&gt; &quot;</span> <span class="o">+</span> <span class="n">command</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">widget</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">set_cursor_waiting</span><span class="p">()</span>
            <span class="n">command_input</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;🤔&quot;</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">chat</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_dirty</span><span class="p">:</span>
                <span class="n">command_input</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;🙏&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">command_input</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;❓&quot;</span>
            <span class="n">set_cursor_default</span><span class="p">()</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">response</span><span class="p">:</span>
                <span class="n">response</span> <span class="o">=</span> <span class="s2">&quot;&lt;EMPTY RESPONSE, HIT ENTER&gt;&quot;</span>
            <span class="k">with</span> <span class="n">chat_output</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">response</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">command_input</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="n">command_input</span><span class="o">.</span><span class="n">on_submit</span><span class="p">(</span><span class="n">on_submit</span><span class="p">)</span>

        <span class="c1"># UI layout</span>

        <span class="c1"># Arrange the chat history and input in a vertical box</span>
        <span class="n">chat_ui</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">VBox</span><span class="p">(</span>
            <span class="p">[</span><span class="n">image_widget</span><span class="p">,</span> <span class="n">chat_output</span><span class="p">],</span>
            <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s2">&quot;420px&quot;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">widget_height</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="n">chat_output</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span>
            <span class="n">width</span><span class="o">=</span><span class="s2">&quot;400px&quot;</span>
        <span class="p">)</span>  <span class="c1"># Fixed width for the left control</span>
        <span class="n">m</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">flex</span><span class="o">=</span><span class="s2">&quot;1 1 auto&quot;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">widget_height</span><span class="p">)</span>

        <span class="n">table</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">(</span>
            <span class="p">[</span><span class="n">chat_ui</span><span class="p">,</span> <span class="n">debug_output</span><span class="p">,</span> <span class="n">m</span><span class="p">],</span> <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">align_items</span><span class="o">=</span><span class="s2">&quot;flex-start&quot;</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">message_widget</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Output</span><span class="p">()</span>
        <span class="k">with</span> <span class="n">message_widget</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;❓ = waiting for user input&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;🙏 = waiting for user to hit enter after calling set_center()&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;🤔 = thinking&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;💤 = sleeping due to retries&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;🆁 = Gemini recitation error&quot;</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="p">[</span><span class="n">table</span><span class="p">,</span> <span class="n">command_input</span><span class="p">,</span> <span class="n">message_widget</span><span class="p">],</span> <span class="n">layout</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;overflow&quot;</span><span class="p">:</span> <span class="s2">&quot;hidden&quot;</span><span class="p">}</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="geemap.ai.Genie.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">project</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">google_api_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gemini_model</span><span class="o">=</span><span class="s1">&#39;gemini-1.5-flash&#39;</span><span class="p">,</span> <span class="n">target_score</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">widget_height</span><span class="o">=</span><span class="s1">&#39;600px&#39;</span><span class="p">,</span> <span class="n">initialize_ee</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#geemap.ai.Genie.__init__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>geemap/ai.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">project</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">google_api_key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">gemini_model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;gemini-1.5-flash&quot;</span><span class="p">,</span>
    <span class="n">target_score</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span>
    <span class="n">widget_height</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;600px&quot;</span><span class="p">,</span>
    <span class="n">initialize_ee</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="c1"># Initialization</span>

    <span class="k">if</span> <span class="n">project</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">project</span> <span class="o">=</span> <span class="n">get_env_var</span><span class="p">(</span><span class="s2">&quot;EE_PROJECT_ID&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">get_env_var</span><span class="p">(</span><span class="s2">&quot;GOOGLE_PROJECT_ID&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">project</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Please provide a valid project ID via the &#39;project&#39; parameter.&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">google_api_key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">google_api_key</span> <span class="o">=</span> <span class="n">get_env_var</span><span class="p">(</span><span class="s2">&quot;GOOGLE_API_KEY&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">google_api_key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Please provide a valid Google API key via the &#39;google_api_key&#39; parameter.&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">initialize_ee</span><span class="p">:</span>
        <span class="n">ee_initialize</span><span class="p">(</span><span class="n">project</span><span class="o">=</span><span class="n">project</span><span class="p">)</span>

    <span class="n">genai</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="n">google_api_key</span><span class="p">)</span>
    <span class="n">storage_client</span> <span class="o">=</span> <span class="n">storage</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">project</span><span class="o">=</span><span class="n">project</span><span class="p">)</span>
    <span class="n">bucket</span> <span class="o">=</span> <span class="n">storage_client</span><span class="o">.</span><span class="n">get_bucket</span><span class="p">(</span><span class="s2">&quot;earthengine-stac&quot;</span><span class="p">)</span>

    <span class="c1"># Score to aim for (on the 0-1 scale). The exact meaning of what &quot;score&quot; means</span>
    <span class="c1"># is left to the LLM.</span>

    <span class="c1"># Count of analysis rounds</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">iteration</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">map_dirty</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">m</span> <span class="o">=</span> <span class="n">Map</span><span class="p">()</span>
    <span class="n">m</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;layer_manager&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">map</span> <span class="o">=</span> <span class="n">m</span>

    <span class="n">analysis_model</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">image_model</span> <span class="o">=</span> <span class="n">genai</span><span class="o">.</span><span class="n">GenerativeModel</span><span class="p">(</span><span class="n">gemini_model</span><span class="p">)</span>

    <span class="c1"># UI widget definitions</span>

    <span class="c1"># We define the widgets early because some functions will write to the debug</span>
    <span class="c1"># and/or chat panels.</span>

    <span class="n">command_input</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span>
        <span class="n">value</span><span class="o">=</span><span class="s2">&quot;show a whole continent Australia DEM visualization using a palette that captures the elevation range&quot;</span><span class="p">,</span>
        <span class="c1"># value=&#39;show NYC&#39;,</span>
        <span class="c1"># value=&#39;show an area with many center pivot irrigation circles&#39;,</span>
        <span class="c1"># value=&#39;show a fire scar&#39;,</span>
        <span class="c1"># value=&#39;show an open pit mine&#39;,</span>
        <span class="c1"># value=&#39;a sea port&#39;,</span>
        <span class="c1"># value=&#39;flood consequences&#39;,</span>
        <span class="c1"># value=&#39;show an interesting modis composite with the relevant visualization and analyze it over Costa Rica&#39;,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;❓&quot;</span><span class="p">,</span>
        <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s2">&quot;100%&quot;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="s2">&quot;50px&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">command_output</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span>
        <span class="n">value</span><span class="o">=</span><span class="s2">&quot;Last command will be here&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">status_label</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Textarea</span><span class="p">(</span>
        <span class="n">value</span><span class="o">=</span><span class="s2">&quot;LLM response will be here&quot;</span><span class="p">,</span>
        <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s2">&quot;50%&quot;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="s2">&quot;100px&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="c1"># widget_height = &quot;600px&quot;</span>
    <span class="n">debug_output</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Output</span><span class="p">(</span>
        <span class="n">layout</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;border&quot;</span><span class="p">:</span> <span class="s2">&quot;1px solid black&quot;</span><span class="p">,</span>
            <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="n">widget_height</span><span class="p">,</span>
            <span class="s2">&quot;overflow&quot;</span><span class="p">:</span> <span class="s2">&quot;scroll&quot;</span><span class="p">,</span>
            <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="s2">&quot;500px&quot;</span><span class="p">,</span>
            <span class="s2">&quot;padding&quot;</span><span class="p">:</span> <span class="s2">&quot;5px&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">)</span>
    <span class="k">with</span> <span class="n">debug_output</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DEBUG COLUMN</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">logo</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
        <span class="s2">&quot;https://drive.usercontent.google.com/download?id=1zE6G_nxXa3G5N0G_32jEhzdum2kMDfNY&amp;export=view&amp;authuser=0&quot;</span>
    <span class="p">)</span><span class="o">.</span><span class="n">content</span>

    <span class="n">image_widget</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">logo</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;png&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>

    <span class="n">chat_output</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Output</span><span class="p">(</span>
        <span class="n">layout</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;border&quot;</span><span class="p">:</span> <span class="s2">&quot;1px solid black&quot;</span><span class="p">,</span>
            <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="s2">&quot;600px&quot;</span><span class="p">,</span>
            <span class="s2">&quot;overflow&quot;</span><span class="p">:</span> <span class="s2">&quot;scroll&quot;</span><span class="p">,</span>
            <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="s2">&quot;300px&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">)</span>

    <span class="k">with</span> <span class="n">chat_output</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CHAT COLUMN</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Simple functions that LLM will call</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_center</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">zoom</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the map center to the given coordinates and zoom level and</span>
<span class="sd">        returns instructions on what to do next.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">debug_output</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SET_CENTER(</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">y</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">zoom</span><span class="si">}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">m</span><span class="o">.</span><span class="n">set_center</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">m</span><span class="o">.</span><span class="n">zoom</span> <span class="o">=</span> <span class="n">zoom</span>
        <span class="c1"># global map_dirty</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">map_dirty</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="s2">&quot;Do not call any more functions in this request to let geemap bounds &quot;</span>
            <span class="s2">&quot;update. Wait for user input.&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_image_layer</span><span class="p">(</span><span class="n">image_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds to the map center an ee.Image with the given id</span>
<span class="sd">        and returns status message (success or failure).&quot;&quot;&quot;</span>
        <span class="n">m</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="n">command_output</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;add_image_layer(&#39;</span><span class="si">{</span><span class="n">image_id</span><span class="si">}</span><span class="s2">&#39;)&quot;</span>
        <span class="n">m</span><span class="o">.</span><span class="n">addLayer</span><span class="p">(</span><span class="n">ee</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="n">image_id</span><span class="p">))</span>
        <span class="k">return</span> <span class="s2">&quot;success&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_dataset_description</span><span class="p">(</span><span class="n">dataset_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fetches JSON STAC description for the given Earth Engine dataset id.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">debug_output</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;LOOKING UP </span><span class="si">{</span><span class="n">dataset_id</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="n">dataset_id</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Get the blob (file)</span>
        <span class="n">path</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;catalog&quot;</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">dataset_id</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;.json&quot;</span>
        <span class="p">)</span>
        <span class="n">blob</span> <span class="o">=</span> <span class="n">bucket</span><span class="o">.</span><span class="n">blob</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">blob</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">return</span> <span class="s2">&quot;dataset file not found: &quot;</span> <span class="o">+</span> <span class="n">path</span>

        <span class="n">file_contents</span> <span class="o">=</span> <span class="n">blob</span><span class="o">.</span><span class="n">download_as_string</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">file_contents</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_image</span><span class="p">(</span><span class="n">image_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fetches from Earth Engine the content of the given URL as bytes.&quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">image_url</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
            <span class="n">image_widget</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span>
            <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">error_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Error downloading image: </span><span class="si">{</span><span class="n">response</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">error_details</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
                    <span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="p">{})</span>
                    <span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">error_details</span><span class="p">:</span>
                    <span class="n">error_message</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; - </span><span class="si">{</span><span class="n">error_details</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">except</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">with</span> <span class="n">debug_output</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;URL </span><span class="si">%s</span><span class="s2"> causes </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">image_url</span><span class="p">,</span> <span class="n">error_message</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">show_layer</span><span class="p">(</span><span class="n">python_code</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute the given Earth Engine Python client code and add the result to</span>
<span class="sd">        the map. Returns the status message (success or error message).&quot;&quot;&quot;</span>
        <span class="n">m</span><span class="o">.</span><span class="n">layers</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">layers</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">while</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&quot;&#39;</span> <span class="ow">in</span> <span class="n">python_code</span><span class="p">:</span>
            <span class="n">python_code</span> <span class="o">=</span> <span class="n">python_code</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&quot;&#39;</span><span class="p">,</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>
        <span class="n">command_output</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;show_layer(&#39;</span><span class="si">{</span><span class="n">python_code</span><span class="si">}</span><span class="s2">&#39;)&quot;</span>
        <span class="k">with</span> <span class="n">debug_output</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;IMAGE:</span><span class="se">\n</span><span class="s2"> </span><span class="si">{</span><span class="n">python_code</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">locals</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">exec</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;import ee; im = </span><span class="si">{</span><span class="n">python_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">{},</span> <span class="nb">locals</span><span class="p">)</span>
            <span class="n">m</span><span class="o">.</span><span class="n">addLayer</span><span class="p">(</span><span class="nb">locals</span><span class="p">[</span><span class="s2">&quot;im&quot;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">debug_output</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ERROR: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;success&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">inner_monologue</span><span class="p">(</span><span class="n">thoughts</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sends the current thinking of the LLM model to the user so that they are</span>
<span class="sd">        aware of what the model is thinking between function calls.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">debug_output</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;THOUGHTS:</span><span class="se">\n</span><span class="s2"> </span><span class="si">{</span><span class="n">thoughts</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;success&quot;</span>

    <span class="c1"># Functions for textual analysis of images</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_lat_lon_to_tile</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">zoom_level</span><span class="p">):</span>
        <span class="c1"># Convert latitude and longitude to Mercator coordinates</span>
        <span class="n">x_merc</span> <span class="o">=</span> <span class="p">(</span><span class="n">lon</span> <span class="o">+</span> <span class="mi">180</span><span class="p">)</span> <span class="o">/</span> <span class="mi">360</span>
        <span class="n">y_merc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="mi">1</span>
            <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                <span class="n">math</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">lat</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">lat</span><span class="p">))</span>
            <span class="p">)</span>
            <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span>
        <span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="c1"># Calculate number of tiles</span>
        <span class="n">n</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="n">zoom_level</span>

        <span class="c1"># Convert to tile coordinates</span>
        <span class="n">X</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">x_merc</span> <span class="o">*</span> <span class="n">n</span><span class="p">)</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">y_merc</span> <span class="o">*</span> <span class="n">n</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">analyze_image</span><span class="p">(</span><span class="n">additional_instructions</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns GenAI image analysis describing the current map image.</span>
<span class="sd">        Optional additional instructions might be passed to target the analysis</span>
<span class="sd">        more precisely.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># global map_dirty</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_dirty</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;MAP DIRTY&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="s2">&quot;Map is not ready. Stop further processing and ask for user input&quot;</span>
            <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_analyze_image</span><span class="p">(</span><span class="n">additional_instructions</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_analyze_image</span><span class="p">(</span><span class="n">additional_instructions</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="c1"># bounds = m.bounds</span>
        <span class="c1"># s, w = bounds[0]</span>
        <span class="c1"># n, e = bounds[1]</span>
        <span class="c1"># zoom = int(m.zoom)</span>

        <span class="c1"># min_tile_x, max_tile_y = _lat_lon_to_tile(w, s, zoom)</span>
        <span class="c1"># max_tile_x, min_tile_y = _lat_lon_to_tile(e, n, zoom)</span>
        <span class="c1"># min_tile_x = max(0, min_tile_x)</span>
        <span class="c1"># max_tile_x = min(2**zoom - 1, max_tile_x)</span>
        <span class="c1"># min_tile_y = max(0, min_tile_y)</span>
        <span class="c1"># max_tile_y = min(2**zoom - 1, max_tile_y)</span>

        <span class="c1"># with debug_output:</span>
        <span class="c1">#     if additional_instructions:</span>
        <span class="c1">#         print(f&quot;RUNNING IMAGE ANALYSIS: {additional_instructions}...\n&quot;)</span>
        <span class="c1">#     else:</span>
        <span class="c1">#         print(&quot;RUNNING IMAGE ANALYSIS...\n&quot;)</span>

        <span class="c1"># layers = list(m.ee_layer_dict.values())</span>
        <span class="c1"># if not layers:</span>
        <span class="c1">#     return &quot;No data layers loaded&quot;</span>
        <span class="c1"># url_template = layers[-1][&quot;ee_layer&quot;].url</span>
        <span class="c1"># tile_width = 256</span>
        <span class="c1"># tile_height = 256</span>
        <span class="c1"># image_width = (max_tile_x - min_tile_x + 1) * tile_width</span>
        <span class="c1"># image_height = (max_tile_y - min_tile_y + 1) * tile_height</span>

        <span class="c1"># # Create a new blank image</span>
        <span class="c1"># image = PIL.Image.new(&quot;RGB&quot;, (image_width, image_height))</span>

        <span class="c1"># for y in range(min_tile_y, max_tile_y + 1):</span>
        <span class="c1">#     for x in range(min_tile_x, max_tile_x + 1):</span>
        <span class="c1">#         tile_url = str.format(url_template, x=x, y=y, z=zoom)</span>
        <span class="c1">#         # print(tile_url)</span>
        <span class="c1">#         tile_img = PIL.Image.open(io.BytesIO(get_image(tile_url)))</span>

        <span class="c1">#         offset_x = (x - min_tile_x) * tile_width</span>
        <span class="c1">#         offset_y = (y - min_tile_y) * tile_height</span>
        <span class="c1">#         image.paste(tile_img, (offset_x, offset_y))</span>

        <span class="c1"># width, height = image.size</span>
        <span class="c1"># num_bands = len(image.getbands())</span>

        <span class="k">with</span> <span class="n">debug_output</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">additional_instructions</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;RUNNING IMAGE ANALYSIS: </span><span class="si">{</span><span class="n">additional_instructions</span><span class="si">}</span><span class="s2">...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;RUNNING IMAGE ANALYSIS...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">layers</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">ee_layer_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">layers</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;No data layers loaded&quot;</span>
        <span class="n">image_temp_file</span> <span class="o">=</span> <span class="n">temp_file_path</span><span class="p">(</span><span class="n">extension</span><span class="o">=</span><span class="s2">&quot;jpg&quot;</span><span class="p">)</span>
        <span class="n">layer_name</span> <span class="o">=</span> <span class="n">layers</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;ee_layer&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
        <span class="n">m</span><span class="o">.</span><span class="n">layer_to_image</span><span class="p">(</span><span class="n">layer_name</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">image_temp_file</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">get_scale</span><span class="p">())</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">PIL</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">image_temp_file</span><span class="p">)</span>

        <span class="n">image_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
        <span class="n">image_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">image_array</span><span class="p">)</span>
        <span class="n">image_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">image_array</span><span class="p">)</span>

        <span class="n">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">image_temp_file</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span>
        <span class="n">image_widget</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c1"># Skip an LLM call when we can simply tell that something is wrong.</span>
        <span class="c1"># (Also, LLMs might hallucinate on uniform images.)</span>
        <span class="k">if</span> <span class="n">image_min</span> <span class="o">==</span> <span class="n">image_max</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;The image tile has a single uniform color with value &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">image_min</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>

        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;You are an objective, precise overhead imagery analyst.</span>
<span class="s2">    Describe what the provided map tile depicts in terms of:</span>

<span class="s2">    1. The colors, textures, and patterns visible in the image.</span>
<span class="s2">    2. The spatial distribution, shape, and extent of distinct features or regions.</span>
<span class="s2">    3. Any notable contrasts, boundaries, or gradients between different areas.</span>

<span class="s2">    Avoid making assumptions about the specific geographic location, time period,</span>
<span class="s2">    or cause of the observed features. Focus solely on the literal contents of the</span>
<span class="s2">    image itself. Clearly indicate which features look natural, which look human-made,</span>
<span class="s2">    and which look like image artifacts. (Eg, a completely straight blue line</span>
<span class="s2">    is unlikely to be a river.)</span>

<span class="s2">    If the image is ambiguous or unclear, state so directly. Do not speculate or</span>
<span class="s2">    hypothesize beyond what is directly visible.</span>

<span class="s2">    If the image is of mostly the same color (white, gray, or black) with little</span>
<span class="s2">    contrast, just report that and do not describe the features.</span>

<span class="s2">    Use clear, concise language. Avoid subjective interpretations or analogies.</span>
<span class="s2">    Organize your response into structured paragraphs.</span>
<span class="s2">    &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">additional_instructions</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">+=</span> <span class="n">additional_instructions</span>
        <span class="n">req</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;parts&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">query</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;inline_data&quot;</span><span class="p">:</span> <span class="n">image</span><span class="p">},</span>
            <span class="p">]</span>
        <span class="p">}</span>
        <span class="n">image_response</span> <span class="o">=</span> <span class="n">image_model</span><span class="o">.</span><span class="n">generate_content</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">debug_output</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ANALYSIS RESULT: </span><span class="si">{</span><span class="n">image_response</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">image_response</span><span class="o">.</span><span class="n">text</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">debug_output</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;UNEXPECTED IMAGE RESPONSE: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">image_response</span><span class="p">)</span>
            <span class="nb">breakpoint</span><span class="p">()</span>

    <span class="c1"># Function for scoring how well image analysis corresponds to the user query.</span>

    <span class="c1"># Note that we ask for the score outside of the main agent chat to keep</span>
    <span class="c1"># the scoring more objective.</span>

    <span class="n">scoring_system_prompt</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    After looking at the user query and the map tile analysis, start</span>
<span class="s2">    your answer with a number between 0 and 1 indicating how relevant</span>
<span class="s2">    the image is as an answer to the query. (0=irrelevant, 1=perfect answer)</span>

<span class="s2">    Make sure you have enough justification to definitively declare the analysis</span>
<span class="s2">    relevant - it&#39;s better to give a false negative than a false positive. However,</span>
<span class="s2">    the image analysis identifies specific matching landmarks (eg, the</span>
<span class="s2">    the outlines of Manhattan island for a request to show NYC), believe it.</span>

<span class="s2">    Do not assume  too much (eg, that the presence of green doesn&#39;t by itself mean the</span>
<span class="s2">    image shows forest); attempt to find multiple (at least three) independent</span>
<span class="s2">    lines of evidence before declaring victory and cite all these lines of evidence</span>
<span class="s2">    in your response.</span>

<span class="s2">    Be very, very skeptical - look for specific features that match only the query</span>
<span class="s2">    and nothing else (eg, if the query looks for a river, a completely straight blue</span>
<span class="s2">    line is unlikely to be a river). Think about what size the features are based on</span>
<span class="s2">    the zoom level and whether this size matches the feature size expected from</span>
<span class="s2">    first principles.</span>

<span class="s2">    If there is ambiguity or uncertainty, express it in your analysis and</span>
<span class="s2">    lower the score accordingly. If the image analysis is inconclusive, try zooming</span>
<span class="s2">    out to make sure you are looking at the right spot. Do not reduce the score if</span>
<span class="s2">    the analysis does not mention visualization parameters - they are just given for</span>
<span class="s2">    your reference. The image might show an area slightly larger than requested -</span>
<span class="s2">    this is okay, do not reduce the score on this account.</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">score_response</span><span class="p">(</span>
        <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">visualization_parameters</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">analysis</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns how well the given analysis describes a map tile returned for</span>
<span class="sd">        the given query. The analysis starts with a number between 0 and 1.</span>

<span class="sd">        Arguments:</span>
<span class="sd">        query: user-specified query</span>
<span class="sd">        visualization_parameters: description of the bands used and visualization</span>
<span class="sd">            parameters applied to the map tile</span>
<span class="sd">        analysis: the textual description of the map tile</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">debug_output</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;VIZ PARAMS: </span><span class="si">{</span><span class="n">visualization_parameters</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">question</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;For user query </span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2"> please score the following analysis:</span>
<span class="s2">        </span><span class="si">{</span><span class="n">analysis</span><span class="si">}</span><span class="s2">. The answer must start with a number between 0 and 1.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">visualization_parameters</span><span class="p">:</span>
            <span class="n">question</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Do not assume that common bands or visualization</span>
<span class="s2">            parameters should have been used, as the visualization used the</span>
<span class="s2">            following parameters: </span><span class="si">{</span><span class="n">visualization_parameters</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">analysis_model</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="n">question</span><span class="p">)</span>
        <span class="c1"># global iteration</span>
        <span class="k">with</span> <span class="n">debug_output</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SCORE #</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">iteration</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="s2"> </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iteration</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">debug_output</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;UNEXPECTED SCORE RESPONSE: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="c1"># Main prompt for the agent</span>

    <span class="n">system_prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    The client is running in a Python notebook with a geemap Map displayed.</span>
<span class="s2">    When composing Python code, do not use getMapId - just return the single-line</span>
<span class="s2">    layer definition like &#39;ee.Image(&quot;USGS/SRTMGL1_003&quot;)&#39; that we will pass to</span>
<span class="s2">    Map.addLayer(). Do not escape quotation marks in Python code.</span>

<span class="s2">    Be sure to use Python, not Javascript, syntax for keyword parameters in</span>
<span class="s2">    Python code (that is, &quot;function(arg=value)&quot;) Using the provided functions,</span>
<span class="s2">    respond to the user command following below (or respond why it&#39;s not possible).</span>
<span class="s2">    If you get an Earth Engine error, attempt to fix it and then try again.</span>

<span class="s2">    Before you choose a dataset, think about what kind of dataset would be most</span>
<span class="s2">    suitable for the query. Also think about what zoom level would be suitable for</span>
<span class="s2">    the query, keeping in mind that for high-resolution image collections higher</span>
<span class="s2">    zoom levels are better to speed up tile loading.</span>

<span class="s2">    Once you have chosen a dataset, read its description using the provided function</span>
<span class="s2">    to see what spatial and temporal range it covers, what bands it has, as well as</span>
<span class="s2">    to find the recommended visualization parameters. Explain using the inner</span>
<span class="s2">    monlogue function why you chose a specific dataset, zoom level and map location.</span>

<span class="s2">    Prefer mosaicing image collections using the mosaic() function, don&#39;t get</span>
<span class="s2">    individual images from collections via</span>
<span class="s2">    &#39;first()&#39;. Choose a tile size and zoom level that will ensure the</span>
<span class="s2">    tile has enough pixels in it to avoid graininess, but not so many</span>
<span class="s2">    that processing becomes very expensive. Do not use wide date ranges</span>
<span class="s2">    with collections that have many images, but remember that Landsat and</span>
<span class="s2">    Sentinel-2 have revisit period of several days. Do not use sample</span>
<span class="s2">    locations - try to come up with actual locations that are relevant to</span>
<span class="s2">    the request.</span>

<span class="s2">    Use Landsat Collection 2, not Landsat Collection 1 ids. If you are getting</span>
<span class="s2">    repeated errors when filtering by a time range, read the dataset description</span>
<span class="s2">    to confirm that the dataset has data for the selected range.</span>

<span class="s2">    Important: after using the set_center() function, just say that you have called</span>
<span class="s2">    this function and wait for the user to hit enter, after which you should</span>
<span class="s2">    continue answering the original request. This will make sure the map is updated</span>
<span class="s2">    on the client side.</span>

<span class="s2">    Once the map is updated and the user told you to proceed, call the analyze_image</span>
<span class="s2">    function() to describe the image for the same location that will be shown in</span>
<span class="s2">    geemap. If you pass additional instructions to analyze_image(), do not disclose</span>
<span class="s2">    what the image is supposed to be to discourage hallucinations - you can only tell</span>
<span class="s2">    the analysis function to pay attention to specific areas (eg, center or top left)</span>
<span class="s2">    or shapes (eg, a line at the bottom) in the image. You can also tell the analysis</span>
<span class="s2">    function about the chosen bands, color palette and min/max visualization</span>
<span class="s2">    parameters, if any, to help it interpret the colors correctly. If the image</span>
<span class="s2">    turns out to be uniform in color with no features,</span>
<span class="s2">    use min/max visualization parameters to enhance contrast.</span>

<span class="s2">    Frequently call the inner_monologue() functions to tell the user about your</span>
<span class="s2">    current thought process. This is a good time to reflect if you have been running</span>
<span class="s2">    into repeated errors of the same kind, and if so, to try a different approach.</span>

<span class="s2">    When you are done, call the score_response() function to evaluate the analysis.</span>
<span class="s2">    You can also tell the scoring function about the chosen bands, color palette</span>
<span class="s2">    and min/max visualization parameters, if any. If the analysis score is below</span>
<span class="s2">    </span><span class="si">{</span><span class="n">target_score</span><span class="si">}</span><span class="s2">,</span>
<span class="s2">    keep trying to find and show a better image. You might have to change the dataset,</span>
<span class="s2">    map location, zoom level, date range, bands, or other parameters - think about</span>
<span class="s2">    what went wrong in the previous attempt and make the change that&#39;s most likely</span>
<span class="s2">    to improve the score.</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="c1"># Class for LLM chat with function calling</span>

    <span class="n">gemini_tools</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">set_center</span><span class="p">,</span>
        <span class="n">show_layer</span><span class="p">,</span>
        <span class="n">analyze_image</span><span class="p">,</span>
        <span class="n">inner_monologue</span><span class="p">,</span>
        <span class="n">get_dataset_description</span><span class="p">,</span>
        <span class="n">score_response</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Gemini</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Gemini LLM.&quot;&quot;&quot;</span>

        <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">system_prompt</span><span class="p">,</span> <span class="n">tools</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="s2">&quot;gemini-1.5-pro-latest&quot;</span>
        <span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">tools</span><span class="p">:</span>
                <span class="n">tools</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_text_model</span> <span class="o">=</span> <span class="n">genai</span><span class="o">.</span><span class="n">GenerativeModel</span><span class="p">(</span>
                <span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span><span class="p">,</span> <span class="n">tools</span><span class="o">=</span><span class="n">tools</span>
            <span class="p">)</span>

            <span class="n">initial_messages</span> <span class="o">=</span> <span class="n">glm</span><span class="o">.</span><span class="n">Content</span><span class="p">(</span>
                <span class="n">role</span><span class="o">=</span><span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="n">parts</span><span class="o">=</span><span class="p">[</span><span class="n">glm</span><span class="o">.</span><span class="n">Part</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">system_prompt</span><span class="p">)]</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_chat_proxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_text_model</span><span class="o">.</span><span class="n">start_chat</span><span class="p">(</span>
                <span class="n">history</span><span class="o">=</span><span class="n">initial_messages</span><span class="p">,</span> <span class="n">enable_automatic_function_calling</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">ask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">question</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">condition</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">sleep_duration</span> <span class="o">=</span> <span class="mi">10</span>
                    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_text_model</span><span class="o">.</span><span class="n">generate_content</span><span class="p">(</span>
                        <span class="n">question</span> <span class="o">+</span> <span class="n">condition</span>
                    <span class="p">)</span>
                    <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>
                <span class="k">except</span> <span class="n">genai</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">generation_types</span><span class="o">.</span><span class="n">StopCandidateException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="n">glm</span><span class="o">.</span><span class="n">Candidate</span><span class="o">.</span><span class="n">FinishReason</span><span class="o">.</span><span class="n">RECITATION</span>
                        <span class="o">==</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">finish_reason</span>
                    <span class="p">):</span>
                        <span class="n">condition</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="s2">&quot;Previous attempt returned a RECITATION error. &quot;</span>
                            <span class="s2">&quot;Rephrase the answer to avoid it.&quot;</span>
                        <span class="p">)</span>
                    <span class="k">with</span> <span class="n">chat_output</span><span class="p">:</span>
                        <span class="n">command_input</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;🆁&quot;</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                    <span class="k">with</span> <span class="n">chat_output</span><span class="p">:</span>
                        <span class="n">command_input</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;🤔&quot;</span>
                    <span class="k">continue</span>
                <span class="k">except</span> <span class="p">(</span>
                    <span class="n">google</span><span class="o">.</span><span class="n">api_core</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">TooManyRequests</span><span class="p">,</span>
                    <span class="n">google</span><span class="o">.</span><span class="n">api_core</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">DeadlineExceeded</span><span class="p">,</span>
                <span class="p">):</span>
                    <span class="k">with</span> <span class="n">debug_output</span><span class="p">:</span>
                        <span class="n">command_input</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;💤&quot;</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">sleep_duration</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">with</span> <span class="n">debug_output</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Response </span><span class="si">{</span><span class="n">response</span><span class="si">}</span><span class="s2"> led to error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="nb">breakpoint</span><span class="p">()</span>
                    <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">chat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">question</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Adds a question to the ongoing chat session.&quot;&quot;&quot;</span>
            <span class="c1"># Always delay a bit to reduce the chance for rate-limiting errors.</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">condition</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">sleep_duration</span> <span class="o">=</span> <span class="mi">10</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">response</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chat_proxy</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span>
                        <span class="n">question</span> <span class="o">+</span> <span class="n">condition</span><span class="p">,</span>
                        <span class="n">generation_config</span><span class="o">=</span><span class="p">{</span>
                            <span class="s2">&quot;temperature&quot;</span><span class="p">:</span> <span class="n">temperature</span><span class="p">,</span>
                            <span class="c1"># Use a generous but limited output size to encourage in-depth</span>
                            <span class="c1"># replies.</span>
                            <span class="s2">&quot;max_output_tokens&quot;</span><span class="p">:</span> <span class="mi">5000</span><span class="p">,</span>
                        <span class="p">},</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">response</span><span class="o">.</span><span class="n">parts</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                            <span class="s2">&quot;Cannot get analysis with reason&quot;</span>
                            <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">candidates</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">finish_reason</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, terminating&quot;</span>
                        <span class="p">)</span>
                <span class="k">except</span> <span class="n">genai</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">generation_types</span><span class="o">.</span><span class="n">StopCandidateException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="n">glm</span><span class="o">.</span><span class="n">Candidate</span><span class="o">.</span><span class="n">FinishReason</span><span class="o">.</span><span class="n">RECITATION</span>
                        <span class="o">==</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">finish_reason</span>
                    <span class="p">):</span>
                        <span class="n">condition</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="s2">&quot;Previous attempt returned a RECITATION error. &quot;</span>
                            <span class="s2">&quot;Rephrase the answer to avoid it.&quot;</span>
                        <span class="p">)</span>
                    <span class="k">with</span> <span class="n">chat_output</span><span class="p">:</span>
                        <span class="n">command_input</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;🆁&quot;</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                    <span class="k">with</span> <span class="n">chat_output</span><span class="p">:</span>
                        <span class="n">command_input</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;🤔&quot;</span>
                    <span class="k">continue</span>
                <span class="k">except</span> <span class="p">(</span>
                    <span class="n">google</span><span class="o">.</span><span class="n">api_core</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">TooManyRequests</span><span class="p">,</span>
                    <span class="n">google</span><span class="o">.</span><span class="n">api_core</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">DeadlineExceeded</span><span class="p">,</span>
                <span class="p">):</span>
                    <span class="k">with</span> <span class="n">debug_output</span><span class="p">:</span>
                        <span class="n">command_input</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;💤&quot;</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>
                <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">with</span> <span class="n">debug_output</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Response </span><span class="si">{</span><span class="n">response</span><span class="si">}</span><span class="s2"> led to the error </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">model</span> <span class="o">=</span> <span class="n">Gemini</span><span class="p">(</span><span class="n">system_prompt</span><span class="p">,</span> <span class="n">gemini_tools</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="n">gemini_model</span><span class="p">)</span>
    <span class="n">analysis_model</span> <span class="o">=</span> <span class="n">Gemini</span><span class="p">(</span><span class="n">scoring_system_prompt</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="n">gemini_model</span><span class="p">)</span>

    <span class="c1"># UI functions</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_cursor_waiting</span><span class="p">():</span>
        <span class="n">js_code</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        document.querySelector(&#39;body&#39;).style.cursor = &#39;wait&#39;;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&lt;script&gt;</span><span class="si">{</span><span class="n">js_code</span><span class="si">}</span><span class="s2">&lt;/script&gt;&quot;</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_cursor_default</span><span class="p">():</span>
        <span class="n">js_code</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        document.querySelector(&#39;body&#39;).style.cursor = &#39;default&#39;;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&lt;script&gt;</span><span class="si">{</span><span class="n">js_code</span><span class="si">}</span><span class="s2">&lt;/script&gt;&quot;</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">on_submit</span><span class="p">(</span><span class="n">widget</span><span class="p">):</span>
        <span class="c1"># global map_dirty</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">map_dirty</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">command_input</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;❓&quot;</span>
        <span class="n">command</span> <span class="o">=</span> <span class="n">widget</span><span class="o">.</span><span class="n">value</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">command</span><span class="p">:</span>
            <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;go on&quot;</span>
        <span class="k">with</span> <span class="n">chat_output</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&gt; &quot;</span> <span class="o">+</span> <span class="n">command</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">command</span> <span class="o">!=</span> <span class="s2">&quot;go on&quot;</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">debug_output</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&gt; &quot;</span> <span class="o">+</span> <span class="n">command</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">widget</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">set_cursor_waiting</span><span class="p">()</span>
        <span class="n">command_input</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;🤔&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">chat</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_dirty</span><span class="p">:</span>
            <span class="n">command_input</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;🙏&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">command_input</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;❓&quot;</span>
        <span class="n">set_cursor_default</span><span class="p">()</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">response</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="s2">&quot;&lt;EMPTY RESPONSE, HIT ENTER&gt;&quot;</span>
        <span class="k">with</span> <span class="n">chat_output</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">response</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">command_input</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="n">command_input</span><span class="o">.</span><span class="n">on_submit</span><span class="p">(</span><span class="n">on_submit</span><span class="p">)</span>

    <span class="c1"># UI layout</span>

    <span class="c1"># Arrange the chat history and input in a vertical box</span>
    <span class="n">chat_ui</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">VBox</span><span class="p">(</span>
        <span class="p">[</span><span class="n">image_widget</span><span class="p">,</span> <span class="n">chat_output</span><span class="p">],</span>
        <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s2">&quot;420px&quot;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">widget_height</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">chat_output</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span>
        <span class="n">width</span><span class="o">=</span><span class="s2">&quot;400px&quot;</span>
    <span class="p">)</span>  <span class="c1"># Fixed width for the left control</span>
    <span class="n">m</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">flex</span><span class="o">=</span><span class="s2">&quot;1 1 auto&quot;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">widget_height</span><span class="p">)</span>

    <span class="n">table</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">(</span>
        <span class="p">[</span><span class="n">chat_ui</span><span class="p">,</span> <span class="n">debug_output</span><span class="p">,</span> <span class="n">m</span><span class="p">],</span> <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">align_items</span><span class="o">=</span><span class="s2">&quot;flex-start&quot;</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="n">message_widget</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Output</span><span class="p">()</span>
    <span class="k">with</span> <span class="n">message_widget</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;❓ = waiting for user input&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;🙏 = waiting for user to hit enter after calling set_center()&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;🤔 = thinking&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;💤 = sleeping due to retries&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;🆁 = Gemini recitation error&quot;</span><span class="p">)</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
        <span class="p">[</span><span class="n">table</span><span class="p">,</span> <span class="n">command_input</span><span class="p">,</span> <span class="n">message_widget</span><span class="p">],</span> <span class="n">layout</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;overflow&quot;</span><span class="p">:</span> <span class="s2">&quot;hidden&quot;</span><span class="p">}</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="geemap.ai.PrecomputedEmbeddings" class="doc doc-heading">
            <code>PrecomputedEmbeddings</code>


<a href="#geemap.ai.PrecomputedEmbeddings" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="langchain.embeddings.base.Embeddings">Embeddings</span></code></p>


        <p>Class for handling precomputed embeddings.</p>








              <details class="quote">
                <summary>Source code in <code>geemap/ai.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">PrecomputedEmbeddings</span><span class="p">(</span><span class="n">Embeddings</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class for handling precomputed embeddings.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">embeddings_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initializes the PrecomputedEmbeddings.</span>

<span class="sd">        Args:</span>
<span class="sd">            embeddings_dict (Dict[str, List[float]]): A dictionary mapping texts to their embeddings.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">embeddings_dict</span> <span class="o">=</span> <span class="n">embeddings_dict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">TextEmbeddingModel</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s2">&quot;google/text-embedding-004&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">embed_documents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">texts</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Embeds a list of documents.</span>

<span class="sd">        Args:</span>
<span class="sd">            texts (List[str]): The list of texts to embed.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List[List[float]]: The list of embeddings.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">embeddings_dict</span><span class="p">[</span><span class="n">text</span><span class="p">]</span> <span class="k">for</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">texts</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">embed_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Embeds a query text.</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str): The query text to embed.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List[float]: The embedding of the query text.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">get_embeddings</span><span class="p">([</span><span class="n">text</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">embeddings</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="geemap.ai.PrecomputedEmbeddings.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">embeddings_dict</span><span class="p">)</span></code>

<a href="#geemap.ai.PrecomputedEmbeddings.__init__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Initializes the PrecomputedEmbeddings.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>embeddings_dict</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.List">List</span>[<span title="float">float</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary mapping texts to their embeddings.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geemap/ai.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">embeddings_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initializes the PrecomputedEmbeddings.</span>

<span class="sd">    Args:</span>
<span class="sd">        embeddings_dict (Dict[str, List[float]]): A dictionary mapping texts to their embeddings.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">embeddings_dict</span> <span class="o">=</span> <span class="n">embeddings_dict</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">TextEmbeddingModel</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s2">&quot;google/text-embedding-004&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="geemap.ai.PrecomputedEmbeddings.embed_documents" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">embed_documents</span><span class="p">(</span><span class="n">texts</span><span class="p">)</span></code>

<a href="#geemap.ai.PrecomputedEmbeddings.embed_documents" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Embeds a list of documents.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>texts</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The list of texts to embed.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.List">List</span>[<span title="float">float</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[List[float]]: The list of embeddings.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geemap/ai.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">embed_documents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">texts</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Embeds a list of documents.</span>

<span class="sd">    Args:</span>
<span class="sd">        texts (List[str]): The list of texts to embed.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[List[float]]: The list of embeddings.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">embeddings_dict</span><span class="p">[</span><span class="n">text</span><span class="p">]</span> <span class="k">for</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">texts</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="geemap.ai.PrecomputedEmbeddings.embed_query" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">embed_query</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></code>

<a href="#geemap.ai.PrecomputedEmbeddings.embed_query" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Embeds a query text.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>text</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The query text to embed.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[float]: The embedding of the query text.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geemap/ai.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">embed_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Embeds a query text.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): The query text to embed.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[float]: The embedding of the query text.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">get_embeddings</span><span class="p">([</span><span class="n">text</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">embeddings</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="geemap.ai.explain_relevance" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">explain_relevance</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">dataset_id</span><span class="p">,</span> <span class="n">catalog</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="s1">&#39;gemini-1.5-pro-latest&#39;</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#geemap.ai.explain_relevance" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Prompts LLM to explain the relevance of a dataset to a query.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>query</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The user's query.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dataset_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The ID of the dataset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>catalog</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Catalog (geemap.ai.Catalog)" href="#geemap.ai.Catalog">Catalog</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The catalog containing the dataset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>model_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the model to use. Defaults to "gemini-1.5-pro-latest".</p>
              </div>
            </td>
            <td>
                  <code>&#39;gemini-1.5-pro-latest&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>stream</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to stream the response. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The explanation of the dataset's relevance to the query.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geemap/ai.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1679</span>
<span class="normal">1680</span>
<span class="normal">1681</span>
<span class="normal">1682</span>
<span class="normal">1683</span>
<span class="normal">1684</span>
<span class="normal">1685</span>
<span class="normal">1686</span>
<span class="normal">1687</span>
<span class="normal">1688</span>
<span class="normal">1689</span>
<span class="normal">1690</span>
<span class="normal">1691</span>
<span class="normal">1692</span>
<span class="normal">1693</span>
<span class="normal">1694</span>
<span class="normal">1695</span>
<span class="normal">1696</span>
<span class="normal">1697</span>
<span class="normal">1698</span>
<span class="normal">1699</span>
<span class="normal">1700</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">explain_relevance</span><span class="p">(</span>
    <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">dataset_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">catalog</span><span class="p">:</span> <span class="n">Catalog</span><span class="p">,</span>
    <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;gemini-1.5-pro-latest&quot;</span><span class="p">,</span>
    <span class="n">stream</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Prompts LLM to explain the relevance of a dataset to a query.</span>

<span class="sd">    Args:</span>
<span class="sd">        query (str): The user&#39;s query.</span>
<span class="sd">        dataset_id (str): The ID of the dataset.</span>
<span class="sd">        catalog (Catalog): The catalog containing the dataset.</span>
<span class="sd">        model_name (str): The name of the model to use. Defaults to &quot;gemini-1.5-pro-latest&quot;.</span>
<span class="sd">        stream (bool): Whether to stream the response. Defaults to False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The explanation of the dataset&#39;s relevance to the query.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">stac_json</span> <span class="o">=</span> <span class="n">catalog</span><span class="o">.</span><span class="n">get_collection</span><span class="p">(</span><span class="n">dataset_id</span><span class="p">)</span><span class="o">.</span><span class="n">stac_json</span>
    <span class="k">return</span> <span class="n">explain_relevance_from_stac_json</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">stac_json</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">stream</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="geemap.ai.explain_relevance_from_stac_json" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">explain_relevance_from_stac_json</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">stac_json</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="s1">&#39;gemini-1.5-pro-latest&#39;</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#geemap.ai.explain_relevance_from_stac_json" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Prompts LLM to explain the relevance of a dataset to a query using its STAC JSON.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>query</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The user's query.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>stac_json</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The STAC JSON of the dataset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>model_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the model to use. Defaults to "gemini-1.5-pro-latest".</p>
              </div>
            </td>
            <td>
                  <code>&#39;gemini-1.5-pro-latest&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>stream</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to stream the response. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The explanation of the dataset's relevance to the query.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geemap/ai.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1703</span>
<span class="normal">1704</span>
<span class="normal">1705</span>
<span class="normal">1706</span>
<span class="normal">1707</span>
<span class="normal">1708</span>
<span class="normal">1709</span>
<span class="normal">1710</span>
<span class="normal">1711</span>
<span class="normal">1712</span>
<span class="normal">1713</span>
<span class="normal">1714</span>
<span class="normal">1715</span>
<span class="normal">1716</span>
<span class="normal">1717</span>
<span class="normal">1718</span>
<span class="normal">1719</span>
<span class="normal">1720</span>
<span class="normal">1721</span>
<span class="normal">1722</span>
<span class="normal">1723</span>
<span class="normal">1724</span>
<span class="normal">1725</span>
<span class="normal">1726</span>
<span class="normal">1727</span>
<span class="normal">1728</span>
<span class="normal">1729</span>
<span class="normal">1730</span>
<span class="normal">1731</span>
<span class="normal">1732</span>
<span class="normal">1733</span>
<span class="normal">1734</span>
<span class="normal">1735</span>
<span class="normal">1736</span>
<span class="normal">1737</span>
<span class="normal">1738</span>
<span class="normal">1739</span>
<span class="normal">1740</span>
<span class="normal">1741</span>
<span class="normal">1742</span>
<span class="normal">1743</span>
<span class="normal">1744</span>
<span class="normal">1745</span>
<span class="normal">1746</span>
<span class="normal">1747</span>
<span class="normal">1748</span>
<span class="normal">1749</span>
<span class="normal">1750</span>
<span class="normal">1751</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@retry</span><span class="p">(</span>
    <span class="n">stop</span><span class="o">=</span><span class="n">stop_after_attempt</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
    <span class="n">wait</span><span class="o">=</span><span class="n">wait_exponential</span><span class="p">(</span><span class="n">multiplier</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span>
    <span class="n">retry</span><span class="o">=</span><span class="n">retry_if_exception_type</span><span class="p">(</span>
        <span class="p">(</span><span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">RequestException</span><span class="p">,</span> <span class="ne">ConnectionError</span><span class="p">)</span>
    <span class="p">),</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">explain_relevance_from_stac_json</span><span class="p">(</span>
    <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">stac_json</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
    <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;gemini-1.5-pro-latest&quot;</span><span class="p">,</span>
    <span class="n">stream</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Prompts LLM to explain the relevance of a dataset to a query using its STAC JSON.</span>

<span class="sd">    Args:</span>
<span class="sd">        query (str): The user&#39;s query.</span>
<span class="sd">        stac_json (Dict[str, Any]): The STAC JSON of the dataset.</span>
<span class="sd">        model_name (str): The name of the model to use. Defaults to &quot;gemini-1.5-pro-latest&quot;.</span>
<span class="sd">        stream (bool): Whether to stream the response. Defaults to False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The explanation of the dataset&#39;s relevance to the query.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">stac_json_str</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">stac_json</span><span class="p">)</span>

    <span class="n">prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">  I am an Earth Engine user contemplating using a dataset to support</span>
<span class="s2">  my investigation of the following query. Provide a concise, paragraph-long</span>
<span class="s2">  summary explaining why this dataset may be a good fit for my use case.</span>
<span class="s2">  If it does not seem like an appropriate dataset, say so.</span>
<span class="s2">  If relevant, call attention to a max of 3 bands that may be of particular interest.</span>
<span class="s2">  Weigh the tradeoffs between temporal and spatial resolution, particularly</span>
<span class="s2">  if the original query specifies regions of interest, time periods, or</span>
<span class="s2">  frequency of data collection. If I have not specified any</span>
<span class="s2">  spatial constraints, do your best based on the nature of their query. For example,</span>
<span class="s2">  if I&#39;m wanting to study something small, like buildings, I will likely need good spatial resolution.</span>

<span class="s2">  Here is the original query:</span>
<span class="s2">  </span><span class="si">{</span><span class="n">query</span><span class="si">}</span>

<span class="s2">  Here is the stac json metadata for the dataset:</span>
<span class="s2">  </span><span class="si">{</span><span class="n">stac_json_str</span><span class="si">}</span>
<span class="s2">  &quot;&quot;&quot;</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">genai</span><span class="o">.</span><span class="n">GenerativeModel</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">generate_content</span><span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="n">stream</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">stream</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">response</span>
    <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="geemap.ai.fix_ee_python_code" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fix_ee_python_code</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">ee</span><span class="p">,</span> <span class="n">geemap_instance</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="s1">&#39;gemini-1.5-pro-latest&#39;</span><span class="p">)</span></code>

<a href="#geemap.ai.fix_ee_python_code" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Asks a model to do ee python code correction in the event of error.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>code</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Earth Engine Python code to fix.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ee</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Earth Engine module.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>geemap_instance</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Map (geemap.geemap.Map)" href="../geemap/#geemap.geemap.Map">Map</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The geemap instance.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>model_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the model to use. Defaults to "gemini-1.5-pro-latest".</p>
              </div>
            </td>
            <td>
                  <code>&#39;gemini-1.5-pro-latest&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The corrected Earth Engine Python code.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geemap/ai.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1796</span>
<span class="normal">1797</span>
<span class="normal">1798</span>
<span class="normal">1799</span>
<span class="normal">1800</span>
<span class="normal">1801</span>
<span class="normal">1802</span>
<span class="normal">1803</span>
<span class="normal">1804</span>
<span class="normal">1805</span>
<span class="normal">1806</span>
<span class="normal">1807</span>
<span class="normal">1808</span>
<span class="normal">1809</span>
<span class="normal">1810</span>
<span class="normal">1811</span>
<span class="normal">1812</span>
<span class="normal">1813</span>
<span class="normal">1814</span>
<span class="normal">1815</span>
<span class="normal">1816</span>
<span class="normal">1817</span>
<span class="normal">1818</span>
<span class="normal">1819</span>
<span class="normal">1820</span>
<span class="normal">1821</span>
<span class="normal">1822</span>
<span class="normal">1823</span>
<span class="normal">1824</span>
<span class="normal">1825</span>
<span class="normal">1826</span>
<span class="normal">1827</span>
<span class="normal">1828</span>
<span class="normal">1829</span>
<span class="normal">1830</span>
<span class="normal">1831</span>
<span class="normal">1832</span>
<span class="normal">1833</span>
<span class="normal">1834</span>
<span class="normal">1835</span>
<span class="normal">1836</span>
<span class="normal">1837</span>
<span class="normal">1838</span>
<span class="normal">1839</span>
<span class="normal">1840</span>
<span class="normal">1841</span>
<span class="normal">1842</span>
<span class="normal">1843</span>
<span class="normal">1844</span>
<span class="normal">1845</span>
<span class="normal">1846</span>
<span class="normal">1847</span>
<span class="normal">1848</span>
<span class="normal">1849</span>
<span class="normal">1850</span>
<span class="normal">1851</span>
<span class="normal">1852</span>
<span class="normal">1853</span>
<span class="normal">1854</span>
<span class="normal">1855</span>
<span class="normal">1856</span>
<span class="normal">1857</span>
<span class="normal">1858</span>
<span class="normal">1859</span>
<span class="normal">1860</span>
<span class="normal">1861</span>
<span class="normal">1862</span>
<span class="normal">1863</span>
<span class="normal">1864</span>
<span class="normal">1865</span>
<span class="normal">1866</span>
<span class="normal">1867</span>
<span class="normal">1868</span>
<span class="normal">1869</span>
<span class="normal">1870</span>
<span class="normal">1871</span>
<span class="normal">1872</span>
<span class="normal">1873</span>
<span class="normal">1874</span>
<span class="normal">1875</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@retry</span><span class="p">(</span>
    <span class="n">stop</span><span class="o">=</span><span class="n">stop_after_attempt</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
    <span class="n">wait</span><span class="o">=</span><span class="n">wait_exponential</span><span class="p">(</span><span class="n">multiplier</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span>
    <span class="n">retry</span><span class="o">=</span><span class="n">retry_if_exception_type</span><span class="p">(</span>
        <span class="p">(</span><span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">RequestException</span><span class="p">,</span> <span class="ne">ConnectionError</span><span class="p">)</span>
    <span class="p">),</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">fix_ee_python_code</span><span class="p">(</span>
    <span class="n">code</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ee</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">geemap_instance</span><span class="p">:</span> <span class="n">Map</span><span class="p">,</span> <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;gemini-1.5-pro-latest&quot;</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Asks a model to do ee python code correction in the event of error.</span>

<span class="sd">    Args:</span>
<span class="sd">        code (str): The Earth Engine Python code to fix.</span>
<span class="sd">        ee (Any): The Earth Engine module.</span>
<span class="sd">        geemap_instance (Map): The geemap instance.</span>
<span class="sd">        model_name (str): The name of the model to use. Defaults to &quot;gemini-1.5-pro-latest&quot;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The corrected Earth Engine Python code.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create_error_prompt</span><span class="p">(</span><span class="n">code</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">error_msg</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">      You are an extremely laconic code correction robot.</span>
<span class="s2">      I am attempting to execute the following snippet of python Earth Engine code,</span>
<span class="s2">      using a geemap instance:</span>

<span class="s2">      ```</span>
<span class="s2">        </span><span class="si">{</span><span class="n">code</span><span class="si">}</span>
<span class="s2">      ```</span>

<span class="s2">      I have encountered the following error, please fix it. In 1-2 sentences,</span>
<span class="s2">      explain your debugging thought process in the &#39;thoughts&#39; field. Note that</span>
<span class="s2">      the setOptions method exists only in the ee javascript library. Code</span>
<span class="s2">      referencing that method can be removed.</span>

<span class="s2">      Include the complete revised code snippet in the code field.</span>
<span class="s2">      Do not provide any other comentary in the code field. Do not add any new</span>
<span class="s2">      imports to the code snippet.</span>

<span class="s2">      </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="n">generation_config</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;response_mime_type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
        <span class="s2">&quot;response_schema&quot;</span><span class="p">:</span> <span class="n">CodeThoughts</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">model</span> <span class="o">=</span> <span class="n">genai</span><span class="o">.</span><span class="n">GenerativeModel</span><span class="p">(</span><span class="n">model_name</span><span class="p">,</span> <span class="n">generation_config</span><span class="o">=</span><span class="n">generation_config</span><span class="p">)</span>

    <span class="n">max_attempts</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">total_attempts</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">broken</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">while</span> <span class="n">total_attempts</span> <span class="o">&lt;</span> <span class="n">max_attempts</span> <span class="ow">and</span> <span class="n">broken</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">run_ee_code</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">ee</span><span class="p">,</span> <span class="n">geemap_instance</span><span class="p">)</span>
            <span class="c1"># logging.warning(f&#39;Code success! after {total_attempts} try.&#39;)</span>
            <span class="k">return</span> <span class="n">code</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Code execution error, asking Gemini for help.&quot;</span><span class="p">)</span>

            <span class="n">gemini_json_fail</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">while</span> <span class="n">gemini_json_fail</span><span class="p">:</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">generate_content</span><span class="p">(</span><span class="n">create_error_prompt</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">code_thoughts</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
                    <span class="n">gemini_json_fail</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">except</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">:</span>
                    <span class="k">pass</span>

            <span class="n">total_attempts</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="n">code</span> <span class="o">=</span> <span class="n">code_thoughts</span><span class="p">[</span><span class="s2">&quot;code&quot;</span><span class="p">]</span>
            <span class="n">thoughts</span> <span class="o">=</span> <span class="n">code_thoughts</span><span class="p">[</span><span class="s2">&quot;thoughts&quot;</span><span class="p">]</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Gemini thoughts: </span><span class="se">\n</span><span class="si">{</span><span class="n">thoughts</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># logging.warning(f&#39;Gemini new code: {code}&#39;)</span>
            <span class="k">if</span> <span class="n">total_attempts</span> <span class="o">==</span> <span class="n">max_attempts</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fix code after </span><span class="si">{</span><span class="n">max_attempts</span><span class="si">}</span><span class="s2"> attempts.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="geemap.ai.is_valid_question" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_valid_question</span><span class="p">(</span><span class="n">question</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="s1">&#39;gemini-1.5-pro-latest&#39;</span><span class="p">)</span></code>

<a href="#geemap.ai.is_valid_question" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Filters out questions that cannot be answered by a dataset search tool.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>question</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The user's question.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>model_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the model to use. Defaults to "gemini-1.5-pro-latest".</p>
              </div>
            </td>
            <td>
                  <code>&#39;gemini-1.5-pro-latest&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if the question is valid, False otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geemap/ai.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1754</span>
<span class="normal">1755</span>
<span class="normal">1756</span>
<span class="normal">1757</span>
<span class="normal">1758</span>
<span class="normal">1759</span>
<span class="normal">1760</span>
<span class="normal">1761</span>
<span class="normal">1762</span>
<span class="normal">1763</span>
<span class="normal">1764</span>
<span class="normal">1765</span>
<span class="normal">1766</span>
<span class="normal">1767</span>
<span class="normal">1768</span>
<span class="normal">1769</span>
<span class="normal">1770</span>
<span class="normal">1771</span>
<span class="normal">1772</span>
<span class="normal">1773</span>
<span class="normal">1774</span>
<span class="normal">1775</span>
<span class="normal">1776</span>
<span class="normal">1777</span>
<span class="normal">1778</span>
<span class="normal">1779</span>
<span class="normal">1780</span>
<span class="normal">1781</span>
<span class="normal">1782</span>
<span class="normal">1783</span>
<span class="normal">1784</span>
<span class="normal">1785</span>
<span class="normal">1786</span>
<span class="normal">1787</span>
<span class="normal">1788</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@retry</span><span class="p">(</span>
    <span class="n">stop</span><span class="o">=</span><span class="n">stop_after_attempt</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
    <span class="n">wait</span><span class="o">=</span><span class="n">wait_exponential</span><span class="p">(</span><span class="n">multiplier</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span>
    <span class="n">retry</span><span class="o">=</span><span class="n">retry_if_exception_type</span><span class="p">(</span>
        <span class="p">(</span><span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">RequestException</span><span class="p">,</span> <span class="ne">ConnectionError</span><span class="p">)</span>
    <span class="p">),</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">is_valid_question</span><span class="p">(</span><span class="n">question</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;gemini-1.5-pro-latest&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Filters out questions that cannot be answered by a dataset search tool.</span>

<span class="sd">    Args:</span>
<span class="sd">        question (str): The user&#39;s question.</span>
<span class="sd">        model_name (str): The name of the model to use. Defaults to &quot;gemini-1.5-pro-latest&quot;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if the question is valid, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">  You are a tool whose job is to determine whether or not the following question</span>
<span class="s2">  relates even in a small way to geospatial datasets.  Please provide a single</span>
<span class="s2">  word answer either True or False.</span>

<span class="s2">  For example, if the original query is &quot;hello&quot; - you should answer False. If</span>
<span class="s2">  the original query is &quot;cheese futures&quot; you should still answer True because</span>
<span class="s2">  the user could be interested in cheese production, and therefore agricultural</span>
<span class="s2">  land where cattle might be raised.</span>

<span class="s2">  Here is the original query:</span>
<span class="s2">  </span><span class="si">{</span><span class="n">question</span><span class="si">}</span>
<span class="s2">  &quot;&quot;&quot;</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">genai</span><span class="o">.</span><span class="n">GenerativeModel</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">generate_content</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span>
    <span class="c1"># Err on the side of returning True</span>
    <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;false&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="geemap.ai.make_langchain_index" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_langchain_index</span><span class="p">(</span><span class="n">embeddings_df</span><span class="p">)</span></code>

<a href="#geemap.ai.make_langchain_index" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Creates an index from a dataframe of precomputed embeddings.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>embeddings_df</code>
            </td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dataframe containing precomputed embeddings.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>VectorStoreIndexWrapper</code></td>            <td>
                  <code><span title="langchain.indexes.vectorstore.VectorStoreIndexWrapper">VectorStoreIndexWrapper</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The vector store index wrapper.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geemap/ai.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">make_langchain_index</span><span class="p">(</span><span class="n">embeddings_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">VectorStoreIndexWrapper</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates an index from a dataframe of precomputed embeddings.</span>

<span class="sd">    Args:</span>
<span class="sd">        embeddings_df (pd.DataFrame): The dataframe containing precomputed embeddings.</span>

<span class="sd">    Returns:</span>
<span class="sd">        VectorStoreIndexWrapper: The vector store index wrapper.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Create a dictionary mapping texts to their embeddings</span>
    <span class="n">embeddings_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">embeddings_df</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span> <span class="n">embeddings_df</span><span class="p">[</span><span class="s2">&quot;embedding&quot;</span><span class="p">]))</span>

    <span class="c1"># Create our custom embeddings class</span>
    <span class="n">precomputed_embeddings</span> <span class="o">=</span> <span class="n">PrecomputedEmbeddings</span><span class="p">(</span><span class="n">embeddings_dict</span><span class="p">)</span>

    <span class="c1"># Create Langchain Document objects</span>
    <span class="n">documents</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">embeddings_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="n">page_content</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;summary&quot;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;summary&quot;</span><span class="p">],</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]}</span>
        <span class="n">documents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Document</span><span class="p">(</span><span class="n">page_content</span><span class="o">=</span><span class="n">page_content</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">))</span>

    <span class="c1"># Create the VectorstoreIndexCreator</span>
    <span class="n">index_creator</span> <span class="o">=</span> <span class="n">VectorstoreIndexCreator</span><span class="p">(</span><span class="n">embedding</span><span class="o">=</span><span class="n">precomputed_embeddings</span><span class="p">)</span>

    <span class="c1"># Create the index</span>
    <span class="k">return</span> <span class="n">index_creator</span><span class="o">.</span><span class="n">from_documents</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="geemap.ai.matches_datetime" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">matches_datetime</span><span class="p">(</span><span class="n">collection_interval</span><span class="p">,</span> <span class="n">query_datetime</span><span class="p">)</span></code>

<a href="#geemap.ai.matches_datetime" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Checks if the collection's datetime interval matches the query datetime.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>collection_interval</code>
            </td>
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="datetime.datetime">datetime</span>, <span title="typing.Optional">Optional</span>[<span title="datetime.datetime">datetime</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Temporal interval of the collection.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>query_datetime</code>
            </td>
            <td>
                  <code><span title="datetime.datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A datetime coming from a query.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if the datetime interval matches, False otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geemap/ai.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">matches_datetime</span><span class="p">(</span>
    <span class="n">collection_interval</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">]],</span>
    <span class="n">query_datetime</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Checks if the collection&#39;s datetime interval matches the query datetime.</span>

<span class="sd">    Args:</span>
<span class="sd">        collection_interval (Tuple[datetime.datetime, Optional[datetime.datetime]]):</span>
<span class="sd">            Temporal interval of the collection.</span>
<span class="sd">        query_datetime (datetime.datetime): A datetime coming from a query.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if the datetime interval matches, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">collection_interval</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># End date should always be set in STAC JSON files, but just in case...</span>
        <span class="n">end_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">tz</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">UTC</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">end_date</span> <span class="o">=</span> <span class="n">collection_interval</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">collection_interval</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">query_datetime</span> <span class="o">&lt;=</span> <span class="n">end_date</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="geemap.ai.matches_interval" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">matches_interval</span><span class="p">(</span><span class="n">collection_interval</span><span class="p">,</span> <span class="n">query_interval</span><span class="p">)</span></code>

<a href="#geemap.ai.matches_interval" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Checks if the collection's datetime interval matches the query datetime interval.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>collection_interval</code>
            </td>
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="datetime.datetime">datetime</span>, <span title="datetime.datetime">datetime</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Temporal interval of the collection.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>query_interval</code>
            </td>
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="datetime.datetime">datetime</span>, <span title="datetime.datetime">datetime</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple
with the query interval start and end.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if the datetime interval matches, False otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geemap/ai.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">matches_interval</span><span class="p">(</span>
    <span class="n">collection_interval</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">],</span>
    <span class="n">query_interval</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Checks if the collection&#39;s datetime interval matches the query datetime interval.</span>

<span class="sd">    Args:</span>
<span class="sd">        collection_interval (Tuple[datetime.datetime, datetime.datetime]):</span>
<span class="sd">            Temporal interval of the collection.</span>
<span class="sd">        query_interval (Tuple[datetime.datetime, datetime.datetime]): A tuple</span>
<span class="sd">            with the query interval start and end.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if the datetime interval matches, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">start_query</span><span class="p">,</span> <span class="n">end_query</span> <span class="o">=</span> <span class="n">query_interval</span>
    <span class="n">start_collection</span><span class="p">,</span> <span class="n">end_collection</span> <span class="o">=</span> <span class="n">collection_interval</span>
    <span class="k">if</span> <span class="n">end_collection</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># End date should always be set in STAC JSON files, but just in case...</span>
        <span class="n">end_collection</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">tz</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">UTC</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">end_query</span> <span class="o">&gt;</span> <span class="n">start_collection</span> <span class="ow">and</span> <span class="n">start_query</span> <span class="o">&lt;=</span> <span class="n">end_collection</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="geemap.ai.run_ee_code" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">run_ee_code</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">ee</span><span class="p">,</span> <span class="n">geemap_instance</span><span class="p">)</span></code>

<a href="#geemap.ai.run_ee_code" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Executes Earth Engine Python code within the context of a geemap instance.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>code</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Earth Engine Python code to execute.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ee</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Earth Engine module.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>geemap_instance</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Map (geemap.geemap.Map)" href="../geemap/#geemap.geemap.Map">Map</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The geemap instance.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="Exception">Exception</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Re-raises any exception encountered during code execution.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geemap/ai.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@tenacity</span><span class="o">.</span><span class="n">retry</span><span class="p">(</span>
    <span class="n">stop</span><span class="o">=</span><span class="n">tenacity</span><span class="o">.</span><span class="n">stop_after_attempt</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
    <span class="n">wait</span><span class="o">=</span><span class="n">tenacity</span><span class="o">.</span><span class="n">wait_fixed</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
    <span class="n">retry</span><span class="o">=</span><span class="n">tenacity</span><span class="o">.</span><span class="n">retry_if_exception_type</span><span class="p">(</span><span class="n">LayerException</span><span class="p">),</span>
    <span class="c1"># before_sleep=lambda retry_state: print(f&quot;LayerException occurred. Retrying in 1 seconds... (Attempt {retry_state.attempt_number}/3)&quot;)</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">run_ee_code</span><span class="p">(</span><span class="n">code</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ee</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">geemap_instance</span><span class="p">:</span> <span class="n">Map</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Executes Earth Engine Python code within the context of a geemap instance.</span>

<span class="sd">    Args:</span>
<span class="sd">        code (str): The Earth Engine Python code to execute.</span>
<span class="sd">        ee (Any): The Earth Engine module.</span>
<span class="sd">        geemap_instance (Map): The geemap instance.</span>

<span class="sd">    Raises:</span>
<span class="sd">        Exception: Re-raises any exception encountered during code execution.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># geemap appears to have some stray print statements.</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
        <span class="k">with</span> <span class="n">redirect_stdout</span><span class="p">(</span><span class="n">_</span><span class="p">):</span>
            <span class="c1"># Note that sometimes the geemap code uses both &#39;Map&#39; and &#39;m&#39; to refer to a map instance.</span>
            <span class="n">exec</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;ee&quot;</span><span class="p">:</span> <span class="n">ee</span><span class="p">,</span> <span class="s2">&quot;Map&quot;</span><span class="p">:</span> <span class="n">geemap_instance</span><span class="p">,</span> <span class="s2">&quot;m&quot;</span><span class="p">:</span> <span class="n">geemap_instance</span><span class="p">})</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="c1"># Re-raise the exception with the original traceback</span>
        <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">exc_traceback</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()</span>
        <span class="k">raise</span> <span class="n">exc_value</span><span class="o">.</span><span class="n">with_traceback</span><span class="p">(</span><span class="n">exc_traceback</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>







  
    
  
  
    
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago" title="August 14, 2024 03:39:53 UTC"><span class="timeago" datetime="2024-08-14T03:39:53+00:00" locale="en"></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date" title="August 14, 2024 03:39:53 UTC">2024-08-14</span>
  </span>

    
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Created">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago" title="August 14, 2024 03:39:53 UTC"><span class="timeago" datetime="2024-08-14T03:39:53+00:00" locale="en"></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date" title="August 14, 2024 03:39:53 UTC">2024-08-14</span>
  </span>

    
    
    
  </aside>


  




                

              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2020 - 2024 Qiusheng Wu
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/giswqs" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://medium.com/@giswqs" target="_blank" rel="noopener" title="medium.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M369.4 32c43.4 0 78.6 35.2 78.6 78.6v83.8c-1.9-.1-3.8-.2-5.7-.2h-.4c-10 0-22.3 2.4-31.1 6.8-10 4.6-18.7 11.5-26 20.6-11.8 14.6-18.9 34.3-20.6 56.4-.1.7-.1 1.3-.2 2s-.1 1.2-.1 1.9c-.1 1.2-.1 2.4-.1 3.6 0 1.9-.1 3.8 0 5.8 1.2 50.1 28.2 90.2 76.3 90.2 2.7 0 5.3-.1 7.9-.4v20.4c0 43.4-35.2 78.6-78.6 78.6L78.6 480C35.2 480 0 444.8 0 401.4V110.6C0 67.2 35.2 32 78.6 32zM82.3 138.9l.3.1c13.2 3 19.8 7.4 19.8 23.4v187.2c0 16-6.7 20.4-19.9 23.4l-.3.1v2.8H135v-2.8l-.3-.1c-13.2-3-19.9-7.4-19.9-23.4V173.3l86.1 202.5h4.9l88.6-208.2v186.6c-1.1 12.6-7.8 16.5-19.7 19.2l-.3.1v2.7h91.9v-2.7l-.3-.1c-11.9-2.7-18.7-6.6-19.9-19.2l-.1-191.8h.1c0-16 6.7-20.4 19.9-23.4l.3-.1v-2.7h-72.2l-67 157.4-67-157.4H82.3zM448 340.3c-25.1-7.4-43-35.1-41.2-67.8h41.1v67.8zm-6.4-135.6c2.3 0 4.4.3 6.4.9V263h-40.2c1.5-33.6 13.6-57.9 33.8-58.3"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/giswqs" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M459.4 151.7c.3 4.5.3 9.1.3 13.6 0 138.7-105.6 298.6-298.6 298.6-59.5 0-114.7-17.2-161.1-47.1 8.4 1 16.6 1.3 25.3 1.3 49.1 0 94.2-16.6 130.3-44.8-46.1-1-84.8-31.2-98.1-72.8 6.5 1 13 1.6 19.8 1.6 9.4 0 18.8-1.3 27.6-3.6-48.1-9.7-84.1-52-84.1-103v-1.3c14 7.8 30.2 12.7 47.4 13.3-28.3-18.8-46.8-51-46.8-87.4 0-19.5 5.2-37.4 14.3-53C87.4 130.8 165 172.4 252.1 176.9c-1.6-7.8-2.6-15.9-2.6-24C249.5 95.1 296.3 48 354.4 48c30.2 0 57.5 12.7 76.7 33.1 23.7-4.5 46.5-13.3 66.6-25.3-7.8 24.4-24.4 44.8-46.1 57.8 21.1-2.3 41.6-8.1 60.4-16.2-14.3 20.8-32.2 39.3-52.6 54.3"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.linkedin.com/in/giswqs" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://youtube.com/@giswqs" target="_blank" rel="noopener" title="youtube.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M549.7 124.1c-6.2-23.7-24.8-42.3-48.3-48.6C458.9 64 288.1 64 288.1 64S117.3 64 74.7 75.5c-23.5 6.3-42 24.9-48.3 48.6C15 167 15 256.4 15 256.4s0 89.4 11.4 132.3c6.3 23.6 24.8 41.5 48.3 47.8C117.3 448 288.1 448 288.1 448s170.8 0 213.4-11.5c23.5-6.3 42-24.2 48.3-47.8 11.4-42.9 11.4-132.3 11.4-132.3s0-89.4-11.4-132.3zM232.2 337.6V175.2l142.7 81.2z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "navigation.tracking", "navigation.top", "search.highlight", "search.share"], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.92b07e13.min.js"></script>
      
        <script src="../js/timeago.min.js"></script>
      
        <script src="../js/timeago_mkdocs_material.js"></script>
      
    
  </body>
</html>